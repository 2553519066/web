import{C as Pe,E as ee,u as we}from"./index-DPGdqimB.js";import{bu as ke,bv as Ve,d as ne,aS as z,a4 as Le,bk as Ne,r as R,a6 as Ae,N as te,bw as Ie,h as p,y as M,k as y,j as T,B as D,A as t,bx as Se,w as l,v as n,b6 as De,p as b,E as se,by as Oe,L as ae,br as H,bz as Ue,bA as Fe,bB as ze,T as Be,bC as Ee,q as _,t as le,F as oe,bD as Re,bE as Me,bF as $e,bG as qe,bH as je,bI as Ge,bl as Je,bJ as Ye,Q as He}from"./index-7XFzyDag.js";var Qe="[object Number]";function Xe(h){return typeof h=="number"||ke(h)&&Ve(h)==Qe}const Ke={class:"w-full h-full"},We=ne({name:"ContractTemplateDesigner",__name:"designer",props:{actionTeleportId:{type:String,default:""},templateDetail:{type:Object,default:()=>{}}},emits:["saved","back"],setup(h,{emit:O}){const B=h,V=O,U=z(),o=Le({templateInfo:{key:"",url:"",document:""},partyList:[],otherList:[],disabled:!0,mode:Ne.TEMPLATE,hideFulfillmentPlan:!0}),C=z({}),A=R(1);Ae(()=>B.templateDetail,x=>{let{contractTemplate:u,contractTemplatePartyList:c,contractTemplateOtherList:f}=B.templateDetail||{};c.forEach(I=>{I.contractParty=I.partyType||I.contractParty});let{templateInfo:P,...F}=u||{};P=P?JSON.parse(P):{},P.key=te(),C.value=F,o.contractBaseInfo=C.value,o.templateInfo=P,o.partyList=c||[],o.otherList=Ie(f||[]),A.value++},{immediate:!0});const L=x=>{o.templateInfo={key:te(),url:x.fileUrl}},E=async x=>{let u=await U.value.getSaveData(x);return u.otherList.forEach(c=>{c.contractTemplateCode=C.value.code}),{id:C.value.id,code:C.value.code,templateInfo:JSON.stringify(u.templateInfo),contractTemplateOtherAddParamList:u.otherList}},$=async({event:x,done:u})=>{const c=ee.service({fullscreen:!0});try{const f=await E(c);c.setText("数据保存中..."),await Oe(f),ae.success("保存成功"),H("ContractTemplate"),V("saved")}catch(f){console.log(f)}finally{u(),c.close()}},q=async({event:x,done:u})=>{const c=ee.service({fullscreen:!0});try{const f=await E(c);c.setText("数据提交中..."),await Ue(f),ae.success("提交成功"),H("ContractTemplate"),V("back")}catch(f){console.log(f)}finally{u(),c.close()}};return(x,u)=>{const c=p("el-button"),f=p("FsButton"),P=p("el-space"),F=p("GroupContext");return y(),M("div",Ke,[h.actionTeleportId?(y(),T(Se,{key:0,defer:"",to:`#${h.actionTeleportId}`},[t(F,null,{default:l(()=>[t(P,null,{default:l(()=>[t(n(De),{accept:".docx,.doc",size:100,onSuccess:L},{default:l(({uploading:I})=>[t(c,{loading:I,type:"primary",size:"small",plain:""},{default:l(()=>u[0]||(u[0]=[b("导入合同")])),_:2,__:[0]},1032,["loading"])]),_:1}),C.value.status=="N"?(y(),T(f,{key:0,type:"primary",size:"small",onClick:$},{default:l(()=>u[1]||(u[1]=[b("保存")])),_:1,__:[1]})):D("",!0),t(f,{type:"primary",size:"small",onClick:q},{default:l(()=>u[2]||(u[2]=[b("提交")])),_:1,__:[2]})]),_:1})]),_:1})],8,["to"])):D("",!0),t(n(Pe),se({ref_key:"contractDesignerRef",ref:U},o),null,16)])}}}),Ze={class:"h-full flex flex-column",style:{padding:"4px"}},et={class:"flex justify-between radius-box",style:{padding:"10px 12px"}},tt={style:{margin:"0"}},at=["id"],lt={class:"flex-1",style:{"margin-top":"4px"}},ot={class:"contract-name-wrapper",style:{display:"flex",width:"100%"}},nt={style:{padding:"0 24px 0 24px",display:"flex","align-items":"center","justify-content":"center"},class:"contract-name-btn"},st={class:"flex primary-section"},rt={class:"party-item"},dt=ne({name:"ContractTemplateCreateOrEdit",__name:"create-or-edit",props:{id:{type:String,default:""}},setup(h){const O=h,{closeCurrent:B}=we(),V=R(1),U=z(null),o=R({id:null,code:"",name:"",businessTypeFirst:"",businessTypeFirstName:"",businessTypeSecond:"",businessTypeSecondName:"",businessTypeInfo:"",businessCodeList:[],remark:"",contractAllowCustomize:!1,contractType:"ONE_OFF_CONTRACT",contractTemplateFileAddParamList:[],contractTemplatePartyAddParamList:[],templateContractName:"",nameModify:"NOT_MODIFY",templateInfo:""}),{contractPartyList:C,sortEnable:A,partyRules:L,onResetData:E,onAddParty:$,onDelParty:q,onSortChange:x,onContractSort:u,onPartyTypeChange:c,onParticipantsChange:f,onOurChange:P,onSupplierChange:F,onCompanyChange:I,onOrgChange:re}=Fe();C.value=o.value.contractTemplatePartyAddParamList;const{businessTypeRef:de,businessTypeCascaderProps:ie,onBusinessTypeChange:pe}=ze(o),ue={name:[{required:!0,message:"请输入合同名称"}],businessCodeList:[{type:"array",required:!0,message:"请选择业务类型"}],remark:[{required:!0,message:"请输入合同描述"}],contractAllowCustomize:[{type:"bool",required:!0,message:"请选择是否允许修改"}],contractType:[{required:!0,message:"请选择合同类型"}]},ce=Be(()=>O.id||o.value.id?o.value.name||"编辑模版":"新增模版"),me=N=>{const{attachmentListBaseInfoList:e,contractTemplate:s,contractTemplatePartyList:w}=N,d=o.value;d.id=s.id,d.code=s.code,d.name=s.name,d.remark=s.remark,d.businessTypeFirst=s.businessTypeFirst,d.businessTypeFirstName=s.businessTypeFirstName,d.businessTypeSecond=s.businessTypeSecond,d.businessTypeSecondName=s.businessTypeSecondName,d.businessTypeInfo=s.businessTypeInfo,d.contractAllowCustomize=s.contractAllowCustomize,d.contractType=s.contractType,d.templateInfo=s.templateInfo,d.templateContractName=s.templateContractName,d.nameModify=s.nameModify,d.businessCodeList=s.businessTypeSecond.split(","),d.contractTemplateFileAddParamList=e.map(i=>({id:i.id,fileName:i.fileName,fileUrl:i.filePath,fileType:i.suffix})),s.fileList=[...d.contractTemplateFileAddParamList],C.value=w.map((i,m)=>(i._id=i.id,i.contaractParty=i.partyType,i.partyCode&&(i._echoOptions=[{value:i.partyCode,label:i.partyName}]),i._departCacheData=[{departmentId:i.departmentCode,departmentName:i.departmentName}],i)),d.contractTemplatePartyAddParamList=C.value,A.value=Xe(w.length>0?w[0].seq:void 0)},Q=R(!1),j=z({}),G=async N=>{if(N){Q.value=!0;try{const e=await Je(N);me(e),j.value=e}catch(e){console.log(e)}finally{Q.value=!1}}},J=()=>{window.opener?window.close():B()},ye=()=>{V.value=1},fe=()=>{V.value=2},X=async({event:N,done:e},s)=>{try{const w=await U.value.validate(),{businessCodeList:d,contractTemplateFileAddParamList:i,contractTemplatePartyAddParamList:m,...g}=o.value;g.contractTemplateFileAddParamList=i.map(v=>({id:v.id||null,fileName:v.fileName,filePath:v.fileUrl,suffix:v.fileType})),g.contractTemplatePartyAddParamList=m.map(v=>(v.partyType=v.partyType||v.contractParty,v));const S=await Ye(g);S&&(o.value.id=S.id,o.value.code=S.code,await G(S.id)),H("ContractTemplate"),s?J():V.value=2}catch(w){console.log(w)}finally{e()}},_e=async({event:N,done:e})=>{try{await X({event:N,done:e},!0)}catch(s){console.log(s)}finally{e()}},be=z(null),K=Ee();O.id?G(O.id):(E(),o.value.contractTemplatePartyAddParamList=C.value);const Ce=()=>{G(j.value.contractTemplate.id)};return(N,e)=>{const s=p("el-button"),w=p("FsButton"),d=p("el-space"),i=p("el-input"),m=p("el-form-item"),g=p("el-col"),S=p("el-text"),v=p("el-cascader"),ve=p("el-checkbox"),W=p("fs-dict-radio"),Te=p("el-row"),ge=p("el-switch"),he=p("el-link"),Y=p("fs-dict-select"),Z=p("form-select-v2"),xe=p("el-form");return y(),M("div",Ze,[_("div",et,[_("h4",tt,le(ce.value),1),t(d,null,{default:l(()=>[t(s,{size:"small",onClick:J},{default:l(()=>e[8]||(e[8]=[b("关闭")])),_:1,__:[8]}),V.value==1?(y(),M(oe,{key:0},[o.value.id?(y(),T(s,{key:0,type:"primary",size:"small",plain:"",onClick:fe},{default:l(()=>e[9]||(e[9]=[b("编辑模版")])),_:1,__:[9]})):D("",!0),o.value.id?(y(),T(w,{key:1,type:"primary",size:"small",onClick:_e},{default:l(()=>e[10]||(e[10]=[b("提交-关闭")])),_:1,__:[10]})):D("",!0),t(w,{type:"primary",size:"small",onClick:X},{default:l(()=>e[11]||(e[11]=[b("提交-编辑模版")])),_:1,__:[11]})],64)):(y(),T(s,{key:1,type:"primary",size:"small",plain:"",onClick:ye},{default:l(()=>e[12]||(e[12]=[b("上一步")])),_:1,__:[12]})),_("div",{id:n(K)},null,8,at)]),_:1})]),_("div",lt,[V.value==1?(y(),T(xe,{key:0,class:"radius-box base-info",ref_key:"formRef",ref:U,"label-width":"120px","label-position":"right",model:o.value,rules:ue},{default:l(()=>[e[19]||(e[19]=_("div",{class:"flex primary-section"},[_("div",{class:"primary-section-title"},"基础信息")],-1)),t(Te,null,{default:l(()=>[t(g,{span:10},{default:l(()=>[t(m,{label:"模版名称",prop:"name"},{default:l(()=>[t(i,{modelValue:o.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.name=a),modelModifiers:{trim:!0},placeholder:"请输入模版名称",maxlength:"20"},null,8,["modelValue"])]),_:1})]),_:1}),t(g,{span:10},{default:l(()=>[t(m,{label:"业务类型",prop:"businessCodeList","label-width":"180px"},{default:l(()=>[t(v,se({ref_key:"businessTypeRef",ref:de,modelValue:o.value.businessCodeList,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.businessCodeList=a)},n(ie),{onChange:n(pe),style:{width:"100%"}}),{default:l(({node:a,data:k})=>[t(S,{class:"cascader-item",truncated:""},{default:l(()=>[b(le(k.name),1)]),_:2},1024)]),_:1},16,["modelValue","onChange"])]),_:1})]),_:1}),t(g,{span:10},{default:l(()=>[t(m,{label:"模版描述",prop:"remark"},{default:l(()=>[t(i,{modelValue:o.value.remark,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.remark=a),modelModifiers:{trim:!0},placeholder:"请输入合同描述",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1}),t(g,{span:10},{default:l(()=>[t(m,{label:"合同名称",prop:"templateContractName","label-width":"180px"},{default:l(()=>[_("div",ot,[t(i,{style:{flex:"1"},modelValue:o.value.templateContractName,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.templateContractName=a),modelModifiers:{trim:!0},placeholder:"请输入合同名称",maxlength:"50"},null,8,["modelValue"]),_("div",nt,[e[13]||(e[13]=_("div",{style:{"word-break":"normal","word-wrap":"normal"}},"允许修改：",-1)),t(ve,{modelValue:o.value.nameModify,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.nameModify=a),"true-label":"MODIFY","false-label":"NOT_MODIFY"},null,8,["modelValue"])])])]),_:1})]),_:1}),t(g,{span:10},{default:l(()=>[t(m,{label:"合同类型",prop:"contractType"},{default:l(()=>[t(W,{modelValue:o.value.contractType,"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.contractType=a),code:"add_contract_type"},null,8,["modelValue"])]),_:1})]),_:1}),t(g,{span:10},{default:l(()=>[t(m,{label:"",prop:"contractAllowCustomize",class:"HJQ-hetong",style:{"margin-left":"73px"},"label-width":"108px"},{label:l(()=>e[14]||(e[14]=[_("div",{style:{"text-align":"right","line-height":"18px"}},"使用模版时是否允许修改",-1)])),default:l(()=>[t(W,{modelValue:o.value.contractAllowCustomize,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.contractAllowCustomize=a),code:"is_edit"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),_("div",st,[e[17]||(e[17]=_("div",{class:"primary-section-title"},"合同参与方",-1)),t(d,{style:{"margin-left":"24px"}},{default:l(()=>[t(S,{size:"small"},{default:l(()=>[e[15]||(e[15]=b(" 合同签署顺序 ")),t(ge,{modelValue:n(A),"onUpdate:modelValue":e[7]||(e[7]=a=>Re(A)?A.value=a:null),size:"small",onChange:n(u),style:{"margin-left":"6px"}},null,8,["modelValue","onChange"])]),_:1,__:[15]}),t(s,{type:"primary",link:"",onClick:n($),size:"small",style:{"margin-left":"20px"}},{default:l(()=>e[16]||(e[16]=[b("新增参与方")])),_:1,__:[16]},8,["onClick"])]),_:1})]),t(n(Me),{"item-key":"partyUuid",list:o.value.contractTemplatePartyAddParamList,direction:"vertical",animation:300,handle:".drag-btn",inset:"",onChange:n(x)},{item:l(({element:a,index:k})=>[_("div",rt,[t($e,{index:k+1,disabled:!n(A)},{default:l(()=>[o.value.contractTemplatePartyAddParamList.length>2?(y(),T(he,{key:0,type:"danger",onClick:r=>n(q)(a,k)},{default:l(()=>e[18]||(e[18]=[b("删除")])),_:2,__:[18]},1032,["onClick"])):D("",!0)]),_:2},1032,["index","disabled"]),t(d,{size:2,wrap:"",style:{"margin-top":"10px"}},{default:l(()=>[t(m,{label:"签约方地位","label-width":"100px",prop:`contractTemplatePartyAddParamList.${k}.partyType`,rules:n(L).partyType},{default:l(()=>[t(Y,{modelValue:a.partyType,"onUpdate:modelValue":r=>a.partyType=r,code:"party_type",onChange:r=>n(c)(r,a),style:{width:"200px"}},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["prop","rules"]),t(m,{label:"签约方信息","label-width":"100px",prop:`contractTemplatePartyAddParamList.${k}.participants`,rules:n(L).participants},{default:l(()=>[t(Y,{modelValue:a.participants,"onUpdate:modelValue":r=>a.participants=r,code:"participant",onChange:r=>n(f)(r,a),style:{width:"200px"}},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["prop","rules"]),t(m,{label:"签约方归属","label-width":"100px",prop:`contractTemplatePartyAddParamList.${k}.our`,rules:n(L).participants},{default:l(()=>[t(Y,{modelValue:a.our,"onUpdate:modelValue":r=>a.our=r,code:"party_belong",onChange:r=>n(P)(r,a),style:{width:"200px"}},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["prop","rules"]),a.participants=="FIXED_BODY"?(y(),M(oe,{key:0},[t(m,{label:"签约方名称","label-width":"100px",prop:`contractTemplatePartyAddParamList.${k}.partyCode`,rules:n(L).partyName},{default:l(()=>[a.our==0?(y(),T(Z,{key:0,modelValue:a.partyCode,"onUpdate:modelValue":r=>a.partyCode=r,"echo-options":a._echoOptions,"search-method":n(qe),placeholder:"请选择供应商",onChange:r=>n(F)(r,a,!0),style:{width:"200px"}},null,8,["modelValue","onUpdate:modelValue","echo-options","search-method","onChange"])):(y(),T(Z,{key:1,modelValue:a.partyCode,"onUpdate:modelValue":r=>a.partyCode=r,"search-method":n(je),"echo-options":a._echoOptions,placeholder:"请选择公司",onChange:r=>n(I)(r,a,!0),style:{width:"200px"}},null,8,["modelValue","onUpdate:modelValue","search-method","echo-options","onChange"]))]),_:2},1032,["prop","rules"]),a.our==1?(y(),T(m,{key:0,label:"所签约部门","label-width":"100px",prop:`contractTemplatePartyAddParamList.${k}.departmentCode`,rules:n(L).departmentCode},{default:l(()=>[t(n(Ge),{modelValue:a.departmentCode,"onUpdate:modelValue":r=>a.departmentCode=r,onChange:r=>n(re)(r,a),style:{width:"200px"},"cache-data":a._departCacheData},null,8,["modelValue","onUpdate:modelValue","onChange","cache-data"])]),_:2},1032,["prop","rules"])):D("",!0)],64)):D("",!0)]),_:2},1024)])]),_:1},8,["list","onChange"]),t(m,{label:"","label-width":"0",prop:"contractTemplatePartyAddParamList",rules:n(L).contractPartyList},null,8,["rules"])]),_:1,__:[19]},8,["model"])):(y(),T(We,{key:1,ref_key:"designerRef",ref:be,id:o.value.id,"template-detail":j.value,"action-teleport-id":n(K),"hide-fulfillment-plan":"",onSaved:Ce,onBack:J},null,8,["id","template-detail","action-teleport-id"]))])])}}}),ut=He(dt,[["__scopeId","data-v-762ce3d8"]]);export{ut as C};
