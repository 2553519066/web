const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/form-dialogly-DY9QephF.js","assets/index-DTCKMPKS.js","assets/index-B-DYpXrm.js","assets/index-CCf3sdPh.css","assets/format-YdPDtuZt.js","assets/form-dialogly-HVnhWbrQ.css"])))=>i.map(i=>d[i]);
import{d as fe,r as C,T as Me,aX as tt,aY as at,aZ as lt,h as b,a9 as qe,A as u,w as o,j as w,B as T,k as v,v as E,aL as xt,b_ as nt,a_ as At,b$ as Vt,b1 as wt,Q as ve,bh as L,bi as N,y as k,q as d,t as p,a6 as Ne,p as K,as as De,aH as Et,c0 as Tt,at as Se,o as ze,b2 as z,aV as ee,b4 as se,F as pe,E as Oe,P as it,H as ut,I as kt,ap as xe,aq as ct,a4 as dt,aS as Ue,i as mt,m as pt,z as Le,b9 as _e,b7 as ft,b3 as Ft,c1 as Rt,aw as ot,L as Y,bb as St,bc as $t,b8 as qt,c2 as $e,bo as Ut,bp as Mt}from"./index-B-DYpXrm.js";import{o as Ae,t as rt}from"./index-DTCKMPKS.js";const zt=fe({name:"UrlDownloadVue",inheritAttrs:!1,__name:"url-download-vue",props:{fileUrl:{type:String,default:""},fileName:{type:String,default:""},fileList:{type:Array,default:()=>[]},showView:{type:Boolean,default:!0},enableKkfile:{type:Boolean,default:!1}},setup(a){const I=a,s=C(!1),i=Me(()=>I.enableKkfile?!0:tt(I.fileUrl)||at(I.fileUrl)==lt.IMAGE),W=()=>{s.value=!0,Vt(I.fileUrl,I.fileName).finally(()=>{s.value=!1})},x=()=>{let G=I.enableKkfile?I.fileList:I.fileList.filter(B=>{let F=B.url||B.fileUrl||B.filePath;return tt(F)||at(F)==lt.IMAGE}),J=G.findIndex(B=>(B.url||B.fileUrl||B.filePath)===I.fileUrl);J=J===-1?0:J,wt({list:G,current:J})};return(G,J)=>{const B=b("fs-svg-icon"),F=b("el-link");return qe(G.$slots,"default",{download:s.value},()=>[u(F,{class:"svg-icon",underline:!1,disabled:s.value},{default:o(()=>[s.value?(v(),w(E(nt),{key:0,size:"16px",style:{animation:"loading-rotate 1.5s linear infinite"}},{default:o(()=>[u(E(xt))]),_:1})):(v(),w(B,{key:1,name:"template-download",onClick:J[0]||(J[0]=te=>W())})),a.showView&&E(i)?(v(),w(E(nt),{key:2,size:"16px",onClick:x,style:{"margin-left":"4px"}},{default:o(()=>[u(E(At))]),_:1})):T("",!0),qe(G.$slots,"default",{},void 0,!0)]),_:3},8,["disabled"])],!0)}}}),Bt=ve(zt,[["__scopeId","data-v-f864cb39"]]),Pl=new Map([["NO","不需用印"],["OFFLINE","线下用印"],["ONLINE","电子签"]]),Ll=new Map([["CREATED",{type:"warning",name:"已创建"}],["INVALID",{type:"info",name:"已作废"}],["IN_APPROVAL",{type:"success",name:"起草审批中"}],["CHANGE_IN_APPROVAL",{type:"success",name:"变更审批中"}],["CHANGED_WAITE_APPROVAL",{type:"warning",name:"变更待提交审批"}],["IN_FULFILLMENT",{type:"success",name:"已生效"}],["IN_STOP",{type:"info",name:"终止审批中"}],["ENDED",{type:"info",name:"已终止"}],["FINISHED",{type:"success",name:"已完成"}]]);function Nl(a,I){const i=new Map([["CREATED",[2,8,11,4]],["INVALID",[4]],["IN_APPROVAL",[16,4]],["CHANGE_IN_APPROVAL",[17,4]],["CHANGED_WAITE_APPROVAL",[14,12,5,4]],["IN_FULFILLMENT",[5,7,4,6,9,10]],["IN_STOP",[18,4]],["ENDED",[4,6]],["FINISHED",[4,6]]]).get(I);return i?i.includes(a):!1}function Dl(a,I){const i=new Map([["CREATED",[1,5,8,11]],["IN_APPROVAL",[1,4,6,12]],["IN_FULFILLMENT",[10,9,3,2,1]],["ENDED",[1,2]],["INVALID",[1]],["CHANGED_WAITE_APPROVAL",[7,8,1,11]],["IN_STOP",[1,13]],["FINISHED",[1,2]]]).get(I);return i?i.includes(a):!1}const Ol=new Map([["INVALID",{type:"info",name:"已作废"}],["WAITE_APPROVAL",{type:"warning",name:"已创建"}],["IN_APPROVAL",{type:"success",name:"新建审批中"}],["IN_FULFILLMENT",{type:"success",name:"已生效"}],["CHANGED_WAITE_APPROVAL",{type:"warning",name:"变更待提交审批"}],["CHANGED_APPROVAL",{type:"success",name:"变更审批中"}],["STOPPING",{type:"info",name:"终止审批中"}],["STOPPED",{type:"info",name:"已终止"}],["TASK_EFFECT",{type:"success",name:"已完成"}]]);function xl(a,I){const i=new Map([["INVALID",[]],["WAITE_APPROVAL",[3,6,7]],["IN_APPROVAL",[12]],["IN_FULFILLMENT",[15,5]],["CHANGED_WAITE_APPROVAL",[10,8,15]],["CHANGED_APPROVAL",[13]],["STOPPING",[14]],["STOPPED",[]],["TASK_EFFECT",[]]]).get(I);return i?i.includes(a):!1}const he=new Map([["IN_PROMISE",{type:"success",name:"履约中"}],["PART_PROMISE",{type:"warning",name:"部分履约"}],["PROMISE_FINISH",{type:"warning",name:"履约完成"}],["PROMISE_TERMINATE",{type:"info",name:"已取消"}],["REPEAL",{type:"info",name:"已取消"}],["WAIT_PROMISE",{type:"warning",name:"待履约"}]]),Ht="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20width='16px'%20height='16px'%20viewBox='0%200%2016%2016'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3ctitle%3eIcon/Attachment%3c/title%3e%3cg%20id='合同系统'%20stroke='none'%20stroke-width='1'%20fill='none'%20fill-rule='evenodd'%3e%3cg%20id='合同详情-基础信息'%20transform='translate(-1054,%20-745)'%20fill='%23165DFF'%3e%3cg%20id='编组-16'%20transform='translate(236,%20339)'%3e%3cg%20id='编组-6备份'%20transform='translate(805,%20368)'%3e%3cg%20id='编组'%20transform='translate(0,%2028)'%3e%3cg%20id='DataEntry/Upload/Light/Resources-Progress&amp;Uploading备份-3'%20transform='translate(13,%205)'%3e%3cg%20id='attachment'%20transform='translate(0,%205)'%3e%3crect%20id='矩形'%20fill-rule='nonzero'%20opacity='0'%20x='0'%20y='0'%20width='16'%20height='16'%3e%3c/rect%3e%3cpath%20d='M12.4578125,3.10390625%20C10.9859375,1.63203125%208.5890625,1.63203125%207.11875,3.10390625%20L3.040625,7.17890625%20C3.0140625,7.20546875%203,7.24140625%203,7.27890625%20C3,7.31640625%203.0140625,7.35234375%203.040625,7.37890625%20L3.6171875,7.95546875%20C3.671875,8.01015625%203.7609375,8.01015625%203.815625,7.95546875%20L7.89375,3.88046875%20C8.4,3.37421875%209.0734375,3.09609375%209.7890625,3.09609375%20C10.5046875,3.09609375%2011.178125,3.37421875%2011.6828125,3.88046875%20C12.1890625,4.38671875%2012.4671875,5.06015625%2012.4671875,5.77421875%20C12.4671875,6.48984375%2012.1890625,7.16171875%2011.6828125,7.66796875%20L7.5265625,11.8226562%20L6.853125,12.4960938%20C6.2234375,13.1257813%205.2,13.1257813%204.5703125,12.4960938%20C4.265625,12.1914063%204.0984375,11.7867188%204.0984375,11.3554687%20C4.0984375,10.9242188%204.265625,10.5195312%204.5703125,10.2148438%20L8.69375,6.09296875%20C8.7984375,5.98984375%208.9359375,5.93203125%209.0828125,5.93203125%20L9.084375,5.93203125%20C9.23125,5.93203125%209.3671875,5.98984375%209.4703125,6.09296875%20C9.575,6.19765625%209.63125,6.33515625%209.63125,6.48203125%20C9.63125,6.62734375%209.5734375,6.76484375%209.4703125,6.86796875%20L6.1,10.2351563%20C6.0734375,10.2617187%206.059375,10.2976562%206.059375,10.3351563%20C6.059375,10.3726562%206.0734375,10.4085938%206.1,10.4351563%20L6.6765625,11.0117188%20C6.73125,11.0664063%206.8203125,11.0664063%206.875,11.0117188%20L10.24375,7.64296875%20C10.5546875,7.33203125%2010.725,6.91953125%2010.725,6.48046875%20C10.725,6.04140625%2010.553125,5.62734375%2010.24375,5.31796875%20C9.6015625,4.67578125%208.5578125,4.67734375%207.915625,5.31796875%20L7.515625,5.71953125%20L3.79375,9.43984375%20C3.28125,9.95234375%203,10.6320313%203,11.3570312%20C3,12.0804687%203.2828125,12.7601563%203.79375,13.2710937%20C4.3234375,13.7992188%205.0171875,14.0632812%205.7109375,14.0632812%20C6.4046875,14.0632812%207.0984375,13.7992188%207.6265625,13.2710937%20L12.4578125,8.44296875%20C13.16875,7.73046875%2013.5625046,6.78203125%2013.5625046,5.77421875%20C13.5640625,4.76484375%2013.1703125,3.81640625%2012.4578125,3.10390625%20Z'%20id='路径'%3e%3c/path%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",Al=a=>L.post(`${N.contract}/contractOrder/page`,a),Wt=a=>L.post(`${N.contract}/contractList/addOrder`,a),Gt=a=>L.post(`${N.contract}/contractOrder/updateOrder`,a),Vl=a=>L.post(`${N.contract}/contractOrder/invalid`,a),Jt=a=>L.post(`${N.contract}/contractOrder/orderWithdraw`,a),jt=a=>L.post(`${N.contract}/contractOrder/stopOrder`,a),Xt=a=>L.post(`${N.contract}/contractOrder/changeOrder`,a),Kt=a=>L.get(`${N.contract}/contractOrder/detail`,a),Qt=a=>L.get(`${N.contract}/contractOrder/orderChangeHistoryDetail`,a),wl=a=>L.get(`${N.contract}/contractOrder/queryPlaceOrderCompany`,{size:100,companyName:a}).then(I=>Promise.resolve(I.map(s=>(s.value=s.companyCode,s.label=s.companyName,s)))),El=a=>L.get(`${N.contract}/contractOrder/queryPlaceOrderPerson`,{size:100,personName:a}).then(I=>Promise.resolve(I.map(s=>(s.value=s.userId,s.label=s.userName,s)))),Tl=a=>L.download(`${N.contract}/contractOrder/orderTempFile`,{params:a,method:"post"}),kl=a=>L.upload(`${N.contract}/contractOrder/importBatchData`,{method:"POST",data:a}),Fl=a=>L.download(`${N.contract}/contractOrder/exporErrData/${a}`,{method:"get"}),Rl=a=>L.get(`${N.contract}/contractOrder/approval/${a}`,{}),Sl=a=>L.get(`${N.contract}/contractOrder/preVerifyChangeOrder`,{contractOrderId:a}),$l=a=>L.get(`${N.contract}/contractOrder/preVerifyStopOrder`,{contractOrderId:a}),ql=a=>L.post(`${N.contract}/contractOrder/cancelChangeOrder`,a),Ul=a=>L.post(`${N.contract}/contractOrder/retractApproval`,a),Ml=a=>L.post(`${N.contract}/contractOrder/retractApproval`,a),zl=a=>L.post(`${N.contract}/contractOrder/retractStopOrder`,a),Yt={class:"contract-card"},Zt={class:"contract-card-title"},ea={class:"contract-card-content"},ta=fe({__name:"card",props:{title:{}},setup(a){const I=a;return(s,i)=>(v(),k("div",Yt,[d("div",Zt,p(I.title),1),d("div",ea,[qe(s.$slots,"default",{},void 0,!0)])]))}}),st=ve(ta,[["__scopeId","data-v-b5f40ba7"]]),Bl=a=>L.post(`${N.contract}/fulfillmentPlain/getPageList`,a),Hl=a=>L.get(`${N.contract}/fulfillmentPlain/getById/${a.id}`,a),Wl=a=>L.post(`${N.contract}/fulfillmentPlain/updateTime/${a.id}`,a),Gl=a=>L.get(`${N.contract}/fulfillmentPlain/getFulfillmentCancelDetail`,a),Jl=a=>L.post(`${N.contract}/fulfillmentPlain/cancelFulfillment`,a),jl=a=>L.post(`${N.contract}/fulfillmentRecord/sendFulfillment`,a),aa=a=>L.get(`${N.contract}/fulfillmentRecord/getRercods`,a),Xl=a=>L.get(`${N.contract}/fulfillmentRecord/repealRecord/${a.id}`,a),Kl=a=>L.get(`${N.contract}/fulfillmentPlain/getReceiver`,{size:100,codeOrName:a}).then(I=>Promise.resolve(I.map(s=>(s.value=s.receivePartyCode,s.label=s.receivePartyName,s)))),Ql=a=>L.get(`${N.contract}/fulfillmentPlain/getPayParties`,{size:100,codeOrName:a}).then(I=>Promise.resolve(I.map(s=>(s.value=s.payPartyCode,s.label=s.payPartyName,s)))),la={key:0},na={key:1},oa={key:2},ra=fe({__name:"amount-popover",props:{contractId:{type:String,required:!0},code:{type:String,required:!0},type:{type:String,required:!0,validator:a=>["PROMISE_FINISH","IN_PROMISE"].includes(a)},amount:{type:[Number,String],default:0},title:{type:String,default:""},showInTransit:{type:Boolean,default:!1},inTransitAmount:{type:[Number,String],default:0}},setup(a){const I=a,s=C([]),i=C(!1),W=async()=>{if(!(s.value.length>0||i.value)){i.value=!0;try{const x=await aa({contractId:I.contractId,type:I.type,code:I.code});s.value=Array.isArray(x)?x:[]}catch(x){console.error("获取金额列表失败:",x),s.value=[]}finally{i.value=!1}}};return Ne(()=>[I.contractId,I.code,I.type],()=>{s.value=[]},{immediate:!0}),(x,G)=>{const J=b("el-text"),B=b("el-link"),F=b("el-table-column"),te=b("el-table"),D=b("el-popover");return v(),w(D,{placement:"top",width:700,trigger:"click",onShow:W},{reference:o(()=>[u(J,{type:"primary",style:{"font-size":"13px",cursor:"pointer",display:"flex","flex-direction":"column",gap:"5px"}},{default:o(()=>[a.title?(v(),k("span",la,p(a.title)+"："+p(x.$format.thousandsFormatCurrency(a.amount)),1)):(v(),k("span",na,p(x.$format.thousandsFormatCurrency(a.amount)),1)),a.showInTransit&&a.inTransitAmount>0?(v(),k("span",oa," 在途金额："+p(x.$format.thousandsFormatCurrency(a.inTransitAmount)),1)):T("",!0)]),_:1})]),default:o(()=>[u(te,{data:s.value,border:"",loading:i.value,style:{width:"100%"}},{default:o(()=>[u(F,{"min-width":"160",prop:"flowEngineInstanceId",label:"费控单号"},{default:o(({row:y})=>[u(B,{type:"primary",onClick:O=>E(Ae)({flowId:y.flowEngineInstanceId})},{default:o(()=>[K(p(y.processInstanceNo),1)]),_:2},1032,["onClick"])]),_:1}),u(F,{"min-width":"90",prop:"createUserName",label:"履约人"}),u(F,{"min-width":"140",prop:"amount",label:"金额",formatter:E(De)},null,8,["formatter"]),u(F,{"min-width":"180",prop:"updateTime",label:a.type==="PROMISE_FINISH"?"履约完成时间":"申请时间"},null,8,["label"])]),_:1},8,["data","loading"])]),_:1})}}}),Pe=ve(ra,[["__scopeId","data-v-be8762f0"]]),sa={key:0,class:"total-text"},ia={class:"num"},ua={class:"compliance-program-out"},ca={style:{display:"grid",gap:"2px","font-size":"13px"}},da={class:"text-item"},ma={class:"table-column-list",style:{"font-size":"13px"}},pa={class:"table-column-list"},fa={key:0,style:{"font-size":"13px"}},va={key:1,style:{"font-size":"13px"}},ya={class:"table-column-list"},ha={style:{"font-size":"13px"}},_a={class:"table-column-list"},ga={style:{"font-size":"13px"}},Ca={style:{"font-size":"13px"}},ba={style:{"font-size":"13px"}},Ia={style:{"font-size":"13px"}},Pa={class:"table-column-list"},La={style:{"font-size":"13px"}},Na={class:"table-column-list"},Da={style:{"font-size":"13px"}},Oa={style:{"font-size":"13px"}},xa={class:"table-column-list"},Aa={style:{"font-size":"13px"}},Va={class:"table-column-list"},wa={style:{"font-size":"13px"}},Ea={key:0,class:"total-text"},Ta={class:"num"},ka={class:"compliance-program-out"},Fa={class:"table-column-list",style:{display:"grid",gap:"2px","font-size":"13px"}},Ra={class:"text-item"},Sa={class:"table-column-list"},$a={style:{"font-size":"13px"}},qa={style:{"font-size":"13px"}},Ua={class:"table-column-list"},Ma={style:{"font-size":"13px"}},za={class:"table-column-list"},Ba={key:0,style:{"font-size":"13px"}},Ha={key:1,style:{"font-size":"13px"}},Wa={class:"table-column-list"},Ga={style:{"font-size":"13px"}},Ja={class:"table-column-list"},ja={style:{"font-size":"13px"}},Xa={style:{"font-size":"13px"}},Ka={style:{"font-size":"13px"}},Qa={style:{"font-size":"13px"}},Ya={class:"table-column-list"},Za={style:{"font-size":"13px"}},el={class:"table-column-list"},tl={style:{"font-size":"13px"}},al={class:"table-column-list"},ll={style:{"font-size":"13px"}},nl={style:{"font-size":"13px"}},ol=fe({name:"BasicFulfillmentPlan",__name:"basic-fulfillment-plan",props:{detailData:{type:Object,required:!0},config:{type:Object,default:()=>({sourceInfo:"",ischange:!1})}},emits:["onFileSuccess"],setup(a,{emit:I}){Et();const s=a,i=C({sourceInfo:"",...Tt(s.config)}),W=C({code:"paymentPlanTable",autoTable:!0,data:s.detailData.fulfillmentPlainList,columns:[{label:"履约计划/状态",prop:"nameAndStatus",slot:"nameAndStatus",width:"200"},{label:"要求履约日期",prop:"fulfillDate",formatter:Se,width:110},{label:"履约计划金额",prop:"amount",slot:"amount",width:220},{label:"发票",prop:"invoice",slot:"invoice",width:"150"},{label:"费用类型",prop:"costTypeName"},{label:"费用日期",prop:"feeDate",slot:"feeDate",width:220},{label:"履约计划所属公司",prop:"payPartyName",slot:"payPartyName",width:"170"},{label:"成本中心",prop:"costCenterName",slot:"costCenterName",width:"170"},{label:"收款方",prop:"receiveParty",slot:"receiveParty",width:"320"},{label:"履约延续",prop:"autoExtend",slot:"autoExtend",width:"100"}]}),x=C({code:"receiptPlanTable",autoTable:!0,showIndex:!1,data:s.detailData.fulfillmentPlainList,columns:[{label:"履约计划/状态",prop:"nameAndStatus",slot:"nameAndStatus",width:"200"},{label:"要求履约日期",prop:"fulfillDate",formatter:Se,width:"110"},{label:"履约计划金额",prop:"amount",slot:"amount",width:"220"},{label:"是否保证金",prop:"deposit",slot:"deposit"},{label:"保证金归还日期",prop:"depositReturnDate",formatter:Se,width:"120"},{label:"发票",prop:"invoice",slot:"invoice",width:"150"},{label:"费用类型",prop:"costTypeName"},{label:"履约计划所属公司",prop:"receivePartyName",slot:"receivePartyName",width:"170"},{label:"成本中心",prop:"costCenterName",slot:"costCenterName",width:"170",showOverflowTooltip:!0},{label:"付款方",prop:"payParty",slot:"payParty",width:"320"},{label:"是否延续",prop:"autoExtend",slot:"autoExtend",width:"100"}]}),G=(D,y)=>{const O=it[D];if(!O)return console.error(`未找到名为 ${D} 的字典`),"";const M=O.find(H=>H.value==y);return M?M.label:""},J=D=>{console.log(D,"preWarrantyAmount"),ut({body:()=>kt(()=>import("./form-dialogly-DY9QephF.js"),__vite__mapDeps([0,1,2,3,4,5])),bodyData:{initData:D||{}},isReject:!0}).then(()=>{}).catch(()=>{})},B=D=>{const y=D.amount||0,O=D.amountFinish||0,M=D.amountApply||0,H=y-O-M;return Math.max(0,H)};ze(()=>{});let F=C("0.00"),te=C("0.00");return Ne(()=>s.detailData.fulfillmentPlainList,D=>{if(!D||!Array.isArray(D))return;const y=[],O=[];D.forEach(n=>{n.financeType==z.INCOME?y.push(n):O.push(n)});let M=O.reduce((n,q)=>ee(n,Number(q.amount)||0),0);F.value=se(M);let H=y.reduce((n,q)=>ee(n,Number(q.amount)||0),0);te.value=se(H),W.value.data=O,x.value.data=y},{deep:!0,immediate:!0}),(D,y)=>{const O=b("el-text"),M=b("el-tag"),H=b("complex-table");return v(),k(pe,null,[W.value.data&&W.value.data.length>0?(v(),w(st,{key:0,title:"付款计划",class:"card-mian"},{default:o(()=>[["order"].includes(i.value.sourceInfo)?(v(),k("div",sa,[y[0]||(y[0]=d("span",{class:"text"},"付款总金额：",-1)),d("span",ia,p(E(F))+"元",1)])):T("",!0),d("div",ua,[u(H,Oe({ref:"complianceContractRef"},W.value,{"max-height":420}),{nameAndStatus:o(({row:n})=>{var q;return[d("div",ca,[u(O,{class:"text-item",type:"primary",underline:"never",style:{cursor:"pointer","font-size":"13px"},onClick:U=>J(n)},{default:o(()=>[K(p(n.name),1)]),_:2},1032,["onClick"]),d("div",da,p(n.code),1),d("div",null,[u(M,{type:(q=E(he).get(n.fulfillStatus))==null?void 0:q.type,style:{"font-size":"13px"}},{default:o(()=>{var U;return[K(p((U=E(he).get(n.fulfillStatus))==null?void 0:U.name),1)]}),_:2},1032,["type"])])])]}),amount:o(({row:n})=>[d("div",ma,[d("span",null,"计划总金额："+p(D.$format.thousandsFormatCurrency(n.amount)),1),u(Pe,{"contract-id":s.detailData.id,code:n.code,type:"PROMISE_FINISH",amount:n.amountFinish,title:"已履约金额"},null,8,["contract-id","code","amount"]),u(Pe,{"contract-id":s.detailData.id,code:n.code,type:"IN_PROMISE",amount:n.amountApply,title:"在途金额"},null,8,["contract-id","code","amount"]),d("span",null,"预留质保金："+p(D.$format.thousandsFormatCurrency(n.preWarrantyAmount)),1),d("span",null,"可申请金额："+p(D.$format.thousandsFormatCurrency(B(n))),1)])]),invoice:o(({row:n})=>[d("div",pa,[n.invoiceType?(v(),k("span",fa,"类型："+p(G("invoice_type",n.invoiceType)),1)):T("",!0),n.taxRate?(v(),k("span",va,"税率："+p(n.taxRate)+"%",1)):T("",!0)])]),feeDate:o(({row:n})=>{var q,U;return[d("div",ya,[d("span",ha,p((q=n.feeStartTime)==null?void 0:q.split(" ")[0])+" - "+p((U=n.feeEndTime)==null?void 0:U.split(" ")[0]),1)])]}),receiveParty:o(({row:n})=>[d("div",_a,[d("span",ga,"供应商："+p(n.receivePartyName),1),d("span",Ca,"账户名称："+p(n.bankAccountName),1),d("span",ba,"收款账号："+p(n.bankAccountNumber),1),d("span",Ia,"收款银行(支行)："+p(n.bankSubName),1)])]),autoExtend:o(({row:n})=>[d("div",Pa,[d("span",La,p(G("auto_extend",n.autoExtend)),1)])]),costCenterName:o(({row:n})=>[d("div",Na,[d("span",Da,p(n.costCenterName),1),d("span",Oa,p(n.costCenterCode?`[${n.costCenterCode}]`:""),1)])]),fulfillStatus:o(({row:n})=>[d("div",xa,[d("span",Aa,p(E(he).get(n.fulfillStatus)),1)])]),payPartyName:o(({row:n})=>[d("div",Va,[d("span",wa,p(n.payPartyName)+p(n.payPartyCode?`[${n.payPartyCode}]`:""),1)])]),_:1},16)])]),_:1})):T("",!0),x.value.data&&x.value.data.length>0?(v(),w(st,{key:1,title:"收款计划",class:"card-mian"},{default:o(()=>[["order"].includes(i.value.sourceInfo)?(v(),k("div",Ea,[y[1]||(y[1]=d("span",{class:"text"},"收款总金额：",-1)),d("span",Ta,p(E(te))+"元",1)])):T("",!0),d("div",ka,[u(H,Oe({ref:"complianceContractRef"},x.value,{"max-height":420}),{nameAndStatus:o(({row:n})=>{var q;return[d("div",Fa,[u(O,{class:"text-item",type:"primary",underline:"never",style:{cursor:"pointer","font-size":"13px"},onClick:U=>J(n)},{default:o(()=>[K(p(n.name),1)]),_:2},1032,["onClick"]),d("div",Ra,p(n.code),1),d("div",null,[u(M,{type:(q=E(he).get(n.fulfillStatus))==null?void 0:q.type,style:{"font-size":"13px"}},{default:o(()=>{var U;return[K(p((U=E(he).get(n.fulfillStatus))==null?void 0:U.name),1)]}),_:2},1032,["type"])])])]}),amount:o(({row:n})=>[d("div",Sa,[d("span",$a,"计划总金额："+p(D.$format.thousandsFormatCurrency(n.amount)),1),u(Pe,{"contract-id":s.detailData.id,code:n.code,type:"PROMISE_FINISH",amount:n.amountFinish,title:"已履约金额"},null,8,["contract-id","code","amount"]),u(Pe,{"contract-id":s.detailData.id,code:n.code,type:"IN_PROMISE",amount:n.amountApply,title:"在途金额"},null,8,["contract-id","code","amount"]),d("span",qa,"待收款金额："+p(D.$format.thousandsFormatCurrency((n.amount||0)-(n.amountFinish||0))),1)])]),deposit:o(({row:n})=>[d("div",Ua,[d("span",Ma,p(n.deposit==1?"是":"否"),1)])]),invoice:o(({row:n})=>[d("div",za,[n.invoiceType?(v(),k("span",Ba,"类型："+p(G("invoice_type",n.invoiceType)),1)):T("",!0),n.taxRate?(v(),k("span",Ha,"税率："+p(n.taxRate)+"%",1)):T("",!0)])]),feeDate:o(({row:n})=>{var q,U;return[d("div",Wa,[d("span",Ga,p((q=n.feeStartTime)==null?void 0:q.split(" ")[0])+" ~ "+p((U=n.feeEndTime)==null?void 0:U.split(" ")[0]),1)])]}),payParty:o(({row:n})=>[d("div",Ja,[d("span",ja,"供应商："+p(n.payPartyName),1),d("span",Xa,"账户名称："+p(n.bankAccountName),1),d("span",Ka,"收款账号："+p(n.bankAccountNumber),1),d("span",Qa,"收款银行(支行)："+p(n.bankSubName),1)])]),autoExtend:o(({row:n})=>[d("div",Ya,[d("span",Za,p(G("auto_extend",n.autoExtend)),1)])]),receivePartyName:o(({row:n})=>[d("div",el,[d("span",tl,p(n.receivePartyName)+p(n.receivePartyCode?`[${n.receivePartyCode}]`:""),1)])]),costCenterName:o(({row:n})=>[d("div",al,[d("span",ll,p(n.costCenterName),1),d("span",nl,p(n.costCenterCode?`[${n.costCenterCode}]`:""),1)])]),_:1},16)])]),_:1})):T("",!0)],64)}}}),vt=ve(ol,[["__scopeId","data-v-fe0945d8"]]),rl={style:{height:"70vh","overflow-y":"scroll"}},sl={style:{"margin-left":"10px","font-size":"18px"}},il={key:1},ul=fe({name:"AddOrderLogs",inheritAttrs:!1,__name:"add-order-logs",props:xe({initData:{type:Object,default:()=>({})}},{modelValue:{},modelModifiers:{}}),emits:xe(["success","info"],["update:modelValue"]),setup(a,{emit:I}){const s=a,i=C(s.initData.plainType||"info"),W=I,x=ct(a,"modelValue"),G=C([]),J=C({info:"订单记录详情"}),B=()=>{let h;return(P=>{P.info="关闭"})(h||(h={})),h[i.value]||"确认"};let F=dt({});const te=Ue(),D=C(!1),y=C({id:s.initData.id||"",amount:0,contractCode:s.initData.code,orderCompanyName:s.initData.orderCompanyName,orderCompanyCode:s.initData.orderCompanyCode,contractId:s.initData.contractId||s.initData.id||"",contractListFulfillmentPlainParamList:{[z.INCOME]:[],[z.EXPENDITURE]:[]},orderName:"",remark:"",orderList:[],processId:"",processInstanceName:"",status:"",fileList:[],reason:""}),O=C({columns:[],initData:[],targetColumns:[],amountCode:""}),M={},H=C(!1),n=h=>{const{column:P}=h;if(P.property&&P.property=="quantity")return"header-required"},q=h=>{h.totalAmount=_e(h.quantity||0,h[O.value.amountCode]||0)},U=async h=>{i.value==="info"&&(W("info"),x.value=!1,h.value=!1)},l=h=>ft({contractCodeOrName:h}).then(P=>Promise.resolve(P.map(R=>({value:R.code,label:R.name,contractId:R.id,businessTypeSecond:R.businessTypeSecond,partyList:R.partyList||[],otherList:R.otherList||[]})))),le=h=>{y.value.orderCompanyName=h.label||""},A=C(!0),ge=C(["totalAmount"]);let ae=C(!1);const ne=h=>{const P=[];return h.columns.forEach((R,V)=>{var Q;if(V===0)P[V]="";else if(ge.value.includes(R.property)){let S=h.data.reduce((oe,ue)=>ee(oe,Number(ue[R.property])||0),0);S=((Q=R.relationData)==null?void 0:Q.thousand)||!1?se(S,""):S,P[V]=`汇总：${S}元`}else P[V]=""}),P},Ve=Me(()=>{const V=ae?40:0;return 40+5*40+V}),we=async h=>{const P=[],R=[];for(let V of h)V._id=V._id||V.id,V.financeType==z.INCOME?P.push(V):R.push(V);y.value.contractListFulfillmentPlainParamList&&(y.value.contractListFulfillmentPlainParamList[z.INCOME]=P,y.value.contractListFulfillmentPlainParamList[z.EXPENDITURE]=R),D.value=!0},X=async()=>{const h=await Qt({batchId:s.initData.batchId});if(h){const P=h.inFulfillmentPlainVOList||[],R=h.outFulfillmentPlainVOList||[];if(y.value.remark=h.orderDetailBaseInfoVO.remark,y.value.contractCode=h.orderDetailBaseInfoVO.contractCode,y.value.orderName=h.orderDetailBaseInfoVO.orderName,y.value.orderCompanyCode=h.orderDetailBaseInfoVO.orderCompanyCode,y.value.orderCompanyName=h.orderDetailBaseInfoVO.orderCompanyName,y.value.processInstanceNo=h.orderDetailBaseInfoVO.processInstanceNo,y.value.amount=h.orderDetailBaseInfoVO.amount||0,G.value=[{value:h.orderDetailBaseInfoVO.orderCompanyCode,label:h.orderDetailBaseInfoVO.orderCompanyName}],h.orderDetailBaseInfoVO.orderDetail){const V=JSON.parse(h.orderDetailBaseInfoVO.orderDetail);O.value.columns=V.columns,O.value.targetColumns=O.value.columns.filter(S=>(S.uPrice==="1"&&(O.value.amountCode=S.code),S)),ae.value=O.value.targetColumns.some(S=>S.sum==="1"),O.value.initData=V.data;let Q=[];for(let S of O.value.initData){const ie={_id:S._id,quantity:S.quantity||1,totalAmount:_e(S.quantity,S[O.value.amountCode]||0)};for(let oe of O.value.targetColumns)ie[oe.code]=S[oe.code];Q.push(ie)}y.value.orderList=Q}if(["info","cancel"].includes(i.value)){const V=h.inFulfillmentPlainVOList||[],Q=h.outFulfillmentPlainVOList||[];F.fulfillmentPlainList=[...V,...Q]}else we([...P,...R])}},Ee=async()=>{if(!s.initData.batchId)return!1;H.value=!0,Promise.all([X()]).finally(()=>{H.value=!1})};return ze(()=>{Ee()}),(h,P)=>{const R=b("form-select-v2"),V=b("el-form-item"),Q=b("el-input"),S=b("el-col"),ie=b("el-link"),oe=b("el-row"),ue=b("el-table-column"),Te=b("el-input-number"),Ce=b("el-table"),ke=b("el-form"),Fe=b("complex-dialog"),Re=mt("loading");return v(),w(Fe,{top:"10vh",title:J.value[i.value],modelValue:x.value,"onUpdate:modelValue":P[5]||(P[5]=$=>x.value=$),width:"80vw",onSubmit:U,confirmText:B(),hideCancel:["cancel","info"].includes(i.value)},{default:o(()=>[pt((v(),k("div",rl,[u(ke,{class:"radius-box add-order-main",ref_key:"formRef",ref:te,model:y.value,"label-position":"left",rules:M,style:{padding:"12px 12px 0"}},{default:o(()=>[u(V,{label:"框架协议",prop:"contractCode",required:["create"].includes(i.value)},{default:o(()=>[u(R,{modelValue:y.value.contractCode,"onUpdate:modelValue":P[0]||(P[0]=$=>y.value.contractCode=$),"search-method":l,disabled:!["create","change2"].includes(i.value),clearable:"",placeholder:["create","change2"].includes(i.value)?"请输入合同编号或名称选择框架协议":" "},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["required"]),u(V,{label:"订单名称",prop:"orderName",required:["create"].includes(i.value)},{default:o(()=>[u(Q,{modelValue:y.value.orderName,"onUpdate:modelValue":P[1]||(P[1]=$=>y.value.orderName=$),style:{width:"100%"},type:"type",maxlength:"200","show-word-limit":"",clearable:"",disabled:!["create","change2"].includes(i.value),placeholder:["create","change2"].includes(i.value)?"请输入名称":" "},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["required"]),u(oe,{gutter:24},{default:o(()=>[u(S,{span:12},{default:o(()=>[u(V,{label:"下单公司",prop:"orderCompanyCode",required:["create"].includes(i.value)},{default:o(()=>[u(R,{modelValue:y.value.orderCompanyCode,"onUpdate:modelValue":P[2]||(P[2]=$=>y.value.orderCompanyCode=$),"search-method":G.value,"echo-options":[{value:y.value.orderCompanyCode,label:`${y.value.orderCompanyName}`}],disabled:!["create","change2"].includes(i.value),clearable:"",placeholder:["create","change2"].includes(i.value)?"请选择公司":" ",onChange:le},null,8,["modelValue","search-method","echo-options","disabled","placeholder"])]),_:1},8,["required"])]),_:1}),u(S,{span:12},{default:o(()=>[u(V,{label:"审批流程",prop:"processInstanceNo",required:["create"].includes(i.value)},{default:o(()=>[u(ie,{type:"primary",underline:!1,onClick:P[3]||(P[3]=$=>E(Ae)({flowId:y.value.processInstanceNo}))},{default:o(()=>[K(p(y.value.processInstanceNo||"-"),1)]),_:1})]),_:1},8,["required"])]),_:1})]),_:1}),u(oe,{style:{"margin-bottom":"14px","align-items":"center"}},{default:o(()=>[P[6]||(P[6]=d("span",{style:{"font-size":"14px"}},"订单金额",-1)),d("span",sl,p(h.$format.thousandsFormatCurrency(y.value.amount))+"元",1)]),_:1,__:[6]}),u(V,{"label-position":"top",label:"商品信息",prop:"orderList",required:""},{default:o(()=>[u(Ce,{"row-key":"_id",data:y.value.orderList,border:"","max-height":Ve.value,style:{width:"100%"},size:"small",disabled:["info","view"].includes(i.value),"scrollbar-always-on":"","show-summary":E(ae),"summary-method":ne,"header-cell-class-name":n},{default:o(()=>[(v(!0),k(pe,null,Le(O.value.targetColumns,($,be)=>(v(),w(ue,{key:$.code,label:$.label,"min-width":160,prop:$.code},null,8,["label","prop"]))),128)),u(ue,{label:"数量",prop:"quantity","min-width":200},{default:o(({row:$,$index:be})=>[u(V,{class:"table-form-item",prop:`orderList.${be}.quantity`,rules:M.quantity},{default:o(()=>[["create","change","change2"].includes(i.value)?(v(),w(Te,{key:0,class:"number-left w-full",modelValue:$.quantity,"onUpdate:modelValue":ce=>$.quantity=ce,min:1,step:1,placeholder:"请输入",onChange:ce=>q($)},null,8,["modelValue","onUpdate:modelValue","onChange"])):(v(),k("span",il,p($.quantity),1))]),_:2},1032,["prop","rules"])]),_:1}),A.value?(v(),w(ue,{key:0,label:"总金额",prop:"totalAmount","min-width":200,formatter:E(De)},null,8,["formatter"])):T("",!0)]),_:1},8,["data","max-height","disabled","show-summary"])]),_:1}),u(V,{"label-position":"top",label:"订单备注",prop:"remark"},{default:o(()=>[u(Q,{modelValue:y.value.remark,"onUpdate:modelValue":P[4]||(P[4]=$=>y.value.remark=$),rows:3,style:{width:"100%"},type:"textarea",disabled:!["create","change2"].includes(i.value),maxlength:"500","show-word-limit":"",placeholder:["create","change2"].includes(i.value)?"请输入订单备注":""},null,8,["modelValue","disabled","placeholder"])]),_:1}),["info","view"].includes(i.value)?(v(),w(vt,{key:0,detailData:E(F)},null,8,["detailData"])):T("",!0)]),_:1},8,["model"])])),[[Re,H.value]])]),_:1},8,["title","modelValue","confirmText","hideCancel"])}}}),cl=ve(ul,[["__scopeId","data-v-52fe2efa"]]),dl={style:{height:"70vh","overflow-y":"scroll"}},ml={style:{"margin-left":"10px","font-size":"18px"}},pl={key:1},fl={key:0},vl={style:{padding:"12px"}},yl={style:{padding:"12px"}},hl={style:{"line-height":"22px","min-height":"22px",color:"#4e5969","font-size":"13px","word-break":"break-all"}},_l={style:{"line-height":"22px",height:"22px","margin-left":"4px"}},gl={class:"radius-box",style:{padding:"12px"}},Cl=fe({name:"AddOrder",inheritAttrs:!1,__name:"add-order",props:xe({initData:{type:Object,default:()=>({})}},{modelValue:{},modelModifiers:{}}),emits:xe(["success"],["update:modelValue"]),setup(a,{emit:I}){var Xe;const s=a,i=C(s.initData.plainType||"create"),W=I,x=ct(a,"modelValue"),G=(t,e)=>{const r=it[t];if(!r)return console.error(`未找到名为 ${t} 的字典`),"";const c=r.find(g=>g.value==e);return c?c.label:""},J=C({create:"新建订单",edit:"编辑订单",change:"变更订单",info:"订单详情",cancel:"取消订单",end:"取消订单",view:"订单详情",cancel2:"取消订单",change2:"变更订单"}),B=()=>{let t;return(e=>{e.create="确认",e.edit="确认",e.change="确认",e.info="关闭",e.cancel="确认",e.end="确认",e.view="关闭",e.cancel2="确认",e.change2="确认"})(t||(t={})),t[i.value]||"确认"};let F=dt({});const te=C({code:"orderChangeLogVOListPropsTable",autoTable:!0,showIndex:!1,data:[],columns:[{label:"历史版本",prop:"changeVersion",slot:"changeVersion",width:"120",align:"center"},{label:"变更时间",prop:"changeTime",width:"200"},{label:"变更人",prop:"changer",width:"110"},{label:"变更类型",prop:"changeType",slot:"changeType",width:"110",align:"center"},{label:"变更说明",prop:"description",slot:"description"},{label:"变更金额",prop:"amount",formatter:De},{label:"附件",prop:"attachmentUrl",slot:"attachmentUrl"},{label:"审批流程编号",prop:"approvalId",slot:"approvalId"}]}),D=Ue(),y=C(!1);let O=C(""),M=C(""),H=C(""),n=C(0),q=C(0);const U=C([]),l=C({id:s.initData.id||"",amount:0,contractCode:s.initData.code,orderCompanyName:s.initData.orderCompanyName,orderCompanyCode:s.initData.orderCompanyCode,orderCompanyBankInfo:{},contractId:s.initData.contractId||s.initData.id||"",contractListFulfillmentPlainParamList:{[z.INCOME]:[],[z.EXPENDITURE]:[]},orderName:"",remark:"",orderList:[],processId:"",processName:"",status:"",fileList:[],reason:""}),le=Ue([]),A=C({columns:[],initData:[],dataInfo:[],targetColumns:[],amountCode:""}),ge={contractCode:[{required:!0,message:"请选择框架协议"}],orderName:[{required:!0,message:"请输入订单名称"}],orderCompanyCode:[{required:!0,message:"请选择下单公司"}],orderCompanyName:[{required:!0,message:"请选择下单公司"}],processId:[{required:!0,message:"请配置框架订单流程"}],quantity:[{type:"number",required:!0,min:1,message:"请输入大于1的整数"}],contractListFulfillmentPlainParamList:[{type:"object",validator(t,e,r){if(e[z.INCOME].length==0&&e[z.EXPENDITURE].length==0)return r(new Error("请添加履约信息"));r()}}],orderChangeAmount:[{required:!0,message:"请输入订单调整金额",trigger:"blur"}],fileList:[{required:!0,message:"请上传附件",trigger:"blur",type:"array"}],changeReason:[{required:!0,message:"请输入变更说明",trigger:"blur"}],cancelReason:[{required:!0,message:"请输入取消原因",trigger:"blur"}]},ae=C(),ne=C(!1),Ve=t=>{ut({body:cl,bodyData:{initData:{batchId:t}},isReject:!0}).then(e=>{e.success}).catch(()=>{})},we=t=>{const{column:e}=t;if(e.property&&e.property=="quantity")return"header-required"},X=C({visible:!1,enableList:[],selectList:[],index:-1}),Ee=t=>{X.value.selectList=t},h=t=>{if(X.value.selectList.length==0){Y.warning("请选择标的内容"),t.value=!1;return}l.value.orderList.splice(X.value.index+1,0,...X.value.selectList),t.value=!1,X.value.visible=!1},P=t=>{t.totalAmount=_e(t.quantity||0,t[A.value.amountCode]||0)},R=async(t,e)=>{let r=new Set(l.value.orderList.map(g=>g._id)),c=A.value.dataInfo.filter(g=>!r.has(g._id));if(c.length==0){Y.warning("没有可添加的标的内容");return}X.value.index=e,X.value.enableList=c,X.value.selectList=[],X.value.visible=!0},V=(t,e)=>{l.value.orderList.splice(e,1)},Q=t=>{const{orderCompanyBankInfo:e}=l.value;let r=le.value.find(c=>c.our==1)||null;r=r&&r.useRange?JSON.parse(r.useRange):[],r=r.find(c=>c.companyCode===l.value.orderCompanyCode)||{};for(let c in t){let g=t[c];for(let m of g)m.fulfillStatus=="WAIT_PROMISE"&&(c===z.EXPENDITURE?(m.payPartyCode=r.companyCode,m.payPartyName=r.companyName):(m.receivePartyCode=r.companyCode,m.receivePartyName=r.companyName,m.disdeposit===1&&(m.depositReturnReceivePartyCode=r.partyCode,m.depositReturnReceivePartyName=r.partyName,m.depositReturnReceivePartyBankAccountNumber=e.bankAccountNumber)))}return[...t[z.INCOME],...t[z.EXPENDITURE]]},S=async t=>{try{try{await D.value.validate(),await ae.value.validate()}catch(m){for(const _ in m)if(m[_][0]){Y.error(m[_][0].message),t.value=!1;return}t.value=!1;return}const{orderList:e,contractListFulfillmentPlainParamList:r,...c}=l.value;c.orderDetail=JSON.stringify({columns:[...A.value.targetColumns.map(m=>({label:m.label,code:m.code,minWidth:160,uPrice:m.uPrice||"0",sum:m.sum||"0"}))],data:e}),c.contractListFulfillmentPlainParamList=Q(r);let g=e.reduce((m,_)=>ee(m,_.totalAmount),0);if(c.amount=g,i.value=="create"){const m=await Wt({...c});rt({submitId:m}),Y.success("操作成功"),W("success"),x.value=!1}else i.value=="edit"&&(await Gt({...c,orderId:s.initData.id||"",contractId:s.initData.contractId||""}),Y.success("修改成功"),W("success"),x.value=!1)}catch(e){console.log(e),t.value=!1}},ie=async t=>{try{try{await D.value.validate(),await ae.value.validate()}catch(m){for(const _ in m)if(m[_][0]){Y.error(m[_][0].message),t.value=!1;return}t.value=!1;return}const{orderList:e,contractListFulfillmentPlainParamList:r,...c}=l.value;c.orderDetail=JSON.stringify({columns:[...A.value.targetColumns.map(m=>({label:m.label,code:m.code,minWidth:160,uPrice:m.uPrice||"0",sum:m.sum||"0"}))],data:e}),c.contractOrderChangeFulfillmentPlainList=Q(r),c.amount=e.reduce((m,_)=>ee(m,_.totalAmount),0);let g=e.reduce((m,_)=>ee(m,_.totalAmount),0);c.amount=O.value||"",c.id=s.initData.id||"",await Xt(c),Y.success("操作成功"),W("success"),x.value=!1}catch(e){console.log(e),t.value=!1}},oe=async t=>{try{await D.value.validate(),x.value=!1,await Jt({cancelReason:l.value.cancelReason,fileList:l.value.fileList,id:s.initData.id||""}),Y.success("取消成功"),W("success")}catch(e){console.log(e),t.value=!1}},ue=async t=>{try{try{await D.value.validate()}catch(r){for(const c in r)if(r[c][0]){Y.error(r[c][0].message),t.value=!1;return}t.value=!1;return}x.value=!1;const e=await jt({cancelReason:l.value.cancelReason,fileList:l.value.fileList,orderId:s.initData.id||""});rt({submitId:e}),Y.success("操作成功"),W("success")}catch(e){console.log(e),t.value=!1}},Te=async t=>{switch(i.value){case"info":case"view":x.value=!1,t.value=!1;break;case"create":case"edit":S(t);break;case"change":case"change2":ie(t);break;case"end":case"end":ue(t);break;case"cancel":case"cancel2":oe(t);break}},Ce=async t=>{let e=le.value.find(r=>r.our==1)||null;e=e&&e.useRange?JSON.parse(e.useRange):[];try{e=e.map(r=>({label:r.companyName,value:r.companyCode})),U.value=e}catch(r){console.error(r),U.value=[]}},ke=async t=>{if(!t.value)return!1;l.value.orderCompanyName=t.selected.label||"";let e=await St([t.value]),r={};e&&$t(r,e[0].bankInfoList[0]),l.value.orderCompanyBankInfo=r,le.value.map(c=>{c.our===1&&(c.partyCode=t.value,c.partyName=t.selected.label)}),ae.value&&ae.value.initBusinessTypeConfig(ye.value.secondTypeCode),Ie([])},Fe=()=>{if(!l.value.contractCode)return Y.warning("请选择框架协议"),!1;if(!l.value.orderCompanyCode)return Y.warning("请选择下单公司"),!1},Re=t=>ft({contractCodeOrName:t}).then(e=>Promise.resolve(e.map(r=>({value:r.code,label:r.name,contractId:r.id,businessTypeSecond:r.businessTypeSecond,partyList:r.partyList||[],otherList:r.otherList||[]})))),$=C(!0),be=C(["totalAmount"]);let ce=C(!1);const yt=t=>{const e=[];return t.columns.forEach((r,c)=>{var g;if(c===0)e[c]="";else if(be.value.includes(r.property)){let m=t.data.reduce((j,re)=>ee(j,Number(re[r.property])||0),0);m=((g=r.relationData)==null?void 0:g.thousand)||!1?se(m,""):m,e[c]=`汇总：${m}元`}else e[c]=""}),e},ht=Me(()=>{const c=ce?40:0;return 40+5*40+c}),Be=t=>{let e=t.find(r=>r.fieldDefineType===Ut.TARGET)||null;if(e){const r=JSON.parse(e.fieldDefineInfo),c=JSON.parse(e.fieldInstanceData);A.value.columns=r.columns,A.value.targetColumns=A.value.columns.filter(m=>(m.uPrice==="1"&&(A.value.amountCode=m.code),m.targetType==="spec"||m.targetType==="amount")),ce.value=A.value.targetColumns.some(m=>m.sum==="1"),A.value.dataInfo=c[e.fieldInstanceCode],A.value.initData=c[e.fieldInstanceCode];let g=[];for(let m of A.value.initData){const _={_id:m._id,quantity:1,totalAmount:_e(1,m[A.value.amountCode]||0)};for(let j of A.value.targetColumns)_[j.code]=m[j.code];g.push(_)}n.value=[...g].reduce((m,_)=>ee(m,Number(_.totalAmount)||0),0),l.value.orderList=[...g]}},ye=C({config:{sourceInfo:"order",operationType:["change","change2"].includes(i.value)?"change":""},secondTypeCode:(Xe=s.initData)==null?void 0:Xe.businessTypeSecond,incomeConfig:{showFieldMap:{deposit:!0,depositReturnDate:!0}},expenditureConfig:{showFieldMap:{}}}),_t=t=>{const e=t.selected;ye.value.secondTypeCode=e.businessTypeSecond,l.value.contractId=e.contractId,le.value=e.partyList,Ce(""),l.value.orderCompanyCode="",He(e.businessTypeSecond),e.otherList&&Be(e.otherList),Ie([])},Ie=async t=>{const e=[],r=[];for(let c of t)c._id=c._id||c.id,c.financeType==z.INCOME?e.push(c):r.push(c);l.value.contractListFulfillmentPlainParamList&&(l.value.contractListFulfillmentPlainParamList[z.INCOME]=e,l.value.contractListFulfillmentPlainParamList[z.EXPENDITURE]=r),y.value=!0,ae.value&&ae.value.loadConfig()},He=async t=>{const e=await qt({businessTypeCode:t,contractType:"FRAMEWORK_ORDER"});if(e.length>0){const r=e[0];["create","edit","cancel","cancel2"].includes(i.value)?(l.value.processName=r.startProcessName,l.value.processId=r.startProcessId):["change","change2"].includes(i.value)?(l.value.processName=r.availableProcessName,l.value.processId=r.availableProcessId):["end"].includes(i.value)&&(l.value.processName=r.endProcessName,l.value.processId=r.endProcessId)}else l.value.processId="",l.value.processName=""},We=async t=>{const e=await Mt(t);Be(e.otherList),le.value=e.partyList,Ce(""),ye.value.secondTypeCode=e.businessTypeSecond,await He(e.businessTypeSecond),["create"].includes(i.value)&&(Ie([]),l.value.contractCode=e.code)},gt=async()=>{if(s.initData.contractId){const t=await Kt({id:s.initData.id});if(t){const e=t.orderDetailBaseInfoVO,r=t.inFulfillmentPlainVOList||[],c=t.outFulfillmentPlainVOList||[];if(l.value.amount=e.amount||0,l.value.remark=e.remark,l.value.contractCode=e.contractCode,l.value.orderName=e.orderName,l.value.orderCompanyCode=e.orderCompanyCode,l.value.orderCompanyName=e.orderCompanyName,l.value.processId=e.processId,l.value.processInstanceNo=e.processInstanceNo,e.orderDetail){const g=JSON.parse(e.orderDetail);A.value.columns=g.columns,A.value.targetColumns=A.value.columns.filter(_=>(_.uPrice==="1"&&(A.value.amountCode=_.code),_)),ce.value=A.value.targetColumns.some(_=>_.sum==="1"),A.value.initData=g.data;let m=[];for(let _ of A.value.initData){const j={_id:_._id,quantity:_.quantity||1,totalAmount:_e(_.quantity,_[A.value.amountCode]||0)};for(let re of A.value.targetColumns)j[re.code]=_[re.code];m.push(j)}n.value=[...m].reduce((_,j)=>ee(_,Number(j.totalAmount)||0),0),l.value.orderList=[...m]}if(te.value.data=t.orderChangeLogVOList||[],te.value.data=t.orderChangeLogVOList||[],e.status==="CHANGED_WAITE_APPROVAL"&&t.orderChangeLogVOList&&t.orderChangeLogVOList.length>0){const g=t.orderChangeLogVOList[t.orderChangeLogVOList.length-1];q.value=g.amount||0,l.value.orderChangeAmount=g.amount||"",l.value.fileList=g.attachmentUrl?JSON.parse(g.attachmentUrl):[],l.value.changeReason=g.description||""}if(["info","cancel","end"].includes(i.value)){const g=t.inFulfillmentPlainVOList||[],m=t.outFulfillmentPlainVOList||[];F.id=t.orderDetailBaseInfoVO.contractId||"",F.fulfillmentPlainList=[...g,...m]}else Ie([...r,...c])}}},Ct=()=>{const t=s.initData;if(t&&t.orderDetailBaseInfoVO){const e=t.orderDetailBaseInfoVO;if(l.value.remark=e.remark,l.value.contractCode=e.contractCode,l.value.orderName=e.orderName,l.value.orderCompanyCode=e.orderCompanyCode,l.value.orderCompanyName=e.orderCompanyName,l.value.processId=e.processId,l.value.id=e.id,e.orderDetail){const g=JSON.parse(e.orderDetail),m=g.data||[];n.value=[...m].reduce((_,j)=>ee(_,Number(j.totalAmount)||0),0),l.value.orderList=[...m],g.columns&&(A.value.targetColumns=g.columns.filter(_=>_.prop!=="quantity"&&_.prop!=="totalAmount"))}const r=t.inFulfillmentPlainVOList||[],c=t.outFulfillmentPlainVOList||[];F.id=e.contractId||"",F.fulfillmentPlainList=[...r,...c]}},bt=async()=>{if(i.value==="view"||i.value==="cancel2"||i.value==="change2"){ne.value=!0;const t=s.initData;if(t&&t.orderDetailBaseInfoVO){const e=t.orderDetailBaseInfoVO;Promise.all([We(e.contractId),Ct()]).finally(()=>{y.value=!0,ne.value=!1,le.value.map(r=>{r.our===1&&(r.partyCode=l.value.orderCompanyCode,r.partyName=l.value.orderCompanyName)}),ne.value=!1})}return}if(!s.initData.id&&!s.initData.contractId)return y.value=!0,!1;ne.value=!0,await We(s.initData.contractId||s.initData.id),await gt(),le.value.map(t=>{t.our===1&&(t.partyCode=l.value.orderCompanyCode,t.partyName=l.value.orderCompanyName)}),ne.value=!1,Je(!0)},Ge=C(!1);ze(()=>{bt()}),Ne(()=>l.value.contractCode,(t,e)=>{t||(l.value={amount:0,contractCode:s.initData.code,orderCompanyName:s.initData.orderCompanyName,orderCompanyCode:s.initData.orderCompanyCode,contractId:s.initData.id,contractListFulfillmentPlainParamList:{[z.INCOME]:[],[z.EXPENDITURE]:[]},remark:"",orderList:[],orderName:"",processId:"",processName:"",status:"",fileList:[],reason:""})},{immediate:!0});const It=t=>{let e=$e(H.value,q.value);if(t)if(t>0){let r=ee(e,t);O.value=r,M.value=se(r)}else{let r=$e(e,t*-1);if(r<0){Y.error("变更金额不能小于订单金额!"),l.value.orderChangeAmount="";return}O.value=r,M.value=se(r)}else{M.value=se(e);return}},Je=(t=!1)=>{let e=l.value.amount||0,r=l.value.orderList.reduce((c,g)=>ee(c,Number(g.totalAmount)||0),0);if(e>0&&(r+=$e(e,n.value||0)),O.value=r,M.value=se(r),t)H.value=r;else if(H.value){let c=r-H.value;l.value.orderChangeAmount=c||""}};Ne(()=>l.value.orderList,(t,e)=>{Je()},{immediate:!0,deep:!0});const je=t=>t?JSON.parse(t):[];return(t,e)=>{const r=b("form-select-v2"),c=b("el-form-item"),g=b("el-input"),m=b("fs-select"),_=b("el-col"),j=b("el-link"),re=b("el-row"),de=b("el-table-column"),Ke=b("el-input-number"),Qe=b("el-button"),Ye=b("el-table"),Pt=b("el-text"),Ze=b("el-scrollbar"),Lt=b("el-space"),Nt=b("complex-table"),Dt=b("el-form"),et=b("complex-dialog"),Ot=mt("loading");return v(),k(pe,null,[u(et,{top:"10vh",title:J.value[i.value],modelValue:x.value,"onUpdate:modelValue":e[11]||(e[11]=f=>x.value=f),width:"80vw",onSubmit:Te,confirmText:B(),hideCancel:["cancel","info"].includes(i.value)},{default:o(()=>[pt((v(),k("div",dl,[ne.value?T("",!0):(v(),w(Dt,{key:0,class:"radius-box add-order-main",ref_key:"formRef",ref:D,model:l.value,"label-position":"left",rules:ge,style:{padding:"12px 12px 0"}},{default:o(()=>[u(c,{label:"框架协议",prop:"contractCode",required:["create"].includes(i.value)},{default:o(()=>[u(r,{modelValue:l.value.contractCode,"onUpdate:modelValue":e[0]||(e[0]=f=>l.value.contractCode=f),"search-method":Re,disabled:!["create","change2"].includes(i.value),clearable:"",placeholder:["create","edit","change2"].includes(i.value)?"请输入合同编号或名称选择框架协议":" ",onChange:_t},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["required"]),u(c,{label:"订单名称",prop:"orderName",required:["create"].includes(i.value)},{default:o(()=>[u(g,{modelValue:l.value.orderName,"onUpdate:modelValue":e[1]||(e[1]=f=>l.value.orderName=f),style:{width:"100%"},type:"type",maxlength:"200","show-word-limit":"",clearable:"",disabled:!["create","change2"].includes(i.value),placeholder:["create","edit","change2"].includes(i.value)?"请输入名称":" "},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["required"]),u(re,{gutter:24},{default:o(()=>[u(_,{span:12},{default:o(()=>[u(c,{label:"下单公司",prop:"orderCompanyCode",required:["create"].includes(i.value)},{default:o(()=>[u(m,{modelValue:l.value.orderCompanyCode,"onUpdate:modelValue":e[2]||(e[2]=f=>l.value.orderCompanyCode=f),options:U.value,disabled:!["create","change2"].includes(i.value)||!l.value.contractCode,clearable:"",placeholder:["create","edit","change2"].includes(i.value)?"请选择公司":" ",onChange:ke},null,8,["modelValue","options","disabled","placeholder"])]),_:1},8,["required"])]),_:1}),u(_,{span:12},{default:o(()=>[l.value.processName?(v(),w(c,{key:0,label:"审批流程",prop:"processId",required:["create"].includes(i.value)},{default:o(()=>[K(p(l.value.processName||"-"),1)]),_:1},8,["required"])):T("",!0),l.value.processName?T("",!0):(v(),w(c,{key:1,label:"流程编号",prop:"processId"},{default:o(()=>[u(j,{type:"primary",underline:!1,onClick:e[3]||(e[3]=f=>E(Ae)({flowId:l.value.processInstanceNo}))},{default:o(()=>[K(p(l.value.processInstanceNo||"-"),1)]),_:1})]),_:1}))]),_:1})]),_:1}),u(re,{style:{"margin-bottom":"14px","align-items":"center"}},{default:o(()=>[e[13]||(e[13]=d("span",{style:{"font-size":"14px"}},"订单金额",-1)),d("span",ml,p(E(M))+"元",1)]),_:1,__:[13]}),u(c,{"label-position":"top",label:"商品信息",prop:"orderList",required:""},{default:o(()=>[u(Ye,{"row-key":"_id",data:l.value.orderList,border:"","max-height":ht.value,style:{width:"100%"},size:"small",disabled:["info","end","view"].includes(i.value),"scrollbar-always-on":"","show-summary":E(ce),"summary-method":yt,"header-cell-class-name":we},{default:o(()=>[(v(!0),k(pe,null,Le(A.value.targetColumns,(f,Z)=>(v(),w(de,{key:f.code,label:f.label,"min-width":160,prop:f.code},null,8,["label","prop"]))),128)),u(de,{label:"数量",prop:"quantity","min-width":200},{default:o(({row:f,$index:Z})=>[u(c,{class:"table-form-item",prop:`orderList.${Z}.quantity`,rules:ge.quantity},{default:o(()=>[["create","edit","change","change2"].includes(i.value)?(v(),w(Ke,{key:0,class:"number-left w-full",modelValue:f.quantity,"onUpdate:modelValue":me=>f.quantity=me,min:1,step:1,placeholder:"请输入",onChange:me=>P(f)},null,8,["modelValue","onUpdate:modelValue","onChange"])):(v(),k("span",pl,p(f.quantity),1))]),_:2},1032,["prop","rules"])]),_:1}),$.value?(v(),w(de,{key:0,label:"总金额",prop:"totalAmount","min-width":200,formatter:E(De)},null,8,["formatter"])):T("",!0),["create","edit","change","change2"].includes(i.value)?(v(),w(de,{key:1,label:"操作",width:100,fixed:"right"},{default:o(({row:f,$index:Z})=>[u(Qe,{link:"",type:"primary",size:"small",onClick:me=>R(f,Z)},{default:o(()=>e[14]||(e[14]=[K("新增")])),_:2,__:[14]},1032,["onClick"]),l.value.orderList.length>1?(v(),w(Qe,{key:0,onClick:me=>V(f,Z),size:"small",link:"",type:"primary"},{default:o(()=>e[15]||(e[15]=[K("删除")])),_:2,__:[15]},1032,["onClick"])):T("",!0)]),_:1})):T("",!0)]),_:1},8,["data","max-height","disabled","show-summary"])]),_:1}),u(c,{"label-position":"top",label:"订单备注",prop:"remark"},{default:o(()=>[u(g,{modelValue:l.value.remark,"onUpdate:modelValue":e[4]||(e[4]=f=>l.value.remark=f),rows:3,style:{width:"100%"},type:"textarea",disabled:!["create","edit","change2"].includes(i.value),maxlength:"500","show-word-limit":"",placeholder:["create","edit","change2"].includes(i.value)?"请输入订单备注":""},null,8,["modelValue","disabled","placeholder"])]),_:1}),["create","edit","change","change2"].includes(i.value)?(v(),w(c,{key:0,class:"fulfillmentplanListedit-item","label-position":"top",label:"履约信息",prop:"contractListFulfillmentPlainParamList",required:""},{default:o(()=>[d("div",{class:"w-full fulfillmentplanListedit-main",onClick:Fe},[y.value?(v(),k("div",fl,[u(Ft,Oe({ref_key:"planRef",ref:ae,modelValue:l.value.contractListFulfillmentPlainParamList,"onUpdate:modelValue":e[5]||(e[5]=f=>l.value.contractListFulfillmentPlainParamList=f),disabled:!(l.value.contractCode&&l.value.orderCompanyCode),"party-list":le.value},ye.value),null,16,["modelValue","disabled","party-list"])])):T("",!0)])]),_:1})):T("",!0),["change","change2"].includes(i.value)?(v(),w(re,{key:1,gutter:24},{default:o(()=>[u(_,{span:12},{default:o(()=>[u(c,{label:"订单调整金额",prop:"orderChangeAmount",required:""},{default:o(()=>[u(Ke,{modelValue:l.value.orderChangeAmount,"onUpdate:modelValue":e[6]||(e[6]=f=>l.value.orderChangeAmount=f),class:"number-left",controls:!1,precision:2,max:E(Rt),placeholder:"请输入订单调整金额",style:{width:"80%"},onChange:It},null,8,["modelValue","max"]),e[16]||(e[16]=d("span",{slot:"append",style:{"margin-left":"4px"}},"元",-1))]),_:1,__:[16]}),u(Pt,{style:{"margin-left":"18px",color:"#f56c6c"}},{default:o(()=>e[17]||(e[17]=[K("说明：订单变更金额可以调增（正数），也可以调减（负数）")])),_:1,__:[17]})]),_:1}),u(_,{span:12},{default:o(()=>[u(c,{label:"上传附件",prop:"fileList",required:!1},{default:o(()=>[u(E(ot),{modelValue:l.value.fileList,"onUpdate:modelValue":e[7]||(e[7]=f=>l.value.fileList=f),accept:".pdf",disabled:Ge.value,size:50,limit:10,style:{width:"100%"}},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1})):T("",!0),["change","change2"].includes(i.value)?(v(),w(c,{key:2,"label-position":"top",label:"变更说明",prop:"changeReason",required:""},{default:o(()=>[u(g,{modelValue:l.value.changeReason,"onUpdate:modelValue":e[8]||(e[8]=f=>l.value.changeReason=f),rows:3,style:{width:"100%"},type:"textarea",maxlength:"500","show-word-limit":"",placeholder:"请输入变更说明"},null,8,["modelValue"])]),_:1})):T("",!0),["info","cancel","end","cancel2","view"].includes(i.value)?(v(),w(vt,{key:3,detailData:E(F),config:ye.value.config},null,8,["detailData","config"])):T("",!0),["cancel","end","cancel2"].includes(i.value)?(v(),w(c,{key:4,"label-position":"top",label:"取消原因",prop:"cancelReason",required:""},{default:o(()=>[u(g,{modelValue:l.value.cancelReason,"onUpdate:modelValue":e[9]||(e[9]=f=>l.value.cancelReason=f),rows:3,style:{width:"100%"},type:"textarea",maxlength:"500","show-word-limit":"",placeholder:"请输入取消原因"},null,8,["modelValue"])]),_:1})):T("",!0),["cancel","end","cancel2"].includes(i.value)?(v(),w(c,{key:5,"label-position":"top",label:"上传附件",prop:"fileList",required:!1},{default:o(()=>[u(E(ot),{modelValue:l.value.fileList,"onUpdate:modelValue":e[10]||(e[10]=f=>l.value.fileList=f),accept:".pdf",disabled:Ge.value,size:50,limit:10,style:{width:"100%"}},null,8,["modelValue","disabled"])]),_:1})):T("",!0),["info","view"].includes(i.value)?(v(),w(c,{key:6,"label-position":"top",label:"变更记录"},{default:o(()=>[u(Nt,Oe({ref:"complianceContractRef"},te.value),{changeVersion:o(({row:f})=>[f.changeVersion?(v(),w(j,{key:0,type:"primary",underline:!0,onClick:Z=>Ve(f.batchId)},{default:o(()=>[K("V"+p(f.changeVersion||"-"),1)]),_:2},1032,["onClick"])):T("",!0)]),changeType:o(({row:f})=>[K(p(G("contract_order_change_type",f.changeType)),1)]),description:o(({row:f})=>[u(Ze,{"max-height":"60px"},{default:o(()=>[d("div",vl,p(f.description),1)]),_:2},1024)]),attachmentUrl:o(({row:f})=>[u(Ze,{"max-height":"60px"},{default:o(()=>[d("div",yl,[u(Lt,{direction:"vertical",alignment:"flex-start",style:{"min-height":"62px",height:"auto"}},{default:o(()=>[(v(!0),k(pe,null,Le(je(f.attachmentUrl),(Z,me)=>(v(),k("div",{key:me,style:{display:"flex",cursor:"pointer"}},[e[18]||(e[18]=d("img",{style:{width:"16px",height:"22px","line-height":"22px"},src:Ht,alt:""},null,-1)),d("div",hl,p(Z.fileName),1),d("div",_l,[u(E(Bt),{"file-url":Z.fileUrl,"file-name":Z.fileName,"file-list":je(f.attachmentUrl)},null,8,["file-url","file-name","file-list"])])]))),128))]),_:2},1024)])]),_:2},1024)]),approvalId:o(({row:f})=>[u(j,{type:"primary",underline:!0,onClick:Z=>E(Ae)({flowId:f.approvalId})},{default:o(()=>[K(p(f.approvalId||"-"),1)]),_:2},1032,["onClick"])]),_:1},16)]),_:1})):T("",!0)]),_:1},8,["model"]))])),[[Ot,ne.value]])]),_:1},8,["title","modelValue","confirmText","hideCancel"]),u(et,{title:"选择标的内容",modelValue:X.value.visible,"onUpdate:modelValue":e[12]||(e[12]=f=>X.value.visible=f),width:"600px",onSubmit:h},{default:o(()=>[d("div",gl,[u(Ye,{data:X.value.enableList,border:"",style:{width:"100%"},size:"small",onSelectionChange:Ee},{default:o(()=>[u(de,{type:"selection",width:"50",align:"center"}),(v(!0),k(pe,null,Le(A.value.targetColumns,(f,Z)=>(v(),w(de,{key:f.code,label:f.label,"min-width":160,prop:f.code},null,8,["label","prop"]))),128))]),_:1},8,["data"])])]),_:1},8,["modelValue"])],64)}}}),Yl=ve(Cl,[["__scopeId","data-v-e3af8155"]]);export{Yl as A,vt as B,st as C,Wl as D,jl as E,Xl as F,Gl as G,Jl as H,Bt as U,Ht as _,Dl as a,xl as b,Ll as c,Rl as d,$l as e,Tl as f,Nl as g,Fl as h,kl as i,wl as j,El as k,zl as l,ql as m,Ml as n,Ol as o,Sl as p,Al as q,Ul as r,Pl as s,Vl as t,Bl as u,Ql as v,Kl as w,Hl as x,Kt as y,aa as z};
