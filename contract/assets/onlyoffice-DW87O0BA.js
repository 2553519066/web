import{d as u,Q as l,y as p,k as h,dm as f,dn as g,dp as v,dq as m,dr as _,aR as y,N as w,T as R,ds as q,A as E,v as a}from"./index-B-DYpXrm.js";const D=async(e,t)=>new Promise((o,s)=>{try{if(window.DocsAPI)return o(null);const n=document.getElementById(t);if(n){let i=setInterval(()=>{if(!n.getAttribute("loading")){if(clearInterval(i),window.DocsAPI)return o(null);const c=d(t,e,o,s);n.remove(),document.body.appendChild(c)}},500)}else{const i=d(t,e,o,s);document.body.appendChild(i)}}catch(n){console.error(n)}}),d=(e,t,o,s)=>{const n=document.createElement("script");return n.id=e,n.type="text/javascript",n.src=t,n.async=!0,n.onload=()=>{n.removeAttribute("loading"),o(null)},n.onerror=i=>{n.removeAttribute("loading"),s(i)},n.setAttribute("loading",""),n},S=u({name:"DocumentEditor",props:{id:{type:String,required:!0},documentServerUrl:{type:String,required:!0},config:{type:Object,required:!0},document_fileType:String,document_title:String,documentType:String,editorConfig_lang:String,height:String,type:String,width:String,onLoadComponentError:Function,events_onAppReady:Function,events_onDocumentStateChange:Function,events_onMetaChange:Function,events_onDocumentReady:Function,events_onDownloadAs:Function,events_onInfo:Function,events_onWarning:Function,events_onError:Function,events_onRequestSharingSettings:Function,events_onRequestRename:Function,events_onMakeActionLink:Function,events_onRequestInsertImage:Function,events_onRequestSaveAs:Function,events_onRequestMailMergeRecipients:Function,events_onRequestCompareFile:Function,events_onRequestEditRights:Function,events_onRequestHistory:Function,events_onRequestHistoryClose:Function,events_onRequestHistoryData:Function,events_onRequestRestore:Function,events_onRequestSelectSpreadsheet:Function,events_onRequestSelectDocument:Function,beforeDestroyEditor:Function},mounted(){let e=this.documentServerUrl;e.endsWith("/")||(e+="/");const t=`${e}web-apps/apps/api/documents/api.js`;D(t,"onlyoffice-api-script").then(()=>this.onLoad()).catch(()=>{this.onError(-2)})},unmounted(){var t;const e=this.id||"";(t=window==null?void 0:window.DocEditor)!=null&&t.instances[e]&&(this.beforeDestroyEditor&&this.beforeDestroyEditor(),window.DocEditor.instances[e].destroyEditor(),window.DocEditor.instances[e]=void 0)},watch:{config:{handler:function(e,t){this.onChangeProps()},deep:!0},document_fileType:function(e,t){this.onChangeProps()},document_title:function(e,t){this.onChangeProps()},documentType:function(e,t){this.onChangeProps()},editorConfig_lang:function(e,t){this.onChangeProps()},height:function(e,t){this.onChangeProps()},type:function(e,t){this.onChangeProps()},width:function(e,t){this.onChangeProps()}},methods:{onLoad(){var e,t;try{const o=this.id||"";if(window.DocsAPI||this.onError(-3),(e=window==null?void 0:window.DocEditor)!=null&&e.instances[o]){console.log("Skip loading. Instance already exists",o);return}(t=window==null?void 0:window.DocEditor)!=null&&t.instances||(window.DocEditor={instances:{}});let s=Object.assign({document:{fileType:this.document_fileType,title:this.document_title},documentType:this.documentType,editorConfig:{lang:this.editorConfig_lang},events:{onAppReady:this.onAppReady,onDocumentStateChange:this.events_onDocumentStateChange,onMetaChange:this.events_onMetaChange,onDocumentReady:this.events_onDocumentReady,onDownloadAs:this.events_onDownloadAs,onInfo:this.events_onInfo,onWarning:this.events_onWarning,onError:this.events_onError,onRequestSharingSettings:this.events_onRequestSharingSettings,onRequestRename:this.events_onRequestRename,onMakeActionLink:this.events_onMakeActionLink,onRequestInsertImage:this.events_onRequestInsertImage,onRequestSaveAs:this.events_onRequestSaveAs,onRequestMailMergeRecipients:this.events_onRequestMailMergeRecipients,onRequestCompareFile:this.events_onRequestCompareFile,onRequestEditRights:this.events_onRequestEditRights,onRequestHistory:this.events_onRequestHistory,onRequestHistoryClose:this.events_onRequestHistoryClose,onRequestHistoryData:this.events_onRequestHistoryData,onRequestRestore:this.events_onRequestRestore,onRequestSelectSpreadsheet:this.events_onRequestSelectSpreadsheet,onRequestSelectDocument:this.events_onRequestSelectDocument},height:this.height,type:this.type,width:this.width},this.config||{});const n=window.DocsAPI.DocEditor(o,s);window.DocEditor.instances[o]=n}catch(o){console.error(o),this.onError(-1)}},onError(e){let t;switch(e){case-2:t="Error load DocsAPI from "+this.documentServerUrl;break;case-3:t="DocsAPI is not defined";break;default:t="Unknown error loading component",e=-1}typeof this.onLoadComponentError>"u"?console.error(t):this.onLoadComponentError(e,t)},onAppReady(){const e=this.id||"";this.events_onAppReady(window.DocEditor.instances[e])},onChangeProps(){var t;const e=this.id||"";(t=window==null?void 0:window.DocEditor)!=null&&t.instances[e]&&(window.DocEditor.instances[e].destroyEditor(),window.DocEditor.instances[e]=void 0,console.log("Important props have been changed. Load new Editor."),this.onLoad())}}}),C=["id"];function F(e,t,o,s,n,i){return h(),p("div",{id:e.id},null,8,C)}const A=l(S,[["render",F]]);function I(e){const t="."+f(e);return g.includes(t)?"word":v.includes(t)?"pdf":m.includes(t)?"cell":_.includes(t)?"slide":void 0}const b={class:"onlyoffice-preview"},P=u({name:"OnlyOfficePreview",__name:"onlyoffice",props:{data:{},onlyofficeBase:{}},setup(e){const t=e,o=y(),s=t.onlyofficeBase||(o==null?void 0:o.appContext.config.globalProperties.$onlyofficeBase),n=w(),i=R(()=>{let{url:r,name:c}=t.data;return{documentType:I(r),document:{fileType:f(r),key:q.encodeURL(r),title:c||"",url:r},editorConfig:{mode:"view",user:{group:"preview",id:"preview",name:"匿名"},customization:{compactHeader:!0,autosave:!0,forcesave:!1,layout:{editMode:!1,save:!1,users:!1},close:{visible:!1},logo:{visible:!1},submitForm:{visible:!1},wordHeadingsColor:"#165DFF"}}}});return(r,c)=>(h(),p("div",b,[E(a(A),{id:a(n),documentServerUrl:a(s),config:i.value},null,8,["id","documentServerUrl","config"])]))}}),L=l(P,[["__scopeId","data-v-17f5913d"]]);export{L as O};
