import{d as ae,ap as k,aq as de,T as M,a4 as w,r as h,ar as oe,o as ie,h as u,j as g,k as b,w as i,q as f,A as a,v as s,p as c,E as J,B as P,dN as R,dO as j,t as B,L as E,dP as se,dM as ne,Q as ue}from"./index-D9FXDxt4.js";import{E as re}from"./index-cP_cvVSk.js";import"./index-CSIXVJh0.js";import"./error-Cq9Fpw4b.js";const fe={style:{height:"70vh","overflow-y":"scroll"}},pe={class:"title-pannel"},ce={class:"pannel-title",style:{display:"flex","align-items":"center","justify-content":"space-between"}},me={class:"pannel-title",style:{display:"flex","align-items":"center","justify-content":"space-between"}},ye=ae({__name:"second-dialog",props:k({initData:{type:Object,default:()=>({})}},{modelValue:{},modelModifiers:{}}),emits:k(["success"],["update:modelValue"]),setup(D,{emit:z}){const r=D,F=z,T=de(D,"modelValue"),m=M(()=>!r.initData.code),I=M(()=>m.value?"新增二级类型":"编辑二级类型"),y=w([{fieldName:"发票类型",fieldKey:"invoiceType",fieldType:{show:!0,required:!1},fieldDesc:"select",fieldValue:""},{fieldName:"税率",fieldKey:"taxRate",fieldType:{show:!0,required:!1},fieldDesc:"select",fieldValue:[],fieldValue_code:[],_echoOptions:[]},{fieldName:"费用类型",fieldKey:"costTypeCode",fieldType:{show:!0,required:!0,disabled:!0},fieldDesc:"select",fieldValue:[],fieldValue_code:[],_echoOptions:[]},{fieldName:"成本中心",fieldKey:"costCenterCode",fieldType:{show:!0,required:!1},fieldDesc:"select",fieldValue:""},{fieldName:"预留质保金",fieldKey:"preWarrantyAmount",fieldType:{show:!0,required:!1},fieldDesc:"input",fieldValue:""},{fieldName:"费用期间",fieldKey:"feeTime",fieldType:{show:!0,required:!1},fieldDesc:"date",fieldValue:""},{fieldName:"履约延续",fieldKey:"autoExtend",fieldType:{show:!0,required:!1},fieldDesc:"select",fieldValue:""}]),V=w([{fieldName:"发票类型",fieldKey:"invoiceType",fieldType:{show:!0,required:!1},fieldDesc:"select",fieldValue:""},{fieldName:"税率",fieldKey:"taxRate",fieldType:{show:!0,required:!1},fieldDesc:"select",fieldValue:[],fieldValue_code:[],_echoOptions:[]},{fieldName:"费用类型",fieldKey:"costTypeCode",fieldType:{show:!0,required:!0,disabled:!0},fieldDesc:"select",fieldValue:[],fieldValue_code:[],_echoOptions:[]},{fieldName:"成本中心",fieldKey:"costCenterCode",fieldType:{show:!0,required:!1},fieldDesc:"select",fieldValue:""},{fieldName:"履约延续",fieldKey:"autoExtend",fieldType:{show:!0,required:!1},fieldDesc:"select",fieldValue:""}]),v={select:"列表",input:"文本",date:"日期"},A=h({code:"paymentSetTable",autoTable:!0,data:y,columns:[{label:"字段名称",prop:"fieldName"},{label:"显示/必填",prop:"fieldType",slot:"fieldType"},{label:"字段控件类型",prop:"fieldDesc",slot:"fieldDesc"},{label:"默认值",prop:"fieldValue",slot:"fieldValue"}]}),$=h({code:"collectionSetTable",autoTable:!0,data:V,columns:[{label:"字段名称",prop:"fieldName"},{label:"显示/必填",prop:"fieldType",slot:"fieldType"},{label:"字段控件类型",prop:"fieldDesc",slot:"fieldDesc"},{label:"默认值",prop:"fieldValue",slot:"fieldValue"}]}),{formData:o,formRef:L,requestSave:W}=oe(r,{typeLabel:"银行信息",convert(d){return d.id||(d.status="Y"),d}}),Y=[{fieldName:"发票类型",fieldKey:"invoiceType",fieldType:{show:!0,required:!1},fieldDesc:"select",fieldValue:""},{fieldName:"税率",fieldKey:"taxRate",fieldType:{show:!0,required:!1},fieldDesc:"select",fieldValue:[],fieldValue_code:[],_echoOptions:[]},{fieldName:"费用类型",fieldKey:"costTypeCode",fieldType:{show:!0,required:!0,disabled:!0},fieldDesc:"select",fieldValue:[],fieldValue_code:[],_echoOptions:[]},{fieldName:"成本中心",fieldKey:"costCenterCode",fieldType:{show:!0,required:!1},fieldDesc:"select",fieldValue:""},{fieldName:"预留质保金",fieldKey:"preWarrantyAmount",fieldType:{show:!0,required:!1},fieldDesc:"input",fieldValue:""},{fieldName:"费用期间",fieldKey:"feeTime",fieldType:{show:!0,required:!1},fieldDesc:"date",fieldValue:""},{fieldName:"履约延续",fieldKey:"autoExtend",fieldType:{show:!0,required:!1},fieldDesc:"select",fieldValue:""}],Q=[{fieldName:"发票类型",fieldKey:"invoiceType",fieldType:{show:!0,required:!1},fieldDesc:"select",fieldValue:""},{fieldName:"税率",fieldKey:"taxRate",fieldType:{show:!0,required:!1},fieldDesc:"select",fieldValue:[],fieldValue_code:[],_echoOptions:[]},{fieldName:"费用类型",fieldKey:"costTypeCode",fieldType:{show:!0,required:!0,disabled:!0},fieldDesc:"select",fieldValue:[],fieldValue_code:[],_echoOptions:[]},{fieldName:"成本中心",fieldKey:"costCenterCode",fieldType:{show:!0,required:!1},fieldDesc:"select",fieldValue:""},{fieldName:"履约延续",fieldKey:"autoExtend",fieldType:{show:!0,required:!1},fieldDesc:"select",fieldValue:""}],N=d=>{const e=d==="paymentSetProps"?"付款履约计划设置":"收款履约计划设置";re.confirm(`确定要重置${e}吗？此操作将重置现有数据。`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{d==="paymentSetProps"?Object.assign(y,JSON.parse(JSON.stringify(Y))):Object.assign(V,JSON.parse(JSON.stringify(Q))),E.success("重置成功")}).catch(()=>{})},Z=d=>{o.value.orgCode=d.selected.map(e=>e.departmentId),o.value.orgName=d.selected.map(e=>e.departmentName).join(",")};ie(()=>{console.log(r.initData,"props.initData"),r.initData.paymentSet&&(console.log(r.initData.paymentSet,"props.initData.paymentSet"),Object.assign(y,JSON.parse(r.initData.paymentSet))),r.initData.collectionSet&&(console.log(r.initData.collectionSet,"props.initData.collectionSet"),Object.assign(V,JSON.parse(r.initData.collectionSet))),m.value||(o.value=r.initData,o.value.orgCode=o.value.orgCode.split(",").map(d=>String(d)))});const G={name:[{required:!0,message:"请输入业务类型",trigger:"blur"}],code:[{required:!0,message:"请输入类型编码",trigger:"blur"},{pattern:/^[A-Za-z0-9\p{P}]+$/u,message:"只能输入英文、数字和符号",trigger:"blur"}],pname:[{required:!0,message:"请输入上级类型",trigger:["blur","change"]}],status:[{required:!0,message:"请选择状态",trigger:["blur","change"]}],orgCode:[{required:!0,message:"请选择可用部门",trigger:["blur","change"]}]};h([{value:o.value.parentId,label:o.value.parentBankName}]);const C=(d,e)=>{e.fieldValue=d.selected.map(n=>({costTypeCode:n.value,costTypeName:n.label})),e._echoOptions=d.selected.map(n=>({value:n.value,label:n.label}))},S=(d,e)=>{e.fieldValue=d.selected.map(n=>({value:n.value,label:n.label})),e._echoOptions=d.selected.map(n=>({value:n.value,label:n.label}))},H=d=>{W(m.value?se:ne,e=>(console.log(e,"data"),m.value?{...e,paymentSet:JSON.stringify(y),collectionSet:JSON.stringify(V),orgCode:e.orgCode.join(",")}:{...e,paymentSet:JSON.stringify(y),collectionSet:JSON.stringify(V),orgCode:e.orgCode.join(",")})).then(e=>{E.success("保存成功"),F("success",e),d.value=!1,T.value=!1}).catch(e=>{console.log(e),d.value=!1})};return(d,e)=>{const n=u("el-input"),p=u("el-form-item"),x=u("el-radio"),X=u("el-radio-group"),ee=u("OrgSelectTree"),q=u("el-button"),_=u("el-checkbox"),O=u("fs-select"),K=u("form-select-v2"),U=u("complex-table"),le=u("el-form"),te=u("complex-dialog");return b(),g(te,{modelValue:T.value,"onUpdate:modelValue":e[8]||(e[8]=l=>T.value=l),width:"1200px",title:I.value,onSubmit:H},{default:i(()=>[f("div",fe,[f("div",pe,[a(le,{ref_key:"formRef",ref:L,class:"radius-box",model:s(o),"label-width":"130px",rules:G,style:{padding:"12px"}},{default:i(()=>[e[15]||(e[15]=f("div",{class:"pannel-title"},"基本信息",-1)),a(p,{label:"二级类型",prop:"name"},{default:i(()=>[a(n,{placeholder:"请输入二级类型",maxlength:50,"show-word-limit":"",clearable:"",modelValue:s(o).name,"onUpdate:modelValue":e[0]||(e[0]=l=>s(o).name=l),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),a(p,{label:"类型编码",prop:"code"},{default:i(()=>[a(n,{placeholder:"请输入类型编码",maxlength:50,"show-word-limit":"",disabled:!m.value,clearable:"",modelValue:s(o).code,"onUpdate:modelValue":e[1]||(e[1]=l=>s(o).code=l),modelModifiers:{trim:!0}},null,8,["disabled","modelValue"])]),_:1}),a(p,{label:"上级类型",prop:"pname"},{default:i(()=>[a(n,{placeholder:"请输入上级类型",disabled:"",maxlength:50,clearable:"",modelValue:s(o).pname,"onUpdate:modelValue":e[2]||(e[2]=l=>s(o).pname=l),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),a(p,{label:"状态",prop:"status"},{default:i(()=>[a(X,{modelValue:s(o).status,"onUpdate:modelValue":e[3]||(e[3]=l=>s(o).status=l)},{default:i(()=>[a(x,{label:"Y"},{default:i(()=>e[9]||(e[9]=[c("启用")])),_:1,__:[9]}),a(x,{label:"N"},{default:i(()=>e[10]||(e[10]=[c("禁用")])),_:1,__:[10]})]),_:1},8,["modelValue"])]),_:1}),e[16]||(e[16]=f("div",{class:"pannel-title"},"可用部门",-1)),a(p,{label:"可用部门",prop:"orgCode"},{default:i(()=>[a(ee,{modelValue:s(o).orgCode,"onUpdate:modelValue":e[4]||(e[4]=l=>s(o).orgCode=l),placeholder:"请选择可用部门",multiple:!0,clearable:!0,onChange:Z,props:{key:"departmentId",label:"departmentName"}},null,8,["modelValue"])]),_:1}),e[17]||(e[17]=f("div",{class:"pannel-title"},"类型描述",-1)),a(p,{label:"类型描述",prop:"remark"},{default:i(()=>[a(n,{type:"textarea",rows:5,maxlength:200,"show-word-limit":"",placeholder:"请输入类型描述",modelValue:s(o).remark,"onUpdate:modelValue":e[5]||(e[5]=l=>s(o).remark=l),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),f("div",ce,[e[12]||(e[12]=f("span",null,"付款履约计划设置",-1)),a(q,{size:"small",type:"info",onClick:e[6]||(e[6]=l=>N("paymentSetProps"))},{default:i(()=>e[11]||(e[11]=[c("重置")])),_:1,__:[11]})]),a(U,J({style:{"margin-bottom":"12px"}},A.value),{fieldType:i(({row:l})=>[a(_,{modelValue:l.fieldType.show,"onUpdate:modelValue":t=>l.fieldType.show=t,disabled:l.fieldType.disabled||!1,label:"显示",size:"large"},null,8,["modelValue","onUpdate:modelValue","disabled"]),a(_,{modelValue:l.fieldType.required,"onUpdate:modelValue":t=>l.fieldType.required=t,disabled:l.fieldType.disabled||!1,label:"必填",size:"large"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),fieldDesc:i(({row:l})=>[c(B(v[l.fieldDesc]),1)]),fieldValue:i(({row:l})=>[l.fieldDesc=="select"&&["taxRate"].includes(l.fieldKey)?(b(),g(O,{key:0,modelValue:l.fieldValue_code,"onUpdate:modelValue":t=>l.fieldValue_code=t,multiple:"",options:s(R)(),onChange:t=>S(t,l)},null,8,["modelValue","onUpdate:modelValue","options","onChange"])):l.fieldDesc=="select"&&["costTypeCode"].includes(l.fieldKey)?(b(),g(K,{key:1,modelValue:l.fieldValue_code,"onUpdate:modelValue":t=>l.fieldValue_code=t,"echo-options":l._echoOptions,multiple:"",clearable:"","search-method":s(j),onChange:t=>C(t,l)},null,8,["modelValue","onUpdate:modelValue","echo-options","search-method","onChange"])):P("",!0)]),_:1},16),f("div",me,[e[14]||(e[14]=f("span",null,"收款履约计划设置",-1)),a(q,{size:"small",type:"info",onClick:e[7]||(e[7]=l=>N("collectionSetProps"))},{default:i(()=>e[13]||(e[13]=[c("重置")])),_:1,__:[13]})]),a(U,J({style:{"margin-bottom":"12px"}},$.value),{fieldType:i(({row:l})=>[a(_,{modelValue:l.fieldType.show,"onUpdate:modelValue":t=>l.fieldType.show=t,label:"显示",disabled:l.fieldType.disabled||!1,size:"large"},null,8,["modelValue","onUpdate:modelValue","disabled"]),a(_,{modelValue:l.fieldType.required,"onUpdate:modelValue":t=>l.fieldType.required=t,label:"必填",disabled:l.fieldType.disabled||!1,size:"large"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),fieldDesc:i(({row:l})=>[c(B(v[l.fieldDesc]),1)]),fieldValue:i(({row:l})=>[l.fieldDesc=="select"&&["taxRate"].includes(l.fieldKey)?(b(),g(O,{key:0,modelValue:l.fieldValue_code,"onUpdate:modelValue":t=>l.fieldValue_code=t,"echo-options":l._echoOptions,multiple:"",clearable:"",options:s(R)(),onChange:t=>S(t,l)},null,8,["modelValue","onUpdate:modelValue","echo-options","options","onChange"])):l.fieldDesc=="select"&&["costTypeCode"].includes(l.fieldKey)?(b(),g(K,{key:1,modelValue:l.fieldValue_code,"onUpdate:modelValue":t=>l.fieldValue_code=t,"echo-options":l._echoOptions,multiple:"",clearable:"","search-method":s(j),onChange:t=>C(t,l)},null,8,["modelValue","onUpdate:modelValue","echo-options","search-method","onChange"])):P("",!0)]),_:1},16)]),_:1,__:[15,16,17]},8,["model"])])])]),_:1},8,["modelValue","title"])}}}),Te=ue(ye,[["__scopeId","data-v-bd20b30f"]]);export{Te as default};
