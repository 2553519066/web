import{d as q,ap as O,u as U,aH as L,r as f,T as _,aq as z,as as H,h as u,j as h,k as b,l as A,w as t,q as c,t as r,p as n,y as Q,B as C,A as i,v as N,x as W,E as G,L as J,Q as K}from"./index-7XFzyDag.js";import{E as X,F as Y,x as Z}from"./add-order-DAdKgSzy.js";import{t as aa}from"./index-Di87H6f7.js";import{v as ea}from"./format-CF8vQ7ct.js";const ta={class:"dia-header"},la={key:0,style:{"background-color":"#fff",padding:"10px"}},na={style:{padding:"10px","background-color":"#fff"}},ia="performance",oa=q({name:ia,__name:"form-dialogly",props:O({initData:{type:Object,default:()=>({})},isBatch:{type:Boolean,default:!1},isRepeal:{type:Boolean,default:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(g){var V;const B=U(),F=L(),a=g,s=f(),S=()=>{if(s.value){let l=s.value;Number(l)>Number(D.value)&&(l=D.value),s.value=Number(l).toFixed(2)}},k=_(()=>"合同履约"),p=z(g,"modelValue"),x=_(()=>{const l=a.initData,e={companyPrefix:"付款公司",partyCode:l.payPartyCode,partyName:l.payPartyName};return l.financeType!="INCOME"&&(e.companyPrefix="收款公司",e.partyCode=l.receivePartyCode,e.partyName=l.receivePartyName),e}),T=l=>{if(s.value){const e={contractId:a.initData.contractId,currentAmount:s.value-0,id:a.initData.id};X(e).then(d=>{l.value=!1,p.value=!1,aa({submitId:d})}).catch(()=>{l.value=!1})}else J.error("本次申请金额不能为空"),l.value=!1},P=l=>{p.value=!1,B.push({name:"ContractDetails",params:{code:l.contractCode}})},y=f({code:"Table2",autoTable:!1,data:a.initData.plainRecordDetails,columns:[{label:"申请时间",prop:"processStartTime"},{label:"申请金额",prop:"amount",formatter:H},{label:"申请人",prop:"createUserName"},{label:"submitld",prop:"batchSubmitId"}]});a.isRepeal&&((V=y.value.columns)==null||V.push({label:"操作",prop:"op",slot:"op",width:"80px"}));const v=f(a.initData.amountApply),D=f(a.initData.applicableAmount),I=_(()=>{const l=a.initData.amount||0,e=a.initData.amountFinish||0,d=v.value||0,o=l-e-d;return Math.max(0,o)}),R=l=>{Y({id:l.id}).then(()=>{Z({id:a.initData.id}).then(e=>{y.value.data=e.plainRecordDetails,v.value=e.amountApply,D.value=e.applicableAmount})})};return(l,e)=>{const d=u("el-link"),o=u("el-descriptions-item"),M=u("el-input"),$=u("el-descriptions"),E=u("FsButton"),w=u("complex-table"),j=u("complex-dialog");return b(),h(j,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=m=>p.value=m),width:"1000px",title:k.value,hideConfirm:!a.initData.lvyue,onSubmit:T},A({default:t(()=>[a.isBatch?C("",!0):(b(),Q("div",la,[i($,{column:3,border:""},{extra:t(()=>[i(d,{underline:!1,type:"primary",onClick:e[0]||(e[0]=m=>P(a.initData))},{default:t(()=>[n(r(a.initData.contractName),1)]),_:1})]),default:t(()=>[i(o,{label:"履约节点","label-align":"right",align:"center","label-class-name":"my-label","class-name":"my-content"},{default:t(()=>[n(r(a.initData.name),1)]),_:1}),i(o,{label:"要求履约时间","label-align":"right",align:"center"},{default:t(()=>[n(r(N(W)(a.initData.fulfillDate)),1)]),_:1}),i(o,{label:"成本中心","label-align":"right",align:"center"},{default:t(()=>[n(r(a.initData.costCenterName)+r(a.initData.costCenterCode?`[${a.initData.costCenterCode}]`:""),1)]),_:1}),i(o,{label:"收支类型","label-align":"right",align:"center"},{default:t(()=>[n(r(a.initData.financeTypeName),1)]),_:1}),i(o,{label:a.initData.financeType==="INCOME"?"收款含税金额":"付款含税金额","label-align":"right",align:"center"},{default:t(()=>[n(r(l.$format.thousandsFormatCurrency(a.initData.amount)),1)]),_:1},8,["label"]),i(o,{label:"发票类型","label-align":"right",align:"center"},{default:t(()=>[n(r(a.initData.invoiceTypeName),1)]),_:1}),i(o,{label:"税率","label-align":"right",align:"center"},{default:t(()=>[n(r(N(ea)(a.initData.taxRate)),1)]),_:1}),i(o,{label:x.value.companyPrefix,"label-align":"right",align:"center"},{default:t(()=>[n(r(x.value.partyName),1)]),_:1},8,["label"]),i(o,{label:"费用类型","label-align":"right",align:"center"},{default:t(()=>[n(r(a.initData.costTypeName),1)]),_:1}),i(o,{label:"银行","label-align":"right",align:"center"},{default:t(()=>[n(r(a.initData.bank),1)]),_:1}),i(o,{label:"账号名","label-align":"right",align:"center"},{default:t(()=>[n(r(a.initData.accountName),1)]),_:1}),i(o,{label:"银行卡号","label-align":"right",align:"center"},{default:t(()=>[n(r(a.initData.bankAccount),1)]),_:1}),i(o,{label:"履约审批流程","label-align":"right",align:"center"},{default:t(()=>[n(r(a.initData.processInstanceName),1)]),_:1}),i(o,{label:"已付金额","label-align":"right",align:"center"},{default:t(()=>[n(r(l.$format.thousandsFormatCurrency(a.initData.amountFinish)),1)]),_:1}),i(o,{label:"在途金额","label-align":"right",align:"center"},{default:t(()=>[n(r(l.$format.thousandsFormatCurrency(v.value)),1)]),_:1}),i(o,{label:"预留质保金","label-align":"right",align:"center"},{default:t(()=>[n(r(l.$format.thousandsFormatCurrency(a.initData.preWarrantyAmount||0)),1)]),_:1}),i(o,{label:"可申请金额","label-align":"right",align:"center"},{default:t(()=>[n(r(l.$format.thousandsFormatCurrency(I.value)),1)]),_:1}),a.initData.lvyue?C("",!0):(b(),h(o,{key:0,label:"履约状态","label-align":"right",align:"center"},{default:t(()=>[n(r(N(F).valueToLabelSync(a.initData.fulfillStatus,"fulfill_status")),1)]),_:1})),a.initData.lvyue?(b(),h(o,{key:1,label:"本次申请金额","label-align":"right",align:"center"},{label:t(()=>e[4]||(e[4]=[c("span",{style:{color:"red"}},"*",-1),n("本次申请金额")])),default:t(()=>[i(M,{modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=m=>s.value=m),oninput:"value = value.replace(/[^\\d|\\.]/g, '')",onBlur:S},null,8,["modelValue"])]),_:1})):C("",!0)]),_:1})])),c("div",na,[e[6]||(e[6]=c("span",null,"正在费控提交确认金额:",-1)),i(w,G({ref:"priorApplicationRef"},y.value),A({_:2},[g.isRepeal?{name:"op",fn:t(({row:m})=>[i(E,{"show-loading":!1,link:"",type:"primary",onClick:ra=>R(m)},{default:t(()=>e[5]||(e[5]=[n(" 作废 ")])),_:2,__:[5]},1032,["onClick"])]),key:"0"}:void 0]),1040)])]),_:2},[a.initData.lvyue&&!a.isBatch?{name:"header",fn:t(()=>[c("div",ta,[c("div",null,r(k.value),1),e[3]||(e[3]=c("div",{class:"btxms"},[c("span",{style:{color:"red"}},"*"),n("为必填项")],-1))])]),key:"0"}:void 0]),1032,["modelValue","title","hideConfirm"])}}}),da=K(oa,[["__scopeId","data-v-ea89f843"]]);export{da as default};
