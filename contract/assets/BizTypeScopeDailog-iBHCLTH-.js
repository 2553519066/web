import{Q as R,y as B,k as f,aU as Ce,d as U,ap as I,aq as W,r as c,dD as q,h as r,j as T,B as A,A as l,a9 as we,dR as Le,w as n,p as O,t as k,q as h,F as M,aa as xe,E as F,T as $,b5 as ze,ax as Te,ar as ke,o as Be,i as Ve,m as De,v as z,z as K,av as Fe,cG as Se,R as Ne,L as E,dS as G,H as Oe,dT as $e,dU as Ie}from"./index-BbO6UiJA.js";import{I as Me}from"./icon-download-CQu_5z30.js";import{b as Re,c as Ue,d as Z,e as Q,f as Ee,h as qe}from"./index-Bvllfd3s.js";import{b as Ae}from"./index-CC7IV6J8.js";import"./index-G1vWk1G8.js";import"./error-Cq9Fpw4b.js";const Pe={},je={width:"16px",height:"16px",viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"};function He(t,s){return f(),B("svg",je,s[0]||(s[0]=[Ce('<title>xlsx</title><g id="财税通WEB" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="iconSVG导出" transform="translate(-271.000000, -914.000000)" fill-rule="nonzero"><g id="xlsx" transform="translate(271.000000, 914.000000)"><rect id="矩形" fill="#000000" opacity="0" x="0" y="0" width="16" height="16"></rect><path d="M14.2224063,16 L1.77759375,16 C0.8,16 0,15.2 0,14.2224063 L0,1.77759375 C0,0.8 0.8,0 1.77759375,0 L14.2224062,0 C15.2,0 16,0.8 16,1.77759375 L16,14.2224062 C16,15.2 15.2,16 14.2224063,16 Z M11.8431875,12.706 L8.86,7.96040625 L11.8012031,3.29359375 L10.4092031,3.29359375 L8.46520313,6.52040625 C8.33396215,6.74711034 8.21433881,6.98034403 8.10679688,7.21920312 L8.08240625,7.21920312 C7.98594808,6.99031053 7.87643474,6.76714162 7.75440625,6.55079687 L5.89479688,3.29359375 L4.40640625,3.29359375 L7.28640625,7.97879688 L4.1571875,12.706 L5.63959375,12.706 L7.8028125,9.17 C7.9408125,8.874 8.01360937,8.71 8.02160938,8.678 L8.05201563,8.678 C8.14560938,8.92040625 8.21601563,9.08279688 8.26482813,9.16359375 L10.3671875,12.706 L11.8435938,12.706 L11.8431875,12.706 Z" id="形状" fill="#039E55"></path></g></g></g>',2)]))}const Ke=R(Pe,[["render",He]]);function Ge(t,s){let d="";return t.name.lastIndexOf(".")>-1&&(d=t.name.slice(t.name.lastIndexOf(".")+1)),s.some(p=>!!(t.type&&t.type.indexOf(p)>-1||d&&d.indexOf(p)>-1))?!0:`文件格式不正确, 请上传${s.join("/")}格式文件!`}function Ze(t,s){return s>0?t.size/1024/1024<=s?!0:`上传文件大小不能超过 ${s} MB!`:!0}const Qe={class:"radius-box import-content"},We={class:"file-tip"},Xe={class:"file-text"},Je={class:"file-tip"},Ye=U({name:"ImportContent",inheritAttrs:!1,__name:"import-content",props:I({modelValue:{},downloadFun:{},downloadText:{default:"模版下载"},accept:{default:".xls,.xlsx"},size:{default:5}},{modelValue:{},modelModifiers:{}}),emits:I(["file-change"],["update:modelValue"]),setup(t,{emit:s}){const d=t,C=s,p=W(t,"modelValue"),y=c(null),v=c({drag:!0,action:"#",showFileList:!1,accept:d.accept,limit:1,onChange(i,o){if(i.status==="ready"){let w=Ge(i,d.accept.split(",").map(_=>_.replace(".","")));if(w!==!0)return q.warning(w);if(w=Ze(i,d.size),w!==!0)return q.warning(w);p.value=i,y.value.clearFiles(),C("file-change",i)}},autoUpload:!1});c(!1);const b=i=>{d.downloadFun().finally(()=>{i.done()})};return(i,o)=>{const w=r("el-upload");return f(),B("div",Qe,[i.downloadFun?(f(),T(Le,{key:0,type:"primary",link:"",icon:Me,onClick:b},{default:n(()=>[O(k(i.downloadText),1)]),_:1})):A("",!0),l(w,F({ref_key:"uploadRef",ref:y},v.value),{default:n(()=>[h("div",{class:xe(["upload-area",p.value?"has-file":""])},[p.value?(f(),B(M,{key:1},[h("div",Xe,[l(Ke,{style:{"vertical-align":"sub","margin-right":"3px"}}),h("span",null,k(p.value.name),1)]),h("div",Je,[O(" 请上传文件为.xls,.xlsx格式，大小小于 "+k(i.size)+"M ",1),o[1]||(o[1]=h("span",{class:"primary"},"重新上传",-1))])],64)):(f(),B(M,{key:0},[o[0]||(o[0]=h("div",{class:"upload-text"},[h("span",{class:"primary"},"点击上传"),O(" / 拖拽到此区域")],-1)),h("div",We,"上传文件为"+k(i.accept)+"格式，大小小于"+k(i.size)+"M",1)],64))],2)]),_:1},16),we(i.$slots,"default",{},void 0,!0)])}}}),eo=R(Ye,[["__scopeId","data-v-657c912d"]]),oo={class:"success"},ao={class:"fail"},lo=U({name:"ImportResult",__name:"result",props:{resData:{type:Object,default:()=>({})},fileName:{type:String,default:""},failDownloadFun:{type:Function,default:null}},setup(t){const s=t,d=$(()=>{let C=s.fileName.lastIndexOf(".");return{params:{url:s.resData.failUrl},fileName:`${s.fileName.substring(0,C)}-失败数据${s.fileName.substring(C)}`}});return(C,p)=>{const y=r("SuccessFilled"),v=r("el-icon"),b=r("RemoveFilled"),i=r("el-space");return f(),T(i,{class:"result-preview"},{default:n(()=>[p[0]||(p[0]=h("div",{class:"preview-label"},"结果预览：",-1)),h("div",oo,[l(v,{size:16,style:{color:"var(--el-color-primary)"}},{default:n(()=>[l(y)]),_:1}),h("span",null,"成功（"+k(t.resData.successCount)+"）",1)]),h("div",ao,[l(v,{size:16,style:{color:"var(--el-color-danger)"}},{default:n(()=>[l(b)]),_:1}),h("span",null,"失败（"+k(t.resData.failCount)+"）",1)]),t.resData.failUrl?(f(),T(ze,F({key:0,size:"small",link:"",text:"下载失败数据"},d.value,{requestMethod:t.failDownloadFun}),null,16,["requestMethod"])):A("",!0)]),_:1,__:[0]})}}}),to=R(lo,[["__scopeId","data-v-2767846b"]]),no={key:0,style:{"text-align":"center","margin-top":"24px"}},so=U({name:"ComplexImport",inheritAttrs:!1,__name:"import",props:I({successClose:{type:Boolean},hideFoot:{type:Boolean},hideCancel:{type:Boolean},hideConfirm:{type:Boolean},confirmText:{},cancelText:{},importFun:{},contentProps:{},showErrorData:{type:Boolean,default:!1},failDownloadFun:{}},{modelValue:{},modelModifiers:{}}),emits:I(["success"],["update:modelValue"]),setup(t,{emit:s}){const d=t,C=s,p=W(t,"modelValue"),y=c(),v=c(0),b=c(null),i=_=>{v.value=Math.round(_.loaded*100/_.total)},o=_=>{if(!y.value){q.warning("请先选择文件"),_.value=!1;return}b.value=null,d.importFun(y.value,i).then(x=>{if(d.showErrorData&&x.failUrl){b.value=x;return}C("success",x),p.value=!1}).finally(()=>{_.value=!1})},w=()=>{b.value=null};return(_,x)=>(f(),T(Te,F({modelValue:p.value,"onUpdate:modelValue":x[1]||(x[1]=V=>p.value=V),width:"434px","confirm-text":"导入"},_.$attrs,{onSubmit:o}),{default:n(()=>[l(eo,F({modelValue:y.value,"onUpdate:modelValue":x[0]||(x[0]=V=>y.value=V)},_.contentProps,{onFileChange:w}),{default:n(()=>[_.showErrorData&&b.value?(f(),B("div",no,[l(to,{"res-data":b.value,"file-name":y.value?y.value.name:"",failDownloadFun:_.failDownloadFun},null,8,["res-data","file-name","failDownloadFun"])])):A("",!0)]),_:1},16,["modelValue"])]),_:1},16,["modelValue"]))}}),io={class:"select-table"},ro=U({__name:"BizTypeScopeDailog",props:{modelValue:{type:Boolean,default:()=>!1},initData:{type:Object,default:()=>({})}},emits:["update:modelValue","success"],setup(t,{emit:s}){const d=t,C=s,p=e=>{C("update:modelValue",e)},y=c(),v=c(!1),{isAdd:b,loading:i,formData:o,formRef:w,requestSave:_}=ke(d,{typeLabel:"",convert(e){return e.id||(e.companyList=[],e.contractBusinessTypeList=[]),e.id&&(e={id:e.id,groupId:e.groupId,companyList:e.companyList,contractBusinessTypeList:e.contractBizTypeList,bizType:e.bizType}),e.bizType,e}}),x=c({bizType:[{required:!0,message:"请选择菜单权限"}],companyList:[{type:"array",required:!0,message:"请添加经营单位"}],contractBusinessTypeList:[{type:"array",required:!0,message:"请添加合同业务类型"}]}),V={bizColumnList:[{title:"序号",key:"index",dataKey:"index",cellRenderer:({rowIndex:e})=>e+1,width:70},{title:"经营单位编码",key:"companyCode",dataKey:"companyCode",width:160},{title:"经营单位名称",key:"companyName",dataKey:"companyName",width:380},{title:"操作",key:"action",dataKey:"action",cellRenderer:({rowData:e})=>Ne(Ae,{type:"danger",link:!0,size:"small",onClick:()=>{if(o.value.companyList&&Array.isArray(o.value.companyList)){let a=o.value.companyList.findIndex(u=>u.companyCode===e.companyCode);a!==-1&&o.value.companyList.splice(a,1)}}},()=>"删除"),width:60}],commonProps:{border:!0,cache:5,headerHeight:40,rowHeight:40}};c([]),c(1);const S=c([]),P=c([]),X=()=>{v.value=!0,Re().then(e=>{S.value=e}).finally(()=>{v.value=!1})},J=()=>{v.value=!0,Ue().then(e=>{P.value=e}).finally(()=>{v.value=!1})},D=$(()=>S.value.find(e=>e.typeCode==o.value.bizType)||{additionalConfig:[]}),Y=()=>{console.log(o.value,S.value),console.log(b.value,Z,Q),_(b.value?Z:Q,e=>{console.log(e);const{companyList:a,contractBusinessTypeList:u,bizType:L}=e;return e.authMenu=L,delete e.bizType,e}).then(e=>{E.success("保存成功"),C("success",e)})},ee=e=>{console.log(e,o.value.bizType),y.value.handelSearch(N.value.bizScopeCodeOrName)},oe=async({value:e,selected:a})=>{if(!o.value.companyList.find(u=>u.companyCode==e))if((e=="-1"||o.value.companyList[0]&&o.value.companyList[0].companyCode=="-1")&&(o.value.companyList=[]),e=="-1")try{v.value=!0;const u=await G("",{orgType:D.value?D.value.permissionType:"",pageSize:999999});u.forEach(L=>{o.value.companyList.push({companyCode:L.value,companyName:L.label})}),E.success(`已成功导入 ${u.length} 条经营单位数据`)}catch(u){console.error("获取全部数据失败:",u),E.error("获取全部数据失败")}finally{v.value=!1}else o.value.companyList.unshift({companyCode:a.value,companyName:a.oldLabel||a.label})},ae=e=>new Promise((a,u)=>{G(e,{orgType:D.value?D.value.permissionType:""}).then(L=>{a([{key:"-1",value:"-1",label:"全部"},...L.map(g=>({id:g.id,key:g.id,label:`${g.label}[${g.value}]`,value:g.value,oldLabel:g.label}))])}).catch(u)});X(),J();const le=async()=>{let{data:e}=await Oe({body:so,bodyData:{title:"经营单位导入",importFun:(u,L)=>qe({data:{file:u.raw,type:D.value?D.value.permissionType:""},onUploadProgress:L}),contentProps:{downloadFun:Ee},showErrorData:!0,failDownloadFun:$e}});const a=e.dataList||[];o.value.companyList[0]&&o.value.companyList[0].companyCode=="-1"&&(o.value.companyList=[]),a.forEach(u=>{o.value.companyList.find(g=>g.companyCode===u.companyCode)||o.value.companyList.push({companyCode:u.companyCode,companyName:u.companyName})})},j=c({bizScopeCodeOrName:"",supplierCodeOrName:""}),N=c({bizScopeCodeOrName:"",supplierCodeOrName:""}),te=$(()=>{let e=N.value.bizScopeCodeOrName;return e?o.value.companyList.filter(a=>a.companyName.indexOf(e)>-1||a.companyCode.indexOf(e)>-1):o.value.companyList});$(()=>{let e=N.value.supplierCodeOrName;return e?o.value.supplierList.filter(a=>a.value.indexOf(e)>-1||a.label.indexOf(e)>-1):o.value.supplierList});const ne=e=>{N.value.bizScopeCodeOrName=e};c();const se=c([]),ie=()=>{Ie().then(e=>{se.value=e}).catch(e=>{console.log("获取单据类型失败")})};return Be(()=>{ie()}),(e,a)=>{const u=r("el-radio"),L=r("el-radio-group"),g=r("el-form-item"),re=r("FsButton"),ue=r("el-divider"),ce=r("el-input"),de=r("el-space"),pe=r("el-table-v2"),me=r("el-auto-resizer"),H=r("el-col"),fe=r("el-option"),ye=r("el-select"),ve=r("el-row"),_e=r("el-form"),he=r("FsCommonDialog"),ge=Ve("loading");return f(),T(he,F({"model-value":t.modelValue,title:"分配数据权限范围",loading:z(i),width:"1300px"},e.$attrs,{top:"50px","onUpdate:modelValue":p,onSubmit:Y}),{default:n(()=>[De((f(),T(_e,{ref_key:"formRef",ref:w,model:z(o),rules:x.value,"label-width":"80px"},{default:n(()=>[l(g,{label:"菜单权限",prop:"bizType"},{default:n(()=>[l(L,{modelValue:z(o).bizType,"onUpdate:modelValue":a[0]||(a[0]=m=>z(o).bizType=m),onChange:ee},{default:n(()=>[(f(!0),B(M,null,K(S.value,m=>(f(),T(u,{key:m.key,label:m.value,value:m.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(ve,null,{default:n(()=>[l(H,{span:12},{default:n(()=>[l(g,{label:"经营单位",required:""},{default:n(()=>[l(de,null,{default:n(()=>[l(z(Fe),{ref_key:"bizScopeSelectRef",ref:y,"search-method":ae,openHandle:!0,placeholder:"请选择经营单位",clearable:"",onChange:oe,style:{width:"240px"}},null,512),l(re,{"show-loading":!1,size:"default",type:"primary",onClick:le},{default:n(()=>a[3]||(a[3]=[O("导入")])),_:1,__:[3]}),l(ue,{direction:"vertical"}),l(ce,{modelValue:j.value.bizScopeCodeOrName,"onUpdate:modelValue":a[1]||(a[1]=m=>j.value.bizScopeCodeOrName=m),clearable:"","prefix-icon":z(Se),onChange:ne,placeholder:"请输入",style:{width:"210px"}},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1}),l(g,{prop:"companyList"},{default:n(()=>[h("div",io,[l(me,null,{default:n(({height:m,width:be})=>[l(pe,F({"row-key":"bizCode",columns:V.bizColumnList,data:te.value,width:be,height:m},V.commonProps),null,16,["columns","data","width","height"])]),_:1})])]),_:1})]),_:1}),l(H,{span:12},{default:n(()=>[l(g,{prop:"contractBusinessTypeList",label:"选择合同业务类型","label-width":"140px",required:""},{default:n(()=>[l(ye,{modelValue:z(o).contractBusinessTypeList,"onUpdate:modelValue":a[2]||(a[2]=m=>z(o).contractBusinessTypeList=m),"value-key":"businessTypeCode",multiple:"",placeholder:"选择合同类型",style:{width:"240px"}},{default:n(()=>[(f(!0),B(M,null,K(P.value,m=>(f(),T(fe,{key:m.code,label:m.name,value:{businessTypeCode:m.code,businessTypeName:m.name}},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[ge,v.value]])]),_:1},16,["model-value","loading"])}}}),vo=R(ro,[["__scopeId","data-v-1052f69f"]]);export{vo as default};
