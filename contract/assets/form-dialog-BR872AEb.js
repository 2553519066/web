import{d as q,h as f,j as F,k as T,w as b,q as w,A as d,B as oe,Q as S,r as k,y as z,t as Y,F as te,z as se,D as ne,ap as J,aq as le,T as K,ar as ce,a4 as me,o as pe,cd as N,L as Q,dI as ie,dJ as de,cc as fe,dK as ue}from"./index-Cyvvb__l.js";const ge={class:"flex-center"},ye=q({__name:"ProcessFormItem",props:{label:{},prop:{},modelValue:{},modelName:{},initOptions:{},searchMethod:{type:Function},showCopyIcon:{type:Boolean},copyDown:{type:Function}},emits:["update:modelValue","change"],setup(C,{emit:v}){return console.log(C,"props"),(n,i)=>{const a=f("form-select-v2"),y=f("fs-svg-icon"),h=f("el-form-item");return T(),F(h,{label:n.label,prop:n.prop},{default:b(()=>[w("div",ge,[d(a,{modelValue:n.modelValue,"onUpdate:modelValue":i[0]||(i[0]=c=>n.$emit("update:modelValue",c)),onChange:i[1]||(i[1]=c=>n.$emit("change",c)),searchMethod:n.searchMethod,"echo-options":[{value:n.modelValue,label:n.modelName}],showValue:""},null,8,["modelValue","searchMethod","echo-options"]),n.showCopyIcon?(T(),F(y,{key:0,class:"icon",name:"business-copy-down",onClick:n.copyDown},null,8,["onClick"])):oe("",!0)])]),_:1},8,["label","prop"])}}}),Ce=S(ye,[["__scopeId","data-v-293b2441"]]),De={class:"pannel-title"},be={class:"pannel-content"},Te=q({name:"ProcessPanel",__name:"ProcessPanel",props:{formType:{},formNameType:{},formFields:{},processesFormData:{},processesRules:{},selectData:{},getSubjectPage:{type:Function},copyDown:{type:Function},panelTitle:{},panelStyle:{}},setup(C,{expose:v}){const p=k(null),n=C;console.log(n);const i=(a,y)=>{n.processesFormData[n.formType][a]=y.value,n.processesFormData[n.formNameType][a]=y.label};return v({formRef:p}),(a,y)=>{const h=f("el-form");return T(),z("div",{class:"title-pannel",style:ne(a.panelStyle)},[w("div",De,[w("span",null,Y(a.panelTitle),1)]),w("div",be,[d(h,{model:a.processesFormData,ref_key:"formRef",ref:p,rules:a.processesRules,"label-width":"100px",style:{padding:"12px"}},{default:b(()=>[(T(!0),z(te,null,se(a.formFields,(c,P)=>(T(),F(Ce,{key:P,label:c.label,showCopyIcon:c.prop!=="frameworkOrder",prop:`${a.formType}.${c.prop}`,modelValue:a.processesFormData[a.formType][c.prop],modelName:a.processesFormData[a.formNameType][c.prop],"onUpdate:modelValue":_=>a.processesFormData[a.formType][c.prop]=_,onChange:_=>i(c.prop,_),initOptions:a.selectData,searchMethod:a.getSubjectPage,copyDown:()=>a.copyDown(a.formType,c.prop)},null,8,["label","showCopyIcon","prop","modelValue","modelName","onUpdate:modelValue","onChange","initOptions","searchMethod","copyDown"]))),128))]),_:1},8,["model","rules"])])],4)}}}),R=S(Te,[["__scopeId","data-v-4d78f7c7"]]),we={class:"el-checkbox__label",style:{"padding-left":"0"}},he={style:{display:"grid","grid-template-columns":"repeat(3, 1fr)"}},_e=q({__name:"form-dialog",props:J({initData:{type:Object,default:()=>({})}},{modelValue:{},modelModifiers:{}}),emits:J(["success"],["update:modelValue"]),setup(C,{emit:v}){const p=C,n=v,i=le(C,"modelValue"),a=K(()=>!p.initData.id),y=K(()=>a.value?"选择业务类型":"选择业务类型 "),{requestSave:h}=ce(p,{typeLabel:"银行信息",convert(r){return r}}),c={draft:{oneTimeContract:[{required:!0,message:"请选择一次性合同",trigger:"change"}],frameworkContract:[{required:!0,message:"请选择框架合同",trigger:"change"}],pact:[{required:!0,message:"请选择协议",trigger:"change"}],orderContract:[{required:!0,message:"请选择订单合同",trigger:"change"}],frameworkOrder:[{required:!0,message:"请选择框架订单",trigger:"change"}]},modify:{oneTimeContract:[{required:!0,message:"请选择一次性合同",trigger:"change"}],frameworkContract:[{required:!0,message:"请选择框架合同",trigger:"change"}],pact:[{required:!0,message:"请选择协议",trigger:"change"}],orderContract:[{required:!0,message:"请选择订单合同",trigger:"change"}],frameworkOrder:[{required:!0,message:"请选择框架订单",trigger:"change"}]},terminate:{oneTimeContract:[{required:!0,message:"请选择一次性合同",trigger:"change"}],frameworkContract:[{required:!0,message:"请选择框架合同",trigger:"change"}],pact:[{required:!0,message:"请选择协议",trigger:"change"}],orderContract:[{required:!0,message:"请选择订单合同",trigger:"change"}],frameworkOrder:[{required:!0,message:"请选择框架订单",trigger:"change"}]}},P=async()=>{const r=await N({configProcessesType:"CONTRACT_DRAFTING"});e.draftingData=r},_=async()=>{const r=await N({configProcessesType:"APPROVAL_CHANGE"});e.approvalChangeData=r},W=async()=>{const r=await N({configProcessesType:"CONTRACT_END"});e.contractEndData=r},e=me({transferData:[],approvalChangeData:[],contractEndData:[],draftingData:[],selectData:[],businessTypeCode:[],processesformData:{draft:{oneTimeContract:"",frameworkContract:"",pact:"",orderContract:"",frameworkOrder:""},modify:{oneTimeContract:"",frameworkContract:"",pact:"",orderContract:"",frameworkOrder:""},terminate:{oneTimeContract:"",frameworkContract:"",pact:"",orderContract:"",frameworkOrder:""},draftName:{},modifyName:{},terminateName:{}}}),A=k(null),X=async r=>{const o=e.businessTypeCode.join(",");try{const s=await A.value.validate(),m=await E.value.formRef.validate(),u=await j.value.formRef.validate(),g=await M.value.formRef.validate()}catch(s){if(console.log(s,"error"),r.value=!1,s)return}if(!o){Q.error("请选择业务类型"),r.value=!1;return}h(a.value?ie:de,s=>a.value?(console.log(e.processesformData),{...e.processesformData,businessTypeCode:o}):{id:p.initData.id,...e.processesformData,businessTypeCode:o}).then(s=>{Q.success("保存成功"),n("success",s),r.value=!1,i.value=!1}).catch(()=>{r.value=!1})},j=k(null),M=k(null),E=k(null),Z=[{label:"一次性合同",prop:"oneTimeContract"},{label:"框架合同",prop:"frameworkContract"},{label:"协议",prop:"pact"},{label:"订单合同",prop:"orderContract"},{label:"框架订单",prop:"frameworkOrder"}],x=[{label:"一次性合同",prop:"oneTimeContract"},{label:"框架合同",prop:"frameworkContract"},{label:"协议",prop:"pact"},{label:"订单合同",prop:"orderContract"},{label:"框架订单",prop:"frameworkOrder"}],ee=[{label:"一次性合同",prop:"oneTimeContract"},{label:"框架合同",prop:"frameworkContract"},{label:"协议",prop:"pact"},{label:"订单合同",prop:"orderContract"},{label:"框架订单",prop:"frameworkOrder"}],V=(r,o)=>N({configProcessesType:r,processName:o}),O=(r,o)=>{const s=e.processesformData[r][o];if(!s)return;const m=["oneTimeContract","frameworkContract","pact","orderContract","frameworkOrder"],u=m.indexOf(o);if(u!==-1){const g=r==="draft"?"draftName":r==="modify"?"modifyName":"terminateName",D=e.processesformData[g][o];for(let t=u+1;t<m.length;t++)e.processesformData[r][m[t]]=s,e.processesformData[g][m[t]]=D}},ae={businessTypeCode:[{required:!0,message:"请选择业务类型",trigger:"change"}]},re=async()=>{let r=[fe({filter:"Y"})];e.businessTypeCode&&e.businessTypeCode.length>0&&r.push(ue(e.businessTypeCode));let[o,s]=await Promise.all(r);s=s||[],o=[...o,...s],e.transferData=o.map(m=>({key:m.code,label:`${m.pname} - ${m.name}`,...m}))};return pe(()=>{var r,o,s,m,u,g,D,t,I,$,B,L,U,G,H;if(console.log("initData",p.initData,a.value),!a.value){const l=p.initData.processesformData||{};e.processesformData={draft:{oneTimeContract:((r=l.draft)==null?void 0:r.oneTimeContract)||"",frameworkContract:((o=l.draft)==null?void 0:o.frameworkContract)||"",pact:((s=l.draft)==null?void 0:s.pact)||"",orderContract:((m=l.draft)==null?void 0:m.orderContract)||"",frameworkOrder:((u=l.draft)==null?void 0:u.frameworkOrder)||""},modify:{oneTimeContract:((g=l.modify)==null?void 0:g.oneTimeContract)||"",frameworkContract:((D=l.modify)==null?void 0:D.frameworkContract)||"",pact:((t=l.modify)==null?void 0:t.pact)||"",orderContract:((I=l.modify)==null?void 0:I.orderContract)||"",frameworkOrder:(($=l.modify)==null?void 0:$.frameworkOrder)||""},terminate:{oneTimeContract:((B=l.terminate)==null?void 0:B.oneTimeContract)||"",frameworkContract:((L=l.terminate)==null?void 0:L.frameworkContract)||"",pact:((U=l.terminate)==null?void 0:U.pact)||"",orderContract:((G=l.terminate)==null?void 0:G.orderContract)||"",frameworkOrder:((H=l.terminate)==null?void 0:H.frameworkOrder)||""},draftName:l.draftName||{},modifyName:l.modifyName||{},terminateName:l.terminateName||{}},e.businessTypeCode=p.initData.businessTypeCode?p.initData.businessTypeCode.split(","):[],console.log(e.businessTypeCode,"transferData")}re(),P(),_(),W()}),(r,o)=>{const s=f("el-form-item"),m=f("el-tooltip"),u=f("el-transfer"),g=f("el-form"),D=f("complex-dialog");return T(),F(D,{modelValue:i.value,"onUpdate:modelValue":o[1]||(o[1]=t=>i.value=t),top:"10px",width:"1020px",title:y.value,onSubmit:X},{default:b(()=>[d(g,{class:"radius-box",style:{padding:"10px"},ref_key:"addFormRef",ref:A,model:e,rules:ae,"label-position":"top"},{default:b(()=>[d(s,{label:"业务类型",style:{"margin-bottom":"0"}}),d(u,{modelValue:e.businessTypeCode,"onUpdate:modelValue":o[0]||(o[0]=t=>e.businessTypeCode=t),filterable:"",data:e.transferData,titles:["可选业务类型","已选择业务类型"]},{default:b(({option:t})=>[d(m,{content:t.label,placement:"top-start"},{default:b(()=>[w("div",we,Y(t.label),1)]),_:2},1032,["content"])]),_:1},8,["modelValue","data"]),d(s,{label:"",prop:"businessTypeCode"})]),_:1},8,["model"]),w("div",he,[d(R,{ref_key:"processDraftingRef",ref:E,panelTitle:"合同起草审批流程",formType:"draft",formNameType:"draftName",formFields:Z,processesFormData:e.processesformData,processesRules:c,selectData:e.draftingData,getSubjectPage:t=>V("APPROVAL_CHANGE",t),copyDown:O,panelStyle:{flex:1,borderRight:"1px solid #d3d3d3"}},null,8,["processesFormData","selectData","getSubjectPage"]),d(R,{ref_key:"processModifyRef",ref:j,panelTitle:"合同变更审批流程",formType:"modify",formNameType:"modifyName",formFields:x,processesFormData:e.processesformData,processesRules:c,selectData:e.approvalChangeData,getSubjectPage:t=>V("APPROVAL_CHANGE",t),copyDown:O,panelStyle:{flex:1,borderRight:"1px solid #d3d3d3"}},null,8,["processesFormData","selectData","getSubjectPage"]),d(R,{ref_key:"processTerminateRef",ref:M,panelTitle:"合同终止审批流程",formType:"terminate",formNameType:"terminateName",formFields:ee,processesFormData:e.processesformData,processesRules:c,selectData:e.contractEndData,getSubjectPage:t=>V("CONTRACT_END",t),copyDown:O,panelStyle:{flex:1}},null,8,["processesFormData","selectData","getSubjectPage"])])]),_:1},8,["modelValue","title"])}}}),ve=S(_e,[["__scopeId","data-v-1deefa72"]]);export{ve as default};
