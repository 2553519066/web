const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/form-dialogly-C2pCxSF7.js","assets/index-CqcNLCXR.js","assets/index-D-MzvSrp.js","assets/index-CCn4OCkM.css","assets/format-OVLTuLZO.js","assets/form-dialogly-HVnhWbrQ.css"])))=>i.map(i=>d[i]);
import{d as fe,r as C,T as ze,aX as tt,aY as at,aZ as nt,h as _,a9 as qe,A as i,w as n,j as V,B as T,k as y,v as w,aL as Dt,b_ as lt,a_ as Ot,b$ as At,b1 as Vt,Q as ye,bh as L,bi as N,y as k,q as d,t as p,a6 as Ne,p as X,as as xe,aH as wt,c0 as Et,at as Se,o as Be,b2 as z,aV as ae,b4 as re,F as pe,E as De,P as it,H as ct,I as Tt,ap as Oe,aq as ut,a4 as Ue,aS as Me,i as dt,m as mt,z as Le,b9 as _e,b7 as pt,b3 as kt,c1 as Rt,aw as ot,L as Y,bb as Ft,bc as St,b8 as $t,c2 as $e,bo as qt,bp as Ut}from"./index-D-MzvSrp.js";import{o as Ae,t as rt}from"./index-CqcNLCXR.js";const Mt=fe({name:"UrlDownloadVue",inheritAttrs:!1,__name:"url-download-vue",props:{fileUrl:{type:String,default:""},fileName:{type:String,default:""},fileList:{type:Array,default:()=>[]},showView:{type:Boolean,default:!0},enableKkfile:{type:Boolean,default:!1}},setup(a){const g=a,r=C(!1),c=ze(()=>g.enableKkfile?!0:tt(g.fileUrl)||at(g.fileUrl)==nt.IMAGE),W=()=>{r.value=!0,At(g.fileUrl,g.fileName).finally(()=>{r.value=!1})},O=()=>{let G=g.enableKkfile?g.fileList:g.fileList.filter(B=>{let q=B.url||B.fileUrl||B.filePath;return tt(q)||at(q)==nt.IMAGE}),j=G.findIndex(B=>(B.url||B.fileUrl||B.filePath)===g.fileUrl);j=j===-1?0:j,Vt({list:G,current:j})};return(G,j)=>{const B=_("fs-svg-icon"),q=_("el-link");return qe(G.$slots,"default",{download:r.value},()=>[i(q,{class:"svg-icon",underline:!1,disabled:r.value},{default:n(()=>[r.value?(y(),V(w(lt),{key:0,size:"16px",style:{animation:"loading-rotate 1.5s linear infinite"}},{default:n(()=>[i(w(Dt))]),_:1})):(y(),V(B,{key:1,name:"template-download",onClick:j[0]||(j[0]=ee=>W())})),a.showView&&w(c)?(y(),V(w(lt),{key:2,size:"16px",onClick:O,style:{"margin-left":"4px"}},{default:n(()=>[i(w(Ot))]),_:1})):T("",!0),qe(G.$slots,"default",{},void 0,!0)]),_:3},8,["disabled"])],!0)}}}),zt=ye(Mt,[["__scopeId","data-v-f864cb39"]]),In=new Map([["NO","不需用印"],["OFFLINE","线下用印"],["ONLINE","电子签"]]),Ln=new Map([["CREATED",{type:"warning",name:"已创建"}],["INVALID",{type:"info",name:"已作废"}],["IN_APPROVAL",{type:"success",name:"起草审批中"}],["CHANGE_IN_APPROVAL",{type:"success",name:"变更审批中"}],["CHANGED_WAITE_APPROVAL",{type:"warning",name:"变更待提交审批"}],["IN_FULFILLMENT",{type:"success",name:"已生效"}],["IN_STOP",{type:"info",name:"终止审批中"}],["ENDED",{type:"info",name:"已终止"}],["FINISHED",{type:"success",name:"已完成"}]]);function Nn(a,g){const c=new Map([["CREATED",[2,8,11,4]],["INVALID",[4]],["IN_APPROVAL",[16,4]],["CHANGE_IN_APPROVAL",[17,4]],["CHANGED_WAITE_APPROVAL",[14,12,5,4]],["IN_FULFILLMENT",[5,7,4,6,9,10]],["IN_STOP",[18,4]],["ENDED",[4,6]],["FINISHED",[4,6]]]).get(g);return c?c.includes(a):!1}function xn(a,g){const c=new Map([["CREATED",[1,5,8,11]],["IN_APPROVAL",[1,4,6,12]],["IN_FULFILLMENT",[10,9,3,2,1]],["ENDED",[1,2]],["INVALID",[1]],["CHANGED_WAITE_APPROVAL",[7,8,1,11]],["IN_STOP",[1,13]],["FINISHED",[1,2]]]).get(g);return c?c.includes(a):!1}const Dn=new Map([["INVALID",{type:"info",name:"已作废"}],["WAITE_APPROVAL",{type:"warning",name:"已创建"}],["IN_APPROVAL",{type:"success",name:"新建审批中"}],["IN_FULFILLMENT",{type:"success",name:"已生效"}],["CHANGED_WAITE_APPROVAL",{type:"warning",name:"变更待提交审批"}],["CHANGED_APPROVAL",{type:"success",name:"变更审批中"}],["STOPPING",{type:"info",name:"终止审批中"}],["STOPPED",{type:"info",name:"已终止"}],["TASK_EFFECT",{type:"success",name:"已完成"}]]);function On(a,g){const c=new Map([["INVALID",[]],["WAITE_APPROVAL",[3,6,7]],["IN_APPROVAL",[12]],["IN_FULFILLMENT",[15,5]],["CHANGED_WAITE_APPROVAL",[10,8,15]],["CHANGED_APPROVAL",[13]],["STOPPING",[14]],["STOPPED",[]],["TASK_EFFECT",[]]]).get(g);return c?c.includes(a):!1}const he=new Map([["IN_PROMISE",{type:"success",name:"履约中"}],["PART_PROMISE",{type:"warning",name:"部分履约"}],["PROMISE_FINISH",{type:"warning",name:"履约完成"}],["PROMISE_TERMINATE",{type:"info",name:"已取消"}],["REPEAL",{type:"info",name:"已取消"}],["WAIT_PROMISE",{type:"warning",name:"待履约"}]]),Bt="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20width='16px'%20height='16px'%20viewBox='0%200%2016%2016'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3ctitle%3eIcon/Attachment%3c/title%3e%3cg%20id='合同系统'%20stroke='none'%20stroke-width='1'%20fill='none'%20fill-rule='evenodd'%3e%3cg%20id='合同详情-基础信息'%20transform='translate(-1054,%20-745)'%20fill='%23165DFF'%3e%3cg%20id='编组-16'%20transform='translate(236,%20339)'%3e%3cg%20id='编组-6备份'%20transform='translate(805,%20368)'%3e%3cg%20id='编组'%20transform='translate(0,%2028)'%3e%3cg%20id='DataEntry/Upload/Light/Resources-Progress&amp;Uploading备份-3'%20transform='translate(13,%205)'%3e%3cg%20id='attachment'%20transform='translate(0,%205)'%3e%3crect%20id='矩形'%20fill-rule='nonzero'%20opacity='0'%20x='0'%20y='0'%20width='16'%20height='16'%3e%3c/rect%3e%3cpath%20d='M12.4578125,3.10390625%20C10.9859375,1.63203125%208.5890625,1.63203125%207.11875,3.10390625%20L3.040625,7.17890625%20C3.0140625,7.20546875%203,7.24140625%203,7.27890625%20C3,7.31640625%203.0140625,7.35234375%203.040625,7.37890625%20L3.6171875,7.95546875%20C3.671875,8.01015625%203.7609375,8.01015625%203.815625,7.95546875%20L7.89375,3.88046875%20C8.4,3.37421875%209.0734375,3.09609375%209.7890625,3.09609375%20C10.5046875,3.09609375%2011.178125,3.37421875%2011.6828125,3.88046875%20C12.1890625,4.38671875%2012.4671875,5.06015625%2012.4671875,5.77421875%20C12.4671875,6.48984375%2012.1890625,7.16171875%2011.6828125,7.66796875%20L7.5265625,11.8226562%20L6.853125,12.4960938%20C6.2234375,13.1257813%205.2,13.1257813%204.5703125,12.4960938%20C4.265625,12.1914063%204.0984375,11.7867188%204.0984375,11.3554687%20C4.0984375,10.9242188%204.265625,10.5195312%204.5703125,10.2148438%20L8.69375,6.09296875%20C8.7984375,5.98984375%208.9359375,5.93203125%209.0828125,5.93203125%20L9.084375,5.93203125%20C9.23125,5.93203125%209.3671875,5.98984375%209.4703125,6.09296875%20C9.575,6.19765625%209.63125,6.33515625%209.63125,6.48203125%20C9.63125,6.62734375%209.5734375,6.76484375%209.4703125,6.86796875%20L6.1,10.2351563%20C6.0734375,10.2617187%206.059375,10.2976562%206.059375,10.3351563%20C6.059375,10.3726562%206.0734375,10.4085938%206.1,10.4351563%20L6.6765625,11.0117188%20C6.73125,11.0664063%206.8203125,11.0664063%206.875,11.0117188%20L10.24375,7.64296875%20C10.5546875,7.33203125%2010.725,6.91953125%2010.725,6.48046875%20C10.725,6.04140625%2010.553125,5.62734375%2010.24375,5.31796875%20C9.6015625,4.67578125%208.5578125,4.67734375%207.915625,5.31796875%20L7.515625,5.71953125%20L3.79375,9.43984375%20C3.28125,9.95234375%203,10.6320313%203,11.3570312%20C3,12.0804687%203.2828125,12.7601563%203.79375,13.2710937%20C4.3234375,13.7992188%205.0171875,14.0632812%205.7109375,14.0632812%20C6.4046875,14.0632812%207.0984375,13.7992188%207.6265625,13.2710937%20L12.4578125,8.44296875%20C13.16875,7.73046875%2013.5625046,6.78203125%2013.5625046,5.77421875%20C13.5640625,4.76484375%2013.1703125,3.81640625%2012.4578125,3.10390625%20Z'%20id='路径'%3e%3c/path%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",An=a=>L.post(`${N.contract}/contractOrder/page`,a),Ht=a=>L.post(`${N.contract}/contractList/addOrder`,a),Wt=a=>L.post(`${N.contract}/contractOrder/updateOrder`,a),Vn=a=>L.post(`${N.contract}/contractOrder/invalid`,a),Gt=a=>L.post(`${N.contract}/contractOrder/orderWithdraw`,a),jt=a=>L.post(`${N.contract}/contractOrder/stopOrder`,a),Jt=a=>L.post(`${N.contract}/contractOrder/changeOrder`,a),Xt=a=>L.get(`${N.contract}/contractOrder/detail`,a),Kt=a=>L.get(`${N.contract}/contractOrder/orderChangeHistoryDetail`,a),wn=a=>L.get(`${N.contract}/contractOrder/queryPlaceOrderCompany`,{size:100,companyName:a}).then(g=>Promise.resolve(g.map(r=>(r.value=r.companyCode,r.label=r.companyName,r)))),En=a=>L.get(`${N.contract}/contractOrder/queryPlaceOrderPerson`,{size:100,personName:a}).then(g=>Promise.resolve(g.map(r=>(r.value=r.userId,r.label=r.userName,r)))),Tn=a=>L.download(`${N.contract}/contractOrder/orderTempFile`,{params:a,method:"post"}),kn=a=>L.upload(`${N.contract}/contractOrder/importBatchData`,{method:"POST",data:a}),Rn=a=>L.download(`${N.contract}/contractOrder/exporErrData/${a}`,{method:"get"}),Fn=a=>L.get(`${N.contract}/contractOrder/approval/${a}`,{}),Sn=a=>L.get(`${N.contract}/contractOrder/preVerifyChangeOrder`,{contractOrderId:a}),$n=a=>L.get(`${N.contract}/contractOrder/preVerifyStopOrder`,{contractOrderId:a}),qn=a=>L.post(`${N.contract}/contractOrder/cancelChangeOrder`,a),Un=a=>L.post(`${N.contract}/contractOrder/retractApproval`,a),Mn=a=>L.post(`${N.contract}/contractOrder/retractApproval`,a),zn=a=>L.post(`${N.contract}/contractOrder/retractStopOrder`,a),Qt={class:"contract-card"},Yt={class:"contract-card-title"},Zt={class:"contract-card-content"},ea=fe({__name:"card",props:{title:{}},setup(a){const g=a;return(r,c)=>(y(),k("div",Qt,[d("div",Yt,p(g.title),1),d("div",Zt,[qe(r.$slots,"default",{},void 0,!0)])]))}}),st=ye(ea,[["__scopeId","data-v-b5f40ba7"]]),Bn=a=>L.post(`${N.contract}/fulfillmentPlain/getPageList`,a),Hn=a=>L.get(`${N.contract}/fulfillmentPlain/getById/${a.id}`,a),Wn=a=>L.post(`${N.contract}/fulfillmentPlain/updateTime/${a.id}`,a),Gn=a=>L.get(`${N.contract}/fulfillmentPlain/getFulfillmentCancelDetail`,a),jn=a=>L.post(`${N.contract}/fulfillmentPlain/cancelFulfillment`,a),Jn=a=>L.post(`${N.contract}/fulfillmentRecord/sendFulfillment`,a),ta=a=>L.get(`${N.contract}/fulfillmentRecord/getRercods`,a),Xn=a=>L.get(`${N.contract}/fulfillmentRecord/repealRecord/${a.id}`,a),Kn=a=>L.get(`${N.contract}/fulfillmentPlain/getReceiver`,{size:100,codeOrName:a}).then(g=>Promise.resolve(g.map(r=>(r.value=r.receivePartyCode,r.label=r.receivePartyName,r)))),Qn=a=>L.get(`${N.contract}/fulfillmentPlain/getPayParties`,{size:100,codeOrName:a}).then(g=>Promise.resolve(g.map(r=>(r.value=r.payPartyCode,r.label=r.payPartyName,r)))),aa={key:0},na={key:1},la={key:2},oa=fe({__name:"amount-popover",props:{contractId:{type:String,required:!0},code:{type:String,required:!0},type:{type:String,required:!0,validator:a=>["PROMISE_FINISH","IN_PROMISE"].includes(a)},amount:{type:[Number,String],default:0},title:{type:String,default:""},showInTransit:{type:Boolean,default:!1},inTransitAmount:{type:[Number,String],default:0}},setup(a){const g=a,r=C([]),c=C(!1),W=async()=>{if(!(r.value.length>0||c.value)){c.value=!0;try{const O=await ta({contractId:g.contractId,type:g.type,code:g.code});r.value=Array.isArray(O)?O:[]}catch(O){console.error("获取金额列表失败:",O),r.value=[]}finally{c.value=!1}}};return Ne(()=>[g.contractId,g.code,g.type],()=>{r.value=[]},{immediate:!0}),(O,G)=>{const j=_("el-text"),B=_("el-link"),q=_("el-table-column"),ee=_("el-table"),x=_("el-popover");return y(),V(x,{placement:"top",width:700,trigger:"click",onShow:W},{reference:n(()=>[i(j,{type:"primary",style:{"font-size":"13px",cursor:"pointer",display:"flex","flex-direction":"column",gap:"5px"}},{default:n(()=>[a.title?(y(),k("span",aa,p(a.title)+"："+p(O.$format.thousandsFormatCurrency(a.amount)),1)):(y(),k("span",na,p(O.$format.thousandsFormatCurrency(a.amount)),1)),a.showInTransit&&a.inTransitAmount>0?(y(),k("span",la," 在途金额："+p(O.$format.thousandsFormatCurrency(a.inTransitAmount)),1)):T("",!0)]),_:1})]),default:n(()=>[i(ee,{data:r.value,border:"",loading:c.value,style:{width:"100%"}},{default:n(()=>[i(q,{"min-width":"160",prop:"flowEngineInstanceId",label:"费控单号"},{default:n(({row:v})=>[i(B,{type:"primary",onClick:D=>w(Ae)({flowId:v.flowEngineInstanceId})},{default:n(()=>[X(p(v.processInstanceNo),1)]),_:2},1032,["onClick"])]),_:1}),i(q,{"min-width":"90",prop:"createUserName",label:"履约人"}),i(q,{"min-width":"140",prop:"amount",label:"金额",formatter:w(xe)},null,8,["formatter"]),i(q,{"min-width":"180",prop:"updateTime",label:a.type==="PROMISE_FINISH"?"履约完成时间":"申请时间"},null,8,["label"])]),_:1},8,["data","loading"])]),_:1})}}}),Ie=ye(oa,[["__scopeId","data-v-be8762f0"]]),ra={key:0,class:"total-text"},sa={class:"num"},ia={class:"compliance-program-out"},ca={style:{display:"grid",gap:"2px","font-size":"13px"}},ua={class:"text-item"},da={class:"table-column-list",style:{"font-size":"13px"}},ma={class:"table-column-list"},pa={key:0,style:{"font-size":"13px"}},fa={key:1,style:{"font-size":"13px"}},ya={class:"table-column-list"},va={style:{"font-size":"13px"}},ha={class:"table-column-list"},_a={style:{"font-size":"13px"}},ga={style:{"font-size":"13px"}},Ca={style:{"font-size":"13px"}},ba={style:{"font-size":"13px"}},Pa={class:"table-column-list"},Ia={style:{"font-size":"13px"}},La={class:"table-column-list"},Na={style:{"font-size":"13px"}},xa={style:{"font-size":"13px"}},Da={class:"table-column-list"},Oa={style:{"font-size":"13px"}},Aa={class:"table-column-list"},Va={style:{"font-size":"13px"}},wa={key:0,class:"total-text"},Ea={class:"num"},Ta={class:"compliance-program-out"},ka={class:"table-column-list",style:{display:"grid",gap:"2px","font-size":"13px"}},Ra={class:"text-item"},Fa={class:"table-column-list"},Sa={style:{"font-size":"13px"}},$a={style:{"font-size":"13px"}},qa={class:"table-column-list"},Ua={style:{"font-size":"13px"}},Ma={class:"table-column-list"},za={key:0,style:{"font-size":"13px"}},Ba={key:1,style:{"font-size":"13px"}},Ha={class:"table-column-list"},Wa={style:{"font-size":"13px"}},Ga={class:"table-column-list"},ja={style:{"font-size":"13px"}},Ja={style:{"font-size":"13px"}},Xa={style:{"font-size":"13px"}},Ka={style:{"font-size":"13px"}},Qa={class:"table-column-list"},Ya={style:{"font-size":"13px"}},Za={class:"table-column-list"},en={style:{"font-size":"13px"}},tn={class:"table-column-list"},an={style:{"font-size":"13px"}},nn={style:{"font-size":"13px"}},ln=fe({name:"BasicFulfillmentPlan",__name:"basic-fulfillment-plan",props:{detailData:{type:Object,required:!0},config:{type:Object,default:()=>({sourceInfo:"",ischange:!1})}},emits:["onFileSuccess"],setup(a,{emit:g}){wt();const r=a,c=C({sourceInfo:"",...Et(r.config)}),W=C({code:"paymentPlanTable",autoTable:!0,data:r.detailData.fulfillmentPlainList,columns:[{label:"履约计划/状态",prop:"nameAndStatus",slot:"nameAndStatus",width:"200"},{label:"要求履约日期",prop:"fulfillDate",formatter:Se,width:110},{label:"履约计划金额",prop:"amount",slot:"amount",width:220},{label:"发票",prop:"invoice",slot:"invoice",width:"150"},{label:"费用类型",prop:"costTypeName"},{label:"费用日期",prop:"feeDate",slot:"feeDate",width:220},{label:"履约计划所属公司",prop:"payPartyName",slot:"payPartyName",width:"170"},{label:"成本中心",prop:"costCenterName",slot:"costCenterName",width:"170"},{label:"收款方",prop:"receiveParty",slot:"receiveParty",width:"320"},{label:"履约延续",prop:"autoExtend",slot:"autoExtend",width:"100"}]}),O=C({code:"receiptPlanTable",autoTable:!0,showIndex:!1,data:r.detailData.fulfillmentPlainList,columns:[{label:"履约计划/状态",prop:"nameAndStatus",slot:"nameAndStatus",width:"200"},{label:"要求履约日期",prop:"fulfillDate",formatter:Se,width:"110"},{label:"履约计划金额",prop:"amount",slot:"amount",width:"220"},{label:"是否保证金",prop:"deposit",slot:"deposit"},{label:"保证金归还日期",prop:"depositReturnDate",formatter:Se,width:"120"},{label:"发票",prop:"invoice",slot:"invoice",width:"150"},{label:"费用类型",prop:"costTypeName"},{label:"履约计划所属公司",prop:"receivePartyName",slot:"receivePartyName",width:"170"},{label:"成本中心",prop:"costCenterName",slot:"costCenterName",width:"170",showOverflowTooltip:!0},{label:"付款方",prop:"payParty",slot:"payParty",width:"320"},{label:"是否延续",prop:"autoExtend",slot:"autoExtend",width:"100"}]}),G=(x,v)=>{const D=it[x];if(!D)return console.error(`未找到名为 ${x} 的字典`),"";const M=D.find(H=>H.value==v);return M?M.label:""},j=x=>{console.log(x,"preWarrantyAmount"),ct({body:()=>Tt(()=>import("./form-dialogly-C2pCxSF7.js"),__vite__mapDeps([0,1,2,3,4,5])),bodyData:{initData:x||{}},isReject:!0}).then(()=>{}).catch(()=>{})},B=x=>{const v=x.amount||0,D=x.amountFinish||0,M=x.amountApply||0,H=v-D-M;return Math.max(0,H)};Be(()=>{});let q=C("0.00"),ee=C("0.00");return Ne(()=>r.detailData.fulfillmentPlainList,x=>{if(!x||!Array.isArray(x))return;const v=[],D=[];x.forEach(l=>{l.financeType==z.INCOME?v.push(l):D.push(l)});let M=D.reduce((l,$)=>ae(l,Number($.amount)||0),0);q.value=re(M);let H=v.reduce((l,$)=>ae(l,Number($.amount)||0),0);ee.value=re(H),W.value.data=D,O.value.data=v},{deep:!0,immediate:!0}),(x,v)=>{const D=_("el-text"),M=_("el-tag"),H=_("complex-table");return y(),k(pe,null,[W.value.data&&W.value.data.length>0?(y(),V(st,{key:0,title:"付款计划",class:"card-mian"},{default:n(()=>[["order"].includes(c.value.sourceInfo)?(y(),k("div",ra,[v[0]||(v[0]=d("span",{class:"text"},"付款总金额：",-1)),d("span",sa,p(w(q))+"元",1)])):T("",!0),d("div",ia,[i(H,De({ref:"complianceContractRef"},W.value,{"max-height":420}),{nameAndStatus:n(({row:l})=>{var $;return[d("div",ca,[i(D,{class:"text-item",type:"primary",underline:"never",style:{cursor:"pointer","font-size":"13px"},onClick:U=>j(l)},{default:n(()=>[X(p(l.name),1)]),_:2},1032,["onClick"]),d("div",ua,p(l.code),1),d("div",null,[i(M,{type:($=w(he).get(l.fulfillStatus))==null?void 0:$.type,style:{"font-size":"13px"}},{default:n(()=>{var U;return[X(p((U=w(he).get(l.fulfillStatus))==null?void 0:U.name),1)]}),_:2},1032,["type"])])])]}),amount:n(({row:l})=>[d("div",da,[d("span",null,"计划总金额："+p(x.$format.thousandsFormatCurrency(l.amount)),1),i(Ie,{"contract-id":r.detailData.id,code:l.code,type:"PROMISE_FINISH",amount:l.amountFinish,title:"已履约金额"},null,8,["contract-id","code","amount"]),i(Ie,{"contract-id":r.detailData.id,code:l.code,type:"IN_PROMISE",amount:l.amountApply,title:"在途金额"},null,8,["contract-id","code","amount"]),d("span",null,"预留质保金："+p(x.$format.thousandsFormatCurrency(l.preWarrantyAmount)),1),d("span",null,"可申请金额："+p(x.$format.thousandsFormatCurrency(B(l))),1)])]),invoice:n(({row:l})=>[d("div",ma,[l.invoiceType?(y(),k("span",pa,"类型："+p(G("invoice_type",l.invoiceType)),1)):T("",!0),l.taxRate?(y(),k("span",fa,"税率："+p(l.taxRate)+"%",1)):T("",!0)])]),feeDate:n(({row:l})=>{var $,U;return[d("div",ya,[d("span",va,p(($=l.feeStartTime)==null?void 0:$.split(" ")[0])+" - "+p((U=l.feeEndTime)==null?void 0:U.split(" ")[0]),1)])]}),receiveParty:n(({row:l})=>[d("div",ha,[d("span",_a,"供应商："+p(l.receivePartyName),1),d("span",ga,"账户名称："+p(l.bankAccountName),1),d("span",Ca,"收款账号："+p(l.bankAccountNumber),1),d("span",ba,"收款银行(支行)："+p(l.bankSubName),1)])]),autoExtend:n(({row:l})=>[d("div",Pa,[d("span",Ia,p(G("auto_extend",l.autoExtend)),1)])]),costCenterName:n(({row:l})=>[d("div",La,[d("span",Na,p(l.costCenterName),1),d("span",xa,p(l.costCenterCode?`[${l.costCenterCode}]`:""),1)])]),fulfillStatus:n(({row:l})=>[d("div",Da,[d("span",Oa,p(w(he).get(l.fulfillStatus)),1)])]),payPartyName:n(({row:l})=>[d("div",Aa,[d("span",Va,p(l.payPartyName)+p(l.payPartyCode?`[${l.payPartyCode}]`:""),1)])]),_:1},16)])]),_:1})):T("",!0),O.value.data&&O.value.data.length>0?(y(),V(st,{key:1,title:"收款计划",class:"card-mian"},{default:n(()=>[["order"].includes(c.value.sourceInfo)?(y(),k("div",wa,[v[1]||(v[1]=d("span",{class:"text"},"收款总金额：",-1)),d("span",Ea,p(w(ee))+"元",1)])):T("",!0),d("div",Ta,[i(H,De({ref:"complianceContractRef"},O.value,{"max-height":420}),{nameAndStatus:n(({row:l})=>{var $;return[d("div",ka,[i(D,{class:"text-item",type:"primary",underline:"never",style:{cursor:"pointer","font-size":"13px"},onClick:U=>j(l)},{default:n(()=>[X(p(l.name),1)]),_:2},1032,["onClick"]),d("div",Ra,p(l.code),1),d("div",null,[i(M,{type:($=w(he).get(l.fulfillStatus))==null?void 0:$.type,style:{"font-size":"13px"}},{default:n(()=>{var U;return[X(p((U=w(he).get(l.fulfillStatus))==null?void 0:U.name),1)]}),_:2},1032,["type"])])])]}),amount:n(({row:l})=>[d("div",Fa,[d("span",Sa,"计划总金额："+p(x.$format.thousandsFormatCurrency(l.amount)),1),i(Ie,{"contract-id":r.detailData.id,code:l.code,type:"PROMISE_FINISH",amount:l.amountFinish,title:"已履约金额"},null,8,["contract-id","code","amount"]),i(Ie,{"contract-id":r.detailData.id,code:l.code,type:"IN_PROMISE",amount:l.amountApply,title:"在途金额"},null,8,["contract-id","code","amount"]),d("span",$a,"待收款金额："+p(x.$format.thousandsFormatCurrency((l.amount||0)-(l.amountFinish||0))),1)])]),deposit:n(({row:l})=>[d("div",qa,[d("span",Ua,p(l.deposit==1?"是":"否"),1)])]),invoice:n(({row:l})=>[d("div",Ma,[l.invoiceType?(y(),k("span",za,"类型："+p(G("invoice_type",l.invoiceType)),1)):T("",!0),l.taxRate?(y(),k("span",Ba,"税率："+p(l.taxRate)+"%",1)):T("",!0)])]),feeDate:n(({row:l})=>{var $,U;return[d("div",Ha,[d("span",Wa,p(($=l.feeStartTime)==null?void 0:$.split(" ")[0])+" ~ "+p((U=l.feeEndTime)==null?void 0:U.split(" ")[0]),1)])]}),payParty:n(({row:l})=>[d("div",Ga,[d("span",ja,"供应商："+p(l.payPartyName),1),d("span",Ja,"账户名称："+p(l.bankAccountName),1),d("span",Xa,"收款账号："+p(l.bankAccountNumber),1),d("span",Ka,"收款银行(支行)："+p(l.bankSubName),1)])]),autoExtend:n(({row:l})=>[d("div",Qa,[d("span",Ya,p(G("auto_extend",l.autoExtend)),1)])]),receivePartyName:n(({row:l})=>[d("div",Za,[d("span",en,p(l.receivePartyName)+p(l.receivePartyCode?`[${l.receivePartyCode}]`:""),1)])]),costCenterName:n(({row:l})=>[d("div",tn,[d("span",an,p(l.costCenterName),1),d("span",nn,p(l.costCenterCode?`[${l.costCenterCode}]`:""),1)])]),_:1},16)])]),_:1})):T("",!0)],64)}}}),ft=ye(ln,[["__scopeId","data-v-fe0945d8"]]),on={style:{height:"70vh","overflow-y":"scroll"}},rn={style:{"margin-left":"10px","font-size":"18px"}},sn={key:1},cn=fe({name:"AddOrderLogs",inheritAttrs:!1,__name:"add-order-logs",props:Oe({initData:{type:Object,default:()=>({})}},{modelValue:{},modelModifiers:{}}),emits:Oe(["success","info"],["update:modelValue"]),setup(a,{emit:g}){const r=a,c=C(r.initData.plainType||"info"),W=g,O=ut(a,"modelValue"),G=C([]),j=C({info:"订单记录详情"}),B=()=>{let h;return(I=>{I.info="关闭"})(h||(h={})),h[c.value]||"确认"};let q=Ue({});const ee=Me(),x=C(!1),v=C({id:r.initData.id||"",amount:0,contractCode:r.initData.code,orderCompanyName:r.initData.orderCompanyName,orderCompanyCode:r.initData.orderCompanyCode,contractId:r.initData.contractId||r.initData.id||"",contractListFulfillmentPlainParamList:{[z.INCOME]:[],[z.EXPENDITURE]:[]},orderName:"",remark:"",orderList:[],processId:"",processInstanceName:"",status:"",fileList:[],reason:""}),D=C({columns:[],initData:[],targetColumns:[],amountCode:""}),M={},H=C(!1),l=h=>{const{column:I}=h;if(I.property&&I.property=="quantity")return"header-required"},$=h=>{h.totalAmount=_e(h.quantity||0,h[D.value.amountCode]||0)},U=async h=>{c.value==="info"&&(W("info"),O.value=!1,h.value=!1)},o=h=>pt({contractCodeOrName:h}).then(I=>Promise.resolve(I.map(R=>({value:R.code,label:R.name,contractId:R.id,businessTypeSecond:R.businessTypeSecond,partyList:R.partyList||[],otherList:R.otherList||[]})))),ne=h=>{v.value.orderCompanyName=h.label||""},E=C(!0),ge=C(["totalAmount"]);let te=C(!1);const ue=h=>{const I=[];return h.columns.forEach((R,A)=>{var K;if(A===0)I[A]="";else if(ge.value.includes(R.property)){let F=h.data.reduce((le,ie)=>ae(le,Number(ie[R.property])||0),0);F=((K=R.relationData)==null?void 0:K.thousand)||!1?re(F,""):F,I[A]=`汇总：${F}元`}else I[A]=""}),I},Ve=ze(()=>{const A=te?40:0;return 40+5*40+A}),we=async h=>{const I=[],R=[];for(let A of h)A._id=A._id||A.id,A.financeType==z.INCOME?I.push(A):R.push(A);v.value.contractListFulfillmentPlainParamList&&(v.value.contractListFulfillmentPlainParamList[z.INCOME]=I,v.value.contractListFulfillmentPlainParamList[z.EXPENDITURE]=R),x.value=!0},J=async()=>{const h=await Kt({batchId:r.initData.batchId});if(h){const I=h.inFulfillmentPlainVOList||[],R=h.outFulfillmentPlainVOList||[];if(v.value.remark=h.orderDetailBaseInfoVO.remark,v.value.contractCode=h.orderDetailBaseInfoVO.contractCode,v.value.orderName=h.orderDetailBaseInfoVO.orderName,v.value.orderCompanyCode=h.orderDetailBaseInfoVO.orderCompanyCode,v.value.orderCompanyName=h.orderDetailBaseInfoVO.orderCompanyName,v.value.processInstanceNo=h.orderDetailBaseInfoVO.processInstanceNo,v.value.amount=h.orderDetailBaseInfoVO.amount||0,G.value=[{value:h.orderDetailBaseInfoVO.orderCompanyCode,label:h.orderDetailBaseInfoVO.orderCompanyName}],h.orderDetailBaseInfoVO.orderDetail){const A=JSON.parse(h.orderDetailBaseInfoVO.orderDetail);D.value.columns=A.columns,D.value.targetColumns=D.value.columns.filter(F=>(F.uPrice==="1"&&(D.value.amountCode=F.code),F)),te.value=D.value.targetColumns.some(F=>F.sum==="1"),D.value.initData=A.data;let K=[];for(let F of D.value.initData){const se={_id:F._id,quantity:F.quantity||1,totalAmount:_e(F.quantity,F[D.value.amountCode]||0)};for(let le of D.value.targetColumns)se[le.code]=F[le.code];K.push(se)}v.value.orderList=K}if(["info","cancel"].includes(c.value)){const A=h.inFulfillmentPlainVOList||[],K=h.outFulfillmentPlainVOList||[];q.fulfillmentPlainList=[...A,...K]}else we([...I,...R])}},Ee=async()=>{if(!r.initData.batchId)return!1;H.value=!0,Promise.all([J()]).finally(()=>{H.value=!1})};return Be(()=>{Ee()}),(h,I)=>{const R=_("form-select-v2"),A=_("el-form-item"),K=_("el-input"),F=_("el-col"),se=_("el-link"),le=_("el-row"),ie=_("el-table-column"),Te=_("el-input-number"),Ce=_("el-table"),ke=_("el-form"),Re=_("complex-dialog"),Fe=dt("loading");return y(),V(Re,{top:"10vh",title:j.value[c.value],modelValue:O.value,"onUpdate:modelValue":I[5]||(I[5]=S=>O.value=S),width:"80vw",onSubmit:U,confirmText:B(),hideCancel:["cancel","info"].includes(c.value)},{default:n(()=>[mt((y(),k("div",on,[i(ke,{class:"radius-box add-order-main",ref_key:"formRef",ref:ee,model:v.value,"label-position":"left",rules:M,style:{padding:"12px 12px 0"}},{default:n(()=>[i(A,{label:"框架协议",prop:"contractCode",required:["create"].includes(c.value)},{default:n(()=>[i(R,{modelValue:v.value.contractCode,"onUpdate:modelValue":I[0]||(I[0]=S=>v.value.contractCode=S),"search-method":o,disabled:!["create"].includes(c.value),clearable:"",placeholder:["create"].includes(c.value)?"请输入合同编号或名称选择框架协议":" "},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["required"]),i(A,{label:"订单名称",prop:"orderName",required:["create"].includes(c.value)},{default:n(()=>[i(K,{modelValue:v.value.orderName,"onUpdate:modelValue":I[1]||(I[1]=S=>v.value.orderName=S),style:{width:"100%"},type:"type",maxlength:"200","show-word-limit":"",clearable:"",disabled:!["create"].includes(c.value),placeholder:["create"].includes(c.value)?"请输入名称":" "},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["required"]),i(le,{gutter:24},{default:n(()=>[i(F,{span:12},{default:n(()=>[i(A,{label:"下单公司",prop:"orderCompanyCode",required:["create"].includes(c.value)},{default:n(()=>[i(R,{modelValue:v.value.orderCompanyCode,"onUpdate:modelValue":I[2]||(I[2]=S=>v.value.orderCompanyCode=S),"search-method":G.value,"echo-options":[{value:v.value.orderCompanyCode,label:`${v.value.orderCompanyName}`}],disabled:!["create"].includes(c.value),clearable:"",placeholder:["create"].includes(c.value)?"请选择公司":" ",onChange:ne},null,8,["modelValue","search-method","echo-options","disabled","placeholder"])]),_:1},8,["required"])]),_:1}),i(F,{span:12},{default:n(()=>[i(A,{label:"审批流程",prop:"processInstanceNo",required:["create"].includes(c.value)},{default:n(()=>[i(se,{type:"primary",underline:!1,onClick:I[3]||(I[3]=S=>w(Ae)({flowId:v.value.processInstanceNo}))},{default:n(()=>[X(p(v.value.processInstanceNo||"-"),1)]),_:1})]),_:1},8,["required"])]),_:1})]),_:1}),i(le,{style:{"margin-bottom":"14px","align-items":"center"}},{default:n(()=>[I[6]||(I[6]=d("span",{style:{"font-size":"14px"}},"订单金额",-1)),d("span",rn,p(h.$format.thousandsFormatCurrency(v.value.amount))+"元",1)]),_:1,__:[6]}),i(A,{"label-position":"top",label:"商品信息",prop:"orderList",required:""},{default:n(()=>[i(Ce,{"row-key":"_id",data:v.value.orderList,border:"","max-height":Ve.value,style:{width:"100%"},size:"small",disabled:["info"].includes(c.value),"scrollbar-always-on":"","show-summary":w(te),"summary-method":ue,"header-cell-class-name":l},{default:n(()=>[(y(!0),k(pe,null,Le(D.value.targetColumns,(S,be)=>(y(),V(ie,{key:S.code,label:S.label,"min-width":160,prop:S.code},null,8,["label","prop"]))),128)),i(ie,{label:"数量",prop:"quantity","min-width":200},{default:n(({row:S,$index:be})=>[i(A,{class:"table-form-item",prop:`orderList.${be}.quantity`,rules:M.quantity},{default:n(()=>[["create","change"].includes(c.value)?(y(),V(Te,{key:0,class:"number-left w-full",modelValue:S.quantity,"onUpdate:modelValue":ce=>S.quantity=ce,min:1,step:1,placeholder:"请输入",onChange:ce=>$(S)},null,8,["modelValue","onUpdate:modelValue","onChange"])):(y(),k("span",sn,p(S.quantity),1))]),_:2},1032,["prop","rules"])]),_:1}),E.value?(y(),V(ie,{key:0,label:"总金额",prop:"totalAmount","min-width":200,formatter:w(xe)},null,8,["formatter"])):T("",!0)]),_:1},8,["data","max-height","disabled","show-summary"])]),_:1}),i(A,{"label-position":"top",label:"订单备注",prop:"remark"},{default:n(()=>[i(K,{modelValue:v.value.remark,"onUpdate:modelValue":I[4]||(I[4]=S=>v.value.remark=S),rows:3,style:{width:"100%"},type:"textarea",disabled:!["create"].includes(c.value),maxlength:"500","show-word-limit":"",placeholder:["create"].includes(c.value)?"请输入订单备注":""},null,8,["modelValue","disabled","placeholder"])]),_:1}),["info"].includes(c.value)?(y(),V(ft,{key:0,detailData:w(q)},null,8,["detailData"])):T("",!0)]),_:1},8,["model"])])),[[Fe,H.value]])]),_:1},8,["title","modelValue","confirmText","hideCancel"])}}}),un=ye(cn,[["__scopeId","data-v-340139b4"]]),dn={style:{height:"70vh","overflow-y":"scroll"}},mn={style:{"margin-left":"10px","font-size":"18px"}},pn={key:1},fn={key:0},yn={style:{padding:"12px"}},vn={style:{padding:"12px"}},hn={style:{"line-height":"22px","min-height":"22px",color:"#4e5969","font-size":"13px","word-break":"break-all"}},_n={style:{"line-height":"22px",height:"22px","margin-left":"4px"}},gn={class:"radius-box",style:{padding:"12px"}},Cn=fe({name:"AddOrder",inheritAttrs:!1,__name:"add-order",props:Oe({initData:{type:Object,default:()=>({})}},{modelValue:{},modelModifiers:{}}),emits:Oe(["success"],["update:modelValue"]),setup(a,{emit:g}){var Xe;const r=a,c=C(r.initData.plainType||"create"),W=g,O=ut(a,"modelValue"),G=(t,e)=>{const s=it[t];if(!s)return console.error(`未找到名为 ${t} 的字典`),"";const u=s.find(P=>P.value==e);return u?u.label:""},j=C({create:"新建订单",edit:"编辑订单",change:"变更订单",info:"订单详情",cancel:"取消订单",end:"取消订单"}),B=()=>{let t;return(e=>{e.create="确认",e.edit="确认",e.change="确认",e.info="关闭",e.cancel="确认",e.end="确认"})(t||(t={})),t[c.value]||"确认"};let q=Ue({});const ee=C({code:"orderChangeLogVOListPropsTable",autoTable:!0,showIndex:!1,data:[],columns:[{label:"历史版本",prop:"changeVersion",slot:"changeVersion",width:"120",align:"center"},{label:"变更时间",prop:"changeTime",width:"200"},{label:"变更人",prop:"changer",width:"110"},{label:"变更类型",prop:"changeType",slot:"changeType",width:"110",align:"center"},{label:"变更说明",prop:"description",slot:"description"},{label:"变更金额",prop:"amount",formatter:xe},{label:"附件",prop:"attachmentUrl",slot:"attachmentUrl"},{label:"审批流程编号",prop:"approvalId",slot:"approvalId"}]}),x=Me(),v=C(!1);let D=C(""),M=C(""),H=C(""),l=C(0),$=C(0);const U=C([]),o=Ue({id:r.initData.id||"",amount:0,contractCode:r.initData.code,orderCompanyName:r.initData.orderCompanyName,orderCompanyCode:r.initData.orderCompanyCode,orderCompanyBankInfo:{},contractId:r.initData.contractId||r.initData.id||"",contractListFulfillmentPlainParamList:{[z.INCOME]:[],[z.EXPENDITURE]:[]},orderName:"",remark:"",orderList:[],processId:"",processName:"",status:"",fileList:[],reason:""}),ne=Me([]),E=C({columns:[],initData:[],dataInfo:[],targetColumns:[],amountCode:""}),ge={contractCode:[{required:!0,message:"请选择框架协议"}],orderName:[{required:!0,message:"请输入订单名称"}],orderCompanyCode:[{required:!0,message:"请选择下单公司"}],orderCompanyName:[{required:!0,message:"请选择下单公司"}],processId:[{required:!0,message:"请配置框架订单流程"}],quantity:[{type:"number",required:!0,min:1,message:"请输入大于1的整数"}],contractListFulfillmentPlainParamList:[{type:"object",validator(t,e,s){if(e[z.INCOME].length==0&&e[z.EXPENDITURE].length==0)return s(new Error("请添加履约信息"));s()}}],orderChangeAmount:[{required:!0,message:"请输入订单调整金额",trigger:"blur"}],fileList:[{required:!0,message:"请上传附件",trigger:"blur",type:"array"}],changeReason:[{required:!0,message:"请输入变更说明",trigger:"blur"}],cancelReason:[{required:!0,message:"请输入取消原因",trigger:"blur"}]},te=C(),ue=C(!1),Ve=t=>{ct({body:un,bodyData:{initData:{batchId:t}},isReject:!0}).then(e=>{e.success}).catch(()=>{})},we=t=>{const{column:e}=t;if(e.property&&e.property=="quantity")return"header-required"},J=C({visible:!1,enableList:[],selectList:[],index:-1}),Ee=t=>{J.value.selectList=t},h=t=>{if(J.value.selectList.length==0){Y.warning("请选择标的内容"),t.value=!1;return}o.orderList.splice(J.value.index+1,0,...J.value.selectList),t.value=!1,J.value.visible=!1},I=t=>{t.totalAmount=_e(t.quantity||0,t[E.value.amountCode]||0)},R=async(t,e)=>{let s=new Set(o.orderList.map(P=>P._id)),u=E.value.dataInfo.filter(P=>!s.has(P._id));if(u.length==0){Y.warning("没有可添加的标的内容");return}J.value.index=e,J.value.enableList=u,J.value.selectList=[],J.value.visible=!0},A=(t,e)=>{o.orderList.splice(e,1)},K=t=>{const{orderCompanyBankInfo:e}=o;let s=ne.value.find(u=>u.our==1)||null;s=s&&s.useRange?JSON.parse(s.useRange):[],s=s.find(u=>u.companyCode===o.orderCompanyCode)||{};for(let u in t){let P=t[u];for(let m of P)m.fulfillStatus=="WAIT_PROMISE"&&(u===z.EXPENDITURE?(m.payPartyCode=s.companyCode,m.payPartyName=s.companyName):(m.receivePartyCode=s.companyCode,m.receivePartyName=s.companyName,m.disdeposit===1&&(m.depositReturnReceivePartyCode=s.partyCode,m.depositReturnReceivePartyName=s.partyName,m.depositReturnReceivePartyBankAccountNumber=e.bankAccountNumber)))}return[...t[z.INCOME],...t[z.EXPENDITURE]]},F=async t=>{try{try{await x.value.validate(),await te.value.validate()}catch(m){for(const b in m)if(m[b][0]){Y.error(m[b][0].message),t.value=!1;return}t.value=!1;return}const{orderList:e,contractListFulfillmentPlainParamList:s,...u}=o;u.orderDetail=JSON.stringify({columns:[...E.value.targetColumns.map(m=>({label:m.label,code:m.code,minWidth:160,uPrice:m.uPrice||"0",sum:m.sum||"0"}))],data:e}),u.contractListFulfillmentPlainParamList=K(s);let P=e.reduce((m,b)=>ae(m,b.totalAmount),0);if(u.amount=P,c.value=="create"){const m=await Ht({...u});rt({submitId:m}),Y.success("操作成功"),W("success"),O.value=!1}else c.value=="edit"&&(await Wt({...u,orderId:r.initData.id||"",contractId:r.initData.contractId||""}),Y.success("修改成功"),W("success"),O.value=!1)}catch(e){console.log(e),t.value=!1}},se=async t=>{try{try{await x.value.validate(),await te.value.validate()}catch(m){for(const b in m)if(m[b][0]){Y.error(m[b][0].message),t.value=!1;return}t.value=!1;return}const{orderList:e,contractListFulfillmentPlainParamList:s,...u}=o;u.orderDetail=JSON.stringify({columns:[...E.value.targetColumns.map(m=>({label:m.label,code:m.code,minWidth:160,uPrice:m.uPrice||"0",sum:m.sum||"0"}))],data:e}),u.contractOrderChangeFulfillmentPlainList=K(s),u.amount=e.reduce((m,b)=>ae(m,b.totalAmount),0);let P=e.reduce((m,b)=>ae(m,b.totalAmount),0);u.amount=D.value||"",u.id=r.initData.id||"",await Jt(u),Y.success("操作成功"),W("success"),O.value=!1}catch(e){console.log(e),t.value=!1}},le=async t=>{try{await x.value.validate(),O.value=!1,await Gt({cancelReason:o.cancelReason,fileList:o.fileList,id:r.initData.id||""}),Y.success("取消成功"),W("success")}catch(e){console.log(e),t.value=!1}},ie=async t=>{try{try{await x.value.validate()}catch(s){for(const u in s)if(s[u][0]){Y.error(s[u][0].message),t.value=!1;return}t.value=!1;return}O.value=!1;const e=await jt({cancelReason:o.cancelReason,fileList:o.fileList,orderId:r.initData.id||""});rt({submitId:e}),Y.success("操作成功"),W("success")}catch(e){console.log(e),t.value=!1}},Te=async t=>{switch(c.value){case"info":O.value=!1,t.value=!1;break;case"create":case"edit":F(t);break;case"change":se(t);break;case"end":ie(t);break;case"cancel":le(t);break}},Ce=async t=>{let e=ne.value.find(s=>s.our==1)||null;e=e&&e.useRange?JSON.parse(e.useRange):[];try{e=e.map(s=>({label:s.companyName,value:s.companyCode})),U.value=e}catch(s){console.error(s),U.value=[]}},ke=async t=>{if(!t.value)return!1;o.orderCompanyName=t.selected.label||"";let e=await Ft([t.value]),s={};e&&St(s,e[0].bankInfoList[0]),o.orderCompanyBankInfo=s,ne.value.map(u=>{u.our===1&&(u.partyCode=t.value,u.partyName=t.selected.label)}),te.value&&te.value.initBusinessTypeConfig(ve.value.secondTypeCode),Pe([])},Re=()=>{if(!o.contractCode)return Y.warning("请选择框架协议"),!1;if(!o.orderCompanyCode)return Y.warning("请选择下单公司"),!1},Fe=t=>pt({contractCodeOrName:t}).then(e=>Promise.resolve(e.map(s=>({value:s.code,label:s.name,contractId:s.id,businessTypeSecond:s.businessTypeSecond,partyList:s.partyList||[],otherList:s.otherList||[]})))),S=C(!0),be=C(["totalAmount"]);let ce=C(!1);const yt=t=>{const e=[];return t.columns.forEach((s,u)=>{var P;if(u===0)e[u]="";else if(be.value.includes(s.property)){let m=t.data.reduce((Q,oe)=>ae(Q,Number(oe[s.property])||0),0);m=((P=s.relationData)==null?void 0:P.thousand)||!1?re(m,""):m,e[u]=`汇总：${m}元`}else e[u]=""}),e},vt=ze(()=>{const u=ce?40:0;return 40+5*40+u}),He=t=>{let e=t.find(s=>s.fieldDefineType===qt.TARGET)||null;if(e){const s=JSON.parse(e.fieldDefineInfo),u=JSON.parse(e.fieldInstanceData);E.value.columns=s.columns,E.value.targetColumns=E.value.columns.filter(m=>(m.uPrice==="1"&&(E.value.amountCode=m.code),m.targetType==="spec"||m.targetType==="amount")),ce.value=E.value.targetColumns.some(m=>m.sum==="1"),E.value.dataInfo=u[e.fieldInstanceCode],E.value.initData=u[e.fieldInstanceCode];let P=[];for(let m of E.value.initData){const b={_id:m._id,quantity:1,totalAmount:_e(1,m[E.value.amountCode]||0)};for(let Q of E.value.targetColumns)b[Q.code]=m[Q.code];P.push(b)}l.value=[...P].reduce((m,b)=>ae(m,Number(b.totalAmount)||0),0),o.orderList=[...P]}},ve=C({config:{sourceInfo:"order",operationType:["change"].includes(c.value)?"change":""},secondTypeCode:(Xe=r.initData)==null?void 0:Xe.businessTypeSecond,incomeConfig:{showFieldMap:{deposit:!0,depositReturnDate:!0}},expenditureConfig:{showFieldMap:{}}}),ht=t=>{const e=t.selected;ve.value.secondTypeCode=e.businessTypeSecond,o.contractId=e.contractId,ne.value=e.partyList,Ce(""),o.orderCompanyCode="",We(e.businessTypeSecond),e.otherList&&He(e.otherList),Pe([])},Pe=async t=>{const e=[],s=[];for(let u of t)u._id=u._id||u.id,u.financeType==z.INCOME?e.push(u):s.push(u);o.contractListFulfillmentPlainParamList&&(o.contractListFulfillmentPlainParamList[z.INCOME]=e,o.contractListFulfillmentPlainParamList[z.EXPENDITURE]=s),v.value=!0,te.value&&te.value.loadConfig()},We=async t=>{const e=await $t({businessTypeCode:t,contractType:"FRAMEWORK_ORDER"});if(e.length>0){const s=e[0];["create","edit","cancel"].includes(c.value)?(o.processName=s.startProcessName,o.processId=s.startProcessId):["change"].includes(c.value)?(o.processName=s.availableProcessName,o.processId=s.availableProcessId):["end"].includes(c.value)&&(o.processName=s.endProcessName,o.processId=s.endProcessId)}else o.processId="",o.processName=""},_t=async t=>{const e=await Ut(t);He(e.otherList),ne.value=e.partyList,Ce(""),ve.value.secondTypeCode=e.businessTypeSecond,await We(e.businessTypeSecond),["create"].includes(c.value)&&(Pe([]),o.contractCode=e.code)},gt=async()=>{if(r.initData.contractId){const t=await Xt({id:r.initData.id});if(t){const e=t.orderDetailBaseInfoVO,s=t.inFulfillmentPlainVOList||[],u=t.outFulfillmentPlainVOList||[];if(o.amount=e.amount||0,o.remark=e.remark,o.contractCode=e.contractCode,o.orderName=e.orderName,o.orderCompanyCode=e.orderCompanyCode,o.orderCompanyName=e.orderCompanyName,o.processId=e.processId,o.processInstanceNo=e.processInstanceNo,e.orderDetail){const P=JSON.parse(e.orderDetail);E.value.columns=P.columns,E.value.targetColumns=E.value.columns.filter(b=>(b.uPrice==="1"&&(E.value.amountCode=b.code),b)),ce.value=E.value.targetColumns.some(b=>b.sum==="1"),E.value.initData=P.data;let m=[];for(let b of E.value.initData){const Q={_id:b._id,quantity:b.quantity||1,totalAmount:_e(b.quantity,b[E.value.amountCode]||0)};for(let oe of E.value.targetColumns)Q[oe.code]=b[oe.code];m.push(Q)}l.value=[...m].reduce((b,Q)=>ae(b,Number(Q.totalAmount)||0),0),o.orderList=[...m]}if(ee.value.data=t.orderChangeLogVOList||[],ee.value.data=t.orderChangeLogVOList||[],e.status==="CHANGED_WAITE_APPROVAL"&&t.orderChangeLogVOList&&t.orderChangeLogVOList.length>0){const P=t.orderChangeLogVOList[t.orderChangeLogVOList.length-1];$.value=P.amount||0,o.orderChangeAmount=P.amount||"",o.fileList=P.attachmentUrl?JSON.parse(P.attachmentUrl):[],o.changeReason=P.description||""}if(["info","cancel","end"].includes(c.value)){const P=t.inFulfillmentPlainVOList||[],m=t.outFulfillmentPlainVOList||[];q.id=t.orderDetailBaseInfoVO.contractId||"",q.fulfillmentPlainList=[...P,...m]}else Pe([...s,...u])}}},Ct=async()=>{if(!r.initData.id&&!r.initData.contractId)return v.value=!0,!1;ue.value=!0,await _t(r.initData.contractId||r.initData.id),await gt(),ne.value.map(t=>{t.our===1&&(t.partyCode=o.orderCompanyCode,t.partyName=o.orderCompanyName)}),ue.value=!1,je(!0)},Ge=C(!1);Be(()=>{Ct()}),Ne(()=>o.contractCode,(t,e)=>{t||Object.assign(o,{amount:0,contractCode:r.initData.code,orderCompanyName:r.initData.orderCompanyName,orderCompanyCode:r.initData.orderCompanyCode,contractId:r.initData.id,contractListFulfillmentPlainParamList:{[z.INCOME]:[],[z.EXPENDITURE]:[]},remark:"",orderList:[],orderName:"",processId:"",processName:"",status:"",fileList:[],reason:""})},{immediate:!0});const bt=t=>{let e=$e(H.value,$.value);if(t)if(t>0){let s=ae(e,t);D.value=s,M.value=re(s)}else{let s=$e(e,t*-1);if(s<0){Y.error("变更金额不能小于订单金额!"),o.orderChangeAmount="";return}D.value=s,M.value=re(s)}else{M.value=re(e);return}},je=(t=!1)=>{let e=o.amount||0,s=o.orderList.reduce((u,P)=>ae(u,Number(P.totalAmount)||0),0);if(e>0&&(s+=$e(e,l.value||0)),D.value=s,M.value=re(s),t)H.value=s;else if(H.value){let u=s-H.value;o.orderChangeAmount=u||""}};Ne(()=>o.orderList,(t,e)=>{je()},{immediate:!0,deep:!0});const Je=t=>t?JSON.parse(t):[];return(t,e)=>{const s=_("form-select-v2"),u=_("el-form-item"),P=_("el-input"),m=_("fs-select"),b=_("el-col"),Q=_("el-link"),oe=_("el-row"),de=_("el-table-column"),Ke=_("el-input-number"),Qe=_("el-button"),Ye=_("el-table"),Pt=_("el-text"),Ze=_("el-scrollbar"),It=_("el-space"),Lt=_("complex-table"),Nt=_("el-form"),et=_("complex-dialog"),xt=dt("loading");return y(),k(pe,null,[i(et,{top:"10vh",title:j.value[c.value],modelValue:O.value,"onUpdate:modelValue":e[11]||(e[11]=f=>O.value=f),width:"80vw",onSubmit:Te,confirmText:B(),hideCancel:["cancel","info"].includes(c.value)},{default:n(()=>[mt((y(),k("div",dn,[ue.value?T("",!0):(y(),V(Nt,{key:0,class:"radius-box add-order-main",ref_key:"formRef",ref:x,model:o,"label-position":"left",rules:ge,style:{padding:"12px 12px 0"}},{default:n(()=>[i(u,{label:"框架协议",prop:"contractCode",required:["create"].includes(c.value)},{default:n(()=>[i(s,{modelValue:o.contractCode,"onUpdate:modelValue":e[0]||(e[0]=f=>o.contractCode=f),"search-method":Fe,disabled:!["create"].includes(c.value),clearable:"",placeholder:["create","edit"].includes(c.value)?"请输入合同编号或名称选择框架协议":" ",onChange:ht},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["required"]),i(u,{label:"订单名称",prop:"orderName",required:["create"].includes(c.value)},{default:n(()=>[i(P,{modelValue:o.orderName,"onUpdate:modelValue":e[1]||(e[1]=f=>o.orderName=f),style:{width:"100%"},type:"type",maxlength:"200","show-word-limit":"",clearable:"",disabled:!["create"].includes(c.value),placeholder:["create","edit"].includes(c.value)?"请输入名称":" "},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["required"]),i(oe,{gutter:24},{default:n(()=>[i(b,{span:12},{default:n(()=>[i(u,{label:"下单公司",prop:"orderCompanyCode",required:["create"].includes(c.value)},{default:n(()=>[i(m,{modelValue:o.orderCompanyCode,"onUpdate:modelValue":e[2]||(e[2]=f=>o.orderCompanyCode=f),options:U.value,disabled:!["create"].includes(c.value)||!o.contractCode,clearable:"",placeholder:["create","edit"].includes(c.value)?"请选择公司":" ",onChange:ke},null,8,["modelValue","options","disabled","placeholder"])]),_:1},8,["required"])]),_:1}),i(b,{span:12},{default:n(()=>[o.processName?(y(),V(u,{key:0,label:"审批流程",prop:"processId",required:["create"].includes(c.value)},{default:n(()=>[X(p(o.processName||"-"),1)]),_:1},8,["required"])):T("",!0),o.processName?T("",!0):(y(),V(u,{key:1,label:"流程编号",prop:"processId"},{default:n(()=>[i(Q,{type:"primary",underline:!1,onClick:e[3]||(e[3]=f=>w(Ae)({flowId:o.processInstanceNo}))},{default:n(()=>[X(p(o.processInstanceNo||"-"),1)]),_:1})]),_:1}))]),_:1})]),_:1}),i(oe,{style:{"margin-bottom":"14px","align-items":"center"}},{default:n(()=>[e[13]||(e[13]=d("span",{style:{"font-size":"14px"}},"订单金额",-1)),d("span",mn,p(w(M))+"元",1)]),_:1,__:[13]}),i(u,{"label-position":"top",label:"商品信息",prop:"orderList",required:""},{default:n(()=>[i(Ye,{"row-key":"_id",data:o.orderList,border:"","max-height":vt.value,style:{width:"100%"},size:"small",disabled:["info","end"].includes(c.value),"scrollbar-always-on":"","show-summary":w(ce),"summary-method":yt,"header-cell-class-name":we},{default:n(()=>[(y(!0),k(pe,null,Le(E.value.targetColumns,(f,Z)=>(y(),V(de,{key:f.code,label:f.label,"min-width":160,prop:f.code},null,8,["label","prop"]))),128)),i(de,{label:"数量",prop:"quantity","min-width":200},{default:n(({row:f,$index:Z})=>[i(u,{class:"table-form-item",prop:`orderList.${Z}.quantity`,rules:ge.quantity},{default:n(()=>[["create","edit","change"].includes(c.value)?(y(),V(Ke,{key:0,class:"number-left w-full",modelValue:f.quantity,"onUpdate:modelValue":me=>f.quantity=me,min:1,step:1,placeholder:"请输入",onChange:me=>I(f)},null,8,["modelValue","onUpdate:modelValue","onChange"])):(y(),k("span",pn,p(f.quantity),1))]),_:2},1032,["prop","rules"])]),_:1}),S.value?(y(),V(de,{key:0,label:"总金额",prop:"totalAmount","min-width":200,formatter:w(xe)},null,8,["formatter"])):T("",!0),["create","edit","change"].includes(c.value)?(y(),V(de,{key:1,label:"操作",width:100,fixed:"right"},{default:n(({row:f,$index:Z})=>[i(Qe,{link:"",type:"primary",size:"small",onClick:me=>R(f,Z)},{default:n(()=>e[14]||(e[14]=[X("新增")])),_:2,__:[14]},1032,["onClick"]),o.orderList.length>1?(y(),V(Qe,{key:0,onClick:me=>A(f,Z),size:"small",link:"",type:"primary"},{default:n(()=>e[15]||(e[15]=[X("删除")])),_:2,__:[15]},1032,["onClick"])):T("",!0)]),_:1})):T("",!0)]),_:1},8,["data","max-height","disabled","show-summary"])]),_:1}),i(u,{"label-position":"top",label:"订单备注",prop:"remark"},{default:n(()=>[i(P,{modelValue:o.remark,"onUpdate:modelValue":e[4]||(e[4]=f=>o.remark=f),rows:3,style:{width:"100%"},type:"textarea",disabled:!["create","edit"].includes(c.value),maxlength:"500","show-word-limit":"",placeholder:["create","edit"].includes(c.value)?"请输入订单备注":""},null,8,["modelValue","disabled","placeholder"])]),_:1}),["create","edit","change"].includes(c.value)?(y(),V(u,{key:0,class:"fulfillmentplanListedit-item","label-position":"top",label:"履约信息",prop:"contractListFulfillmentPlainParamList",required:""},{default:n(()=>[d("div",{class:"w-full fulfillmentplanListedit-main",onClick:Re},[v.value?(y(),k("div",fn,[i(kt,De({ref_key:"planRef",ref:te,modelValue:o.contractListFulfillmentPlainParamList,"onUpdate:modelValue":e[5]||(e[5]=f=>o.contractListFulfillmentPlainParamList=f),disabled:!(o.contractCode&&o.orderCompanyCode),"party-list":ne.value},ve.value),null,16,["modelValue","disabled","party-list"])])):T("",!0)])]),_:1})):T("",!0),["change"].includes(c.value)?(y(),V(oe,{key:1,gutter:24},{default:n(()=>[i(b,{span:12},{default:n(()=>[i(u,{label:"订单调整金额",prop:"orderChangeAmount",required:""},{default:n(()=>[i(Ke,{modelValue:o.orderChangeAmount,"onUpdate:modelValue":e[6]||(e[6]=f=>o.orderChangeAmount=f),class:"number-left",controls:!1,precision:2,max:w(Rt),placeholder:"请输入订单调整金额",style:{width:"80%"},onChange:bt},null,8,["modelValue","max"]),e[16]||(e[16]=d("span",{slot:"append",style:{"margin-left":"4px"}},"元",-1))]),_:1,__:[16]}),i(Pt,{style:{"margin-left":"18px",color:"#f56c6c"}},{default:n(()=>e[17]||(e[17]=[X("说明：订单变更金额可以调增（正数），也可以调减（负数）")])),_:1,__:[17]})]),_:1}),i(b,{span:12},{default:n(()=>[i(u,{label:"上传附件",prop:"fileList",required:!1},{default:n(()=>[i(w(ot),{modelValue:o.fileList,"onUpdate:modelValue":e[7]||(e[7]=f=>o.fileList=f),accept:".pdf",disabled:Ge.value,size:50,limit:10,style:{width:"100%"}},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1})):T("",!0),["change"].includes(c.value)?(y(),V(u,{key:2,"label-position":"top",label:"变更说明",prop:"changeReason",required:""},{default:n(()=>[i(P,{modelValue:o.changeReason,"onUpdate:modelValue":e[8]||(e[8]=f=>o.changeReason=f),rows:3,style:{width:"100%"},type:"textarea",maxlength:"500","show-word-limit":"",placeholder:"请输入变更说明"},null,8,["modelValue"])]),_:1})):T("",!0),["info","cancel","end"].includes(c.value)?(y(),V(ft,{key:3,detailData:w(q),config:ve.value.config},null,8,["detailData","config"])):T("",!0),["cancel","end"].includes(c.value)?(y(),V(u,{key:4,"label-position":"top",label:"取消原因",prop:"cancelReason",required:""},{default:n(()=>[i(P,{modelValue:o.cancelReason,"onUpdate:modelValue":e[9]||(e[9]=f=>o.cancelReason=f),rows:3,style:{width:"100%"},type:"textarea",maxlength:"500","show-word-limit":"",placeholder:"请输入取消原因"},null,8,["modelValue"])]),_:1})):T("",!0),["cancel","end"].includes(c.value)?(y(),V(u,{key:5,"label-position":"top",label:"上传附件",prop:"fileList",required:!1},{default:n(()=>[i(w(ot),{modelValue:o.fileList,"onUpdate:modelValue":e[10]||(e[10]=f=>o.fileList=f),accept:".pdf",disabled:Ge.value,size:50,limit:10,style:{width:"100%"}},null,8,["modelValue","disabled"])]),_:1})):T("",!0),["info"].includes(c.value)?(y(),V(u,{key:6,"label-position":"top",label:"变更记录"},{default:n(()=>[i(Lt,De({ref:"complianceContractRef"},ee.value),{changeVersion:n(({row:f})=>[f.changeVersion?(y(),V(Q,{key:0,type:"primary",underline:!0,onClick:Z=>Ve(f.batchId)},{default:n(()=>[X("V"+p(f.changeVersion||"-"),1)]),_:2},1032,["onClick"])):T("",!0)]),changeType:n(({row:f})=>[X(p(G("contract_order_change_type",f.changeType)),1)]),description:n(({row:f})=>[i(Ze,{"max-height":"60px"},{default:n(()=>[d("div",yn,p(f.description),1)]),_:2},1024)]),attachmentUrl:n(({row:f})=>[i(Ze,{"max-height":"60px"},{default:n(()=>[d("div",vn,[i(It,{direction:"vertical",alignment:"flex-start",style:{"min-height":"62px",height:"auto"}},{default:n(()=>[(y(!0),k(pe,null,Le(Je(f.attachmentUrl),(Z,me)=>(y(),k("div",{key:me,style:{display:"flex",cursor:"pointer"}},[e[18]||(e[18]=d("img",{style:{width:"16px",height:"22px","line-height":"22px"},src:Bt,alt:""},null,-1)),d("div",hn,p(Z.fileName),1),d("div",_n,[i(w(zt),{"file-url":Z.fileUrl,"file-name":Z.fileName,"file-list":Je(f.attachmentUrl)},null,8,["file-url","file-name","file-list"])])]))),128))]),_:2},1024)])]),_:2},1024)]),approvalId:n(({row:f})=>[i(Q,{type:"primary",underline:!0,onClick:Z=>w(Ae)({flowId:f.approvalId})},{default:n(()=>[X(p(f.approvalId||"-"),1)]),_:2},1032,["onClick"])]),_:1},16)]),_:1})):T("",!0)]),_:1},8,["model"]))])),[[xt,ue.value]])]),_:1},8,["title","modelValue","confirmText","hideCancel"]),i(et,{title:"选择标的内容",modelValue:J.value.visible,"onUpdate:modelValue":e[12]||(e[12]=f=>J.value.visible=f),width:"600px",onSubmit:h},{default:n(()=>[d("div",gn,[i(Ye,{data:J.value.enableList,border:"",style:{width:"100%"},size:"small",onSelectionChange:Ee},{default:n(()=>[i(de,{type:"selection",width:"50",align:"center"}),(y(!0),k(pe,null,Le(E.value.targetColumns,(f,Z)=>(y(),V(de,{key:f.code,label:f.label,"min-width":160,prop:f.code},null,8,["label","prop"]))),128))]),_:1},8,["data"])])]),_:1},8,["modelValue"])],64)}}}),Yn=ye(Cn,[["__scopeId","data-v-df745288"]]);export{Yn as A,ft as B,st as C,Wn as D,Jn as E,Xn as F,Gn as G,jn as H,zt as U,Bt as _,xn as a,On as b,Ln as c,Fn as d,$n as e,Tn as f,Nn as g,Rn as h,kn as i,wn as j,En as k,zn as l,qn as m,Mn as n,Dn as o,Sn as p,An as q,Un as r,In as s,Vn as t,Bn as u,Qn as v,Kn as w,Hn as x,Xt as y,ta as z};
