import{E as Ie,u as Te,_ as $e,C as Oe,d as Le}from"./detail-log-D5Cane4A.js";import{d as Ve,R as Fe,r as w,S as Se,T as Re,U as q,V as xe,h as _,i as Q,m as y,y as b,k as n,q as i,B as l,A as v,F as T,p as c,t as k,w as a,j as d,z as Pe,D as X,v as o,l as He,P as Be,L as x,H as Y,K as Me,G as V,M as We,J as ze,N as Z,O as Ge,Q as je}from"./index-B-DYpXrm.js";import{L as ee}from"./StorageCache-CXk3PELT.js";import{t as Je}from"./index-DTCKMPKS.js";import{g as u,a as Ke,A as Ue}from"./add-order-hE-kb25m.js";import{_ as qe,a as O,b as Qe}from"./contract-filing.vue_vue_type_script_setup_true_lang-C5ApMiIN.js";/* empty css                                                                          */import Xe from"./add-dialog-B5-qpQ-e.js";import"./error-Cq9Fpw4b.js";import"./contract-order-void.vue_vue_type_script_setup_true_lang-BtYW8LKp.js";import"./index-CljJgRiU.js";const Ye={class:"contract-details"},Ze={class:"contract-details-top"},et={class:"contract-details-top-content"},tt={class:"contract-details-top-content-tags"},at={class:"grid-2-2"},st={class:"flex-center"},nt={class:"price-box"},lt={class:"flex-center"},ot={class:"flex-center"},ut={class:"flex-center"},it={class:"status-box"},rt={key:0,style:{display:"flex","align-items":"center"}},dt={key:0,style:{color:"#86909c","font-size":"13px"}},ct={class:"contract-details-top-right"},vt={class:"contract-details-top-right-content"},pt={class:"contract-details-top-right-content"},mt={class:"contract-details-middle"},_t={class:"details-basic"},yt={class:"details-basic"},p="ContractList",ft=Ve({name:p,__name:"detail",setup(Ct){const te=Fe(Ie,{direction:"vertical"}),P=w(null),H=w(null),{copy:ae,isSupported:se}=Te(),B=w("basic"),m=w([]),N=w(),ne=Se(),F=w(ne.params.code),M=w({}),e=w({status:""}),S=w(0),$=w(!0),f=w({add:`${p}:add`,edit:`${p}:edit`,del:`${p}:del`,copy:`${p}:copy`,change:`${p}:change`,archiving:`${p}:archiving`,end:`${p}:end`,void:`${p}:void`,addOrder:`${p}:addOrder`,addContractOrder:`${p}:addContractOrder`,submit:`${p}:submit`,submitChange:`${p}:submitChange`,cancel:`${p}:cancel`,cancelChange:`${p}:cancelChange`,cancelEnd:`${p}:cancelEnd`,withdraw:`${p}:withdraw`,withdrawChange:`${p}:withdrawChange`,withdrawEnd:`${p}:withdrawEnd`}),W={CREATED:"#FF802A",INVALID:"#4E5969",IN_APPROVAL:"#34C759",CHANGE_IN_APPROVAL:"#34C759",CANCELLED:"#4E5969",CHANGED_WAITE_APPROVAL:"#FF802A",IN_FULFILLMENT:"#34C759",IN_STOP:"#34C759",ENDED:"#4E5969",FINISHED:"#4E5969"},le=(s,t)=>{const E=Be[s];if(!E)return console.error(`未找到名为 ${s} 的字典`),"";const h=E.find(I=>I.value==t);return h?h.label:""},z=s=>{const t=s==="copyTitle"?P.value:H.value;if(!se.value){x.warning("请在https环境下使用");return}ae(t.innerText),x.success(`复制成功：${t.innerText}`)},oe=s=>{N.value=s,D()},ue=Re(()=>{if(!m.value||m.value.length===0)return!0;const s=m.value[m.value.length-1];return N.value===s});q({contractCode:F.value}).then(s=>{m.value=s,m.value&&m.value.length>0?(N.value=m.value[m.value.length-1],D()):$.value=!1}).catch(()=>{$.value=!1});const D=()=>{$.value=!0,xe({contractCode:F.value,cVersion:N.value}).then(s=>{e.value=JSON.parse(JSON.stringify(s)),M.value.url=(s.controlInfo?JSON.parse(s.controlInfo):{}).url,M.value.name=`${s.name}.docx`}).finally(()=>{$.value=!1})},ie=()=>{const s={CREATED:0,INVALID:2,IN_APPROVAL:1,CHANGE_IN_APPROVAL:1,CANCELLED:2,CHANGED_WAITE_APPROVAL:0,IN_FULFILLMENT:2,IN_STOP:1,ENDED:4,FINISHED:4};if(e.value&&e.value.status)return s[e.value.status]},A=(s,t,E={})=>{Y({body:s,bodyData:{initData:{...t,...E}},isReject:!0}).then(h=>{h.success&&(E.type==="cancelChange"?q({contractCode:F.value}).then(I=>{m.value=I,m.value&&m.value.length>0&&(N.value=m.value[m.value.length-1]),D(),S.value++}).catch(()=>{D(),S.value++}):D())}).catch(()=>{})},re=()=>{},de=()=>A(Ue,e.value),ce=async s=>{try{await Me(e.value.id,e.value.code)?V({name:"ContractEdit",params:{id:e.value.id}}):x.error("存在履约进行中的计划，不允许变更")}finally{s.done()}},ve=()=>{if(e.value&&e.value.id){V({name:"ContractEdit",params:{id:e.value.id}});return}const s={bodyFilePathSet:[],...e.value,fileType:"importFile"};Y({body:Xe,bodyData:{initData:s||{}},isReject:!0})},pe=()=>{We({contractId:e.value.id}).then(s=>{s&&A(qe,e.value)})},me=()=>{A(O,{...e.value,oldCVersion:N.value-1,cVersion:N.value},{type:"cancelChange"})},_e=()=>A(O,e.value,{type:"terminate"}),ye=()=>A(O,e.value,{type:"withdraw"}),fe=()=>A(O,e.value,{type:"modify"}),Ce=()=>A(O,e.value,{type:"stopWithdraw"}),ge=()=>A(Qe,e.value),G=s=>{ze({id:e.value.id}).then(t=>{Je({submitId:t}),D()}).finally(()=>{s.done()})},we=s=>{const t=Z();ee.getInstance().setData(t,{cacheCode:t,copyContractId:e.value.id}),V({name:"ContractCreate",params:{cacheCode:t}})},be=()=>{const s=Z();ee.getInstance().setData(s,{cacheCode:s,businessTypeFirst:e.value.businessTypeFirst,businessTypeFirstName:e.value.businessTypeFirstName,businessTypeSecond:e.value.businessTypeSecond,businessTypeSecondName:e.value.businessTypeSecondName,businessTypeInfo:e.value.businessTypeFirstName+"-"+e.value.businessTypeSecondName,relatedContractCode:e.value.code,relatedContractName:e.value.name,type:Ge.ORDER_CONTRACT}),V({name:"ContractCreate",params:{cacheCode:s}})};return(s,t)=>{const E=_("DocumentCopy"),h=_("el-icon"),I=_("el-tag"),ke=_("arrow-down"),Ne=_("el-button"),j=_("el-dropdown-item"),J=_("el-dropdown-menu"),K=_("el-dropdown"),C=_("FsButton"),R=_("el-breadcrumb-item"),Ae=_("el-breadcrumb"),L=_("el-step"),Ee=_("el-steps"),U=_("el-tab-pane"),he=_("el-tabs"),g=Q("per"),De=Q("loading");return y((n(),b("div",Ye,[i("div",Ze,[t[33]||(t[33]=i("img",{class:"contract-details-top-img",src:$e,alt:""},null,-1)),i("div",et,[i("div",{class:"contract-details-top-content-title flex-center",ref_key:"copyTitle",ref:P},[e.value&&e.value.name?(n(),b(T,{key:0},[c(k(e.value.name),1)],64)):l("",!0),v(h,{class:"copy-icon",onClick:t[0]||(t[0]=r=>z("copyTitle"))},{default:a(()=>[v(E)]),_:1}),i("div",tt,[e.value&&e.value.archived?(n(),d(I,{key:0,style:{margin:"0 8px",color:"#1d2129","font-weight":"600"},type:"info",effect:"plain",size:"small"},{default:a(()=>[e.value&&e.value.archived?(n(),b(T,{key:0},[c(k(e.value.archived=="ARCHIVED"?"已归档":"未归档"),1)],64)):l("",!0)]),_:1})):l("",!0),e.value&&e.value.changed?(n(),d(I,{key:1,type:e.value&&e.value.changed=="1"?"warning":"danger",effect:"plain",size:"small"},{default:a(()=>[e.value&&e.value.changed||e.value.changed==0?(n(),b(T,{key:0},[c(k(e.value.changed=="1"?"变更":"未变更"),1)],64)):l("",!0)]),_:1},8,["type"])):l("",!0)])],512),i("div",at,[i("div",st,[t[15]||(t[15]=i("div",{class:"title-name"},"合同金额：",-1)),i("div",nt,[e.value&&e.value.realContractAmount?(n(),b(T,{key:0},[c(k(s.$format.thousandsFormatCurrency(e.value.realContractAmount)),1)],64)):l("",!0)])]),i("div",lt,[t[16]||(t[16]=i("div",{class:"title-name"},"合同编号：",-1)),i("div",{ref_key:"copyNum",ref:H},[e.value&&e.value.code?(n(),b(T,{key:0},[c(k(e.value.code),1)],64)):l("",!0)],512),v(h,{class:"copy-icon",onClick:t[1]||(t[1]=r=>z("copyNum"))},{default:a(()=>[v(E)]),_:1})]),i("div",ot,[t[17]||(t[17]=i("div",{class:"title-name"},"合同版本：",-1)),v(K,{style:{"margin-right":"20px"}},{dropdown:a(()=>[v(J,null,{default:a(()=>[(n(!0),b(T,null,Pe(m.value,r=>(n(),d(j,{onClick:gt=>oe(r),key:r},{default:a(()=>[c("版本"+k(r),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:a(()=>[v(Ne,{size:"small"},{default:a(()=>[c(" 版本"+k(N.value)+" ",1),v(h,{class:"el-icon--right"},{default:a(()=>[v(ke)]),_:1})]),_:1})]),_:1})]),i("div",ut,[t[18]||(t[18]=i("div",{class:"title-name"},"当前状态：",-1)),i("div",it,[e.value&&e.value.status?(n(),b("div",rt,[i("div",{class:"contract-status",style:X(`color: ${W[e.value.status]}`)},[i("i",{style:X(`background: ${W[e.value.status]}`)},null,4),c(" "+k(le("contract_status",e.value.status)),1)],4),["IN_APPROVAL","CHANGE_IN_APPROVAL","IN_STOP"].includes(e.value.status)?(n(),b("div",dt,"（流程单号："+k(e.value.processInstanceNo)+"）",1)):l("",!0)])):l("",!0)])])])]),i("div",ct,[i("div",vt,[ue.value?(n(),d(Ae,{key:0,"separator-icon":o(te)},{default:a(()=>[(o(u)(4,e.value.status)||o(u)(6,e.value.status))&&e.value.status!=="NO_ARCHIVED"?(n(),d(R,{key:0},{default:a(()=>[o(u)(4,e.value.status)?y((n(),d(C,{key:0,"show-loading":!1,onClick:t[2]||(t[2]=r=>we(r))},{default:a(()=>t[19]||(t[19]=[c("复制")])),_:1,__:[19]})),[[g,f.value.copy]]):l("",!0),o(u)(6,e.value.status)&&e.value.archived==="NO_ARCHIVED"?y((n(),d(C,{key:1,"show-loading":!1,onClick:t[3]||(t[3]=r=>ge())},{default:a(()=>t[20]||(t[20]=[c("归档")])),_:1,__:[20]})),[[g,f.value.archiving]]):l("",!0)]),_:1})):l("",!0),o(u)(14,e.value.status)||o(u)(8,e.value.status)||o(u)(7,e.value.status)||o(u)(16,e.value.status)||o(u)(17,e.value.status)||o(u)(18,e.value.status)?(n(),d(R,{key:1},{default:a(()=>[o(u)(14,e.value.status)?y((n(),d(C,{key:0,type:"danger","show-loading":!1,onClick:t[4]||(t[4]=r=>me())},{default:a(()=>t[21]||(t[21]=[c("取消变更")])),_:1,__:[21]})),[[g,f.value.cancelChange]]):l("",!0),o(u)(8,e.value.status)?y((n(),d(C,{key:1,type:"danger","show-loading":!1,onClick:t[5]||(t[5]=r=>_e())},{default:a(()=>t[22]||(t[22]=[c("作废")])),_:1,__:[22]})),[[g,f.value.void]]):l("",!0),o(u)(7,e.value.status)?y((n(),d(C,{key:2,type:"danger","show-loading":!1,onClick:t[6]||(t[6]=r=>pe())},{default:a(()=>t[23]||(t[23]=[c("终止")])),_:1,__:[23]})),[[g,f.value.end]]):l("",!0),o(u)(16,e.value.status)?y((n(),d(C,{key:3,type:"danger","show-loading":!1,onClick:t[7]||(t[7]=r=>ye())},{default:a(()=>t[24]||(t[24]=[c("撤回")])),_:1,__:[24]})),[[g,f.value.withdraw]]):l("",!0),o(u)(17,e.value.status)?y((n(),d(C,{key:4,type:"danger","show-loading":!1,onClick:t[8]||(t[8]=r=>fe())},{default:a(()=>t[25]||(t[25]=[c("撤回")])),_:1,__:[25]})),[[g,f.value.withdrawChange]]):l("",!0),o(u)(18,e.value.status)?y((n(),d(C,{key:5,type:"danger","show-loading":!1,onClick:t[9]||(t[9]=r=>Ce())},{default:a(()=>t[26]||(t[26]=[c("撤回")])),_:1,__:[26]})),[[g,f.value.withdrawEnd]]):l("",!0)]),_:1})):l("",!0),o(u)(2,e.value.status)||o(u)(5,e.value.status)||o(u)(11,e.value.status)||o(u)(12,e.value.status)||o(u)(9,e.value.status)?(n(),d(R,{key:2},{default:a(()=>[o(u)(2,e.value.status)?y((n(),d(C,{key:0,type:"primary","show-loading":!1,onClick:t[10]||(t[10]=r=>ve())},{default:a(()=>t[27]||(t[27]=[c("编辑")])),_:1,__:[27]})),[[g,f.value.edit]]):l("",!0),o(u)(5,e.value.status)?y((n(),d(C,{key:1,type:"primary",onClick:t[11]||(t[11]=r=>ce(r))},{default:a(()=>t[28]||(t[28]=[c("变更")])),_:1,__:[28]})),[[g,f.value.change]]):l("",!0),o(u)(11,e.value.status)?y((n(),d(C,{key:2,type:"primary",onClick:t[12]||(t[12]=r=>G(r))},{default:a(()=>t[29]||(t[29]=[c("提交审批")])),_:1,__:[29]})),[[g,f.value.submit]]):l("",!0),o(u)(12,e.value.status)?y((n(),d(C,{key:3,type:"primary",onClick:t[13]||(t[13]=r=>G(r))},{default:a(()=>t[30]||(t[30]=[c("提交审批")])),_:1,__:[30]})),[[g,f.value.submitChange]]):l("",!0),o(Ke)(9,e.value.status)&&e.value.type=="FRAMEWORK_CONTRACT"?(n(),d(K,{key:4,style:{"margin-left":"12px"},size:"small","split-button":!0,type:"primary",onClick:de},He({default:a(()=>[t[32]||(t[32]=c(" 新增订单 "))]),_:2},[o(u)(10,e.value.status)&&e.value.type==="FRAMEWORK_CONTRACT"?{name:"dropdown",fn:a(()=>[v(J,null,{default:a(()=>[y((n(),d(j,null,{default:a(()=>[v(C,{type:"primary","show-loading":!1,onClick:be},{default:a(()=>t[31]||(t[31]=[c("新增订单合同")])),_:1,__:[31]})]),_:1})),[[g,f.value.addContractOrder]])]),_:1})]),key:"0"}:void 0]),1024)):l("",!0)]),_:1})):l("",!0)]),_:1},8,["separator-icon"])):l("",!0)]),i("div",pt,[v(Ee,{style:{width:"450px"},active:ie(),"align-center":""},{default:a(()=>[v(L,{title:"起草/变更中"}),v(L,{title:"审批中"}),v(L,{title:"已生效"}),v(L,{title:"已终止/作废/撤销"})]),_:1},8,["active"])])])]),i("div",mt,[v(he,{class:"fixed-height el-tabs_modify-skew bg-white",modelValue:B.value,"onUpdate:modelValue":t[14]||(t[14]=r=>B.value=r)},{default:a(()=>[v(U,{label:"基础信息",name:"basic"},{default:a(()=>[i("div",_t,[e.value?(n(),d(Oe,{key:S.value,detailData:e.value,onOnFileSuccess:re},null,8,["detailData"])):l("",!0)])]),_:1}),v(U,{label:"操作日志",name:"detailLog"},{default:a(()=>[i("div",yt,[e.value?(n(),d(Le,{key:0,detailData:e.value},null,8,["detailData"])):l("",!0)])]),_:1})]),_:1},8,["modelValue"])])])),[[De,$.value]])}}}),Ot=je(ft,[["__scopeId","data-v-2c0f3d7a"]]);export{Ot as default};
