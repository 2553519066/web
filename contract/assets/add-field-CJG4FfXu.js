const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/form-dialog-CUsAafAk.js","assets/index-D9FXDxt4.js","assets/index-CCn4OCkM.css","assets/customControl-D3ycBOCS.js","assets/form-dialog-CL_-O8ev.css"])))=>i.map(i=>d[i]);
import{d as G,ap as P,T as H,aq as Y,r as D,o as W,h as d,i as X,j as h,k as i,w as c,q as I,A as m,m as Z,c5 as ee,v as te,cG as le,B as F,y as w,F as E,z as $,t as q,aa as ae,D as oe,p as B,cH as N,cI as se,cJ as ne,cK as ie,cL as de,H as ce,I as re,L as fe,N as ue,bo as x,cM as me,Q as pe}from"./index-D9FXDxt4.js";import{q as ve,c as be}from"./customControl-D3ycBOCS.js";import{d as M}from"./text-style-form.vue_vue_type_script_setup_true_lang-DVqTA1Tz.js";const ye={class:"radius-box"},_e={class:"field-list"},ge={key:0,class:"list-title"},Le={style:{overflow:"hidden"}},he={class:"item-name"},Ce={class:"dialog-foot"},De=G({name:"AddField",__name:"add-field",props:P({baseInfo:{type:Object,default:()=>({})},partyList:{type:Array,default:()=>[]},otherList:{type:Array,default:()=>[]},enableTabList:{type:Array,default:()=>["baseInfo","contractParty","otherField","existField"]}},{modelValue:{},modelModifiers:{}}),emits:P(["success"],["update:modelValue"]),setup(y,{emit:J}){const _=y,U=H(()=>(_.otherList||[]).map(s=>s.fieldInstanceCode)),T=Y(y,"modelValue"),S=J,k=D(_.enableTabList[0]),r=D(""),p=D([]),v=D(!1),V=()=>{switch(p.value=[],k.value){case"baseInfo":p.value=[{title:"",list:ie.filter(e=>!r.value||e.name.indexOf(r.value)>-1).map(e=>{let l=_.baseInfo[e.code];return e.format&&l&&(l=e.format(l)),{...e,quoteCode:de(e.code),initValue:l}})}];break;case"contractParty":let s=se.filter(e=>!r.value||e.name.indexOf(r.value)>-1),t=[];for(let e=0;e<_.partyList.length;e++){let l=_.partyList[e],f=`签约方${e+1}`;t.push({title:f,list:s.map(o=>({...o,quoteCode:ne(l.partyUuid,o.code),placeholder:`${f} ${o.name}`,initValue:l[o.code]}))})}p.value=t;break;case"otherField":v.value=!0,ve({name:r.value,pageNum:1,pageSize:100,status:"Y"}).then(e=>{const l=e.list||[];p.value=[{title:"",list:l.map(f=>{let o=N(f),a=_.otherList.find(b=>b.fieldInstanceCode===f.code);return a&&(o.control.fieldInstanceData=a.fieldInstanceData),o})}]}).finally(()=>{v.value=!1});break;case"existField":p.value=[{title:"",list:_.otherList.filter(e=>!r.value||e.fieldDefineName.indexOf(r.value)>-1).map(e=>N(e))}];break}},A=()=>{T.value=!1},z=async s=>{let t=new Set;const e=[x.TABLE,x.TARGET];for(let o of s){const{control:a}=o;if(a){if(a.fieldDefineInfo=a.fieldDefineInfo?JSON.parse(a.fieldDefineInfo):{},a.fieldDefineType===x.TABLE){const{columns:b}=a.fieldDefineInfo;for(let n of b)t.add(n.relationCode)}e.includes(a.fieldDefineType)&&(a.fieldDefineInfo.style={header:{...M,bold:!0},content:{...M}})}}let l=Array.from(t).filter(o=>!!o);const f=l.length>0?await be({codeList:l}):[];for(let o of s){const{control:a}=o;if(a){if(a.fieldDefineType===x.TABLE){const{columns:b}=a.fieldDefineInfo;for(let n of b)if(n.relationCode){let g=f.find(C=>C.code===n.relationCode);g&&(n.label=n.label||g.name,n.code=g.code,n.labelCode=n.relationData.labelCode,me(n,g),n.relationData=JSON.parse(g.fieldDefineInfo))}}a.fieldDefineInfo=JSON.stringify(a.fieldDefineInfo)}}},j=async()=>{const s=await ce({body:()=>re(()=>import("./form-dialog-CUsAafAk.js"),__vite__mapDeps([0,1,2,3,4])),bodyData:{initData:{},notSave:!0,async validate(e){if(U.value.includes(e.code)){let l=`控件code[${e.code}]已插入`;throw fe.warning(l),new Error(l)}}},isReject:!0});try{await z([{control:s.data}])}catch(e){console.log(e)}const t=N(s.data);t.fieldDefineId=ue(),S("success",[t]),A()},O=D(!1),K=async()=>{let s=[];for(let t of p.value)for(let e of t.list)e.selected&&s.push(e);await z(s),S("success",s),O.value=!1,A()};return W(()=>{V()}),(s,t)=>{const e=d("el-input"),l=d("el-tab-pane"),f=d("el-tabs"),o=d("el-empty"),a=d("fs-svg-icon"),b=d("el-space"),n=d("el-col"),g=d("el-row"),C=d("FsButton"),Q=d("complex-dialog"),R=X("loading");return i(),h(Q,{modelValue:T.value,"onUpdate:modelValue":t[2]||(t[2]=u=>T.value=u),width:"500px",title:"新增字段"},{footer:c(()=>[I("div",Ce,[m(C,{type:"primary","show-loading":!1,size:"small",plain:"",onClick:j},{default:c(()=>t[3]||(t[3]=[B("新增自定义控件")])),_:1,__:[3]}),m(b,null,{default:c(()=>[m(C,{"show-loading":!1,size:"small",onClick:A},{default:c(()=>t[4]||(t[4]=[B("返回")])),_:1,__:[4]}),m(C,{type:"primary",size:"small","show-loading":!1,loading:O.value,onClick:K},{default:c(()=>t[5]||(t[5]=[B("插入")])),_:1,__:[5]},8,["loading"])]),_:1})])]),default:c(()=>[I("div",ye,[m(e,{class:"w-full",modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=u=>r.value=u),placeholder:"请输入字段名称进行搜索","suffix-icon":te(le),disabled:v.value,onKeyup:ee(V,["enter","native"])},null,8,["modelValue","suffix-icon","disabled"]),m(f,{class:"add-field-tabs btn-tabs",modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=u=>k.value=u),onTabChange:V},{default:c(()=>[y.enableTabList.includes("baseInfo")?(i(),h(l,{key:0,label:"基础信息",name:"baseInfo",disabled:v.value},null,8,["disabled"])):F("",!0),y.enableTabList.includes("contractParty")?(i(),h(l,{key:1,label:"签约方信息",name:"contractParty",disabled:v.value},null,8,["disabled"])):F("",!0),y.enableTabList.includes("otherField")?(i(),h(l,{key:2,label:"自定义字段",name:"otherField",disabled:v.value},null,8,["disabled"])):F("",!0),y.enableTabList.includes("existField")&&y.otherList.length>0?(i(),h(l,{key:3,label:"已添加自定义字段",name:"existField",disabled:v.value},null,8,["disabled"])):F("",!0)]),_:1},8,["modelValue"]),Z((i(),w("div",_e,[p.value.length===0?(i(),h(o,{key:0})):(i(!0),w(E,{key:1},$(p.value,u=>(i(),w(E,null,[u.title?(i(),w("div",ge,q(u.title),1)):F("",!0),I("div",Le,[m(g,{gutter:12},{default:c(()=>[(i(!0),w(E,null,$(u.list,L=>(i(),h(n,{span:12,key:L.code},{default:c(()=>[m(b,{class:ae(`list-item ${L.selected?"active":""}`),size:4,alignment:"start",onClick:Ie=>L.selected=!L.selected},{default:c(()=>[m(a,{class:"item-icon",name:L.icon},null,8,["name"]),I("span",{style:oe(`color: ${L.required?"var(--el-color-danger)":"#FFF"}`)},"*",4),I("span",he,q(L.name),1)]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:2},1024)])],64))),256))])),[[R,v.value]])])]),_:1},8,["modelValue"])}}}),Te=pe(De,[["__scopeId","data-v-3cf2ed64"]]);export{Te as default};
