import{W as e,X as t,Y as a,Z as o,$ as n,a0 as r,O as s,s as i}from"./index-BvTRnY6x.js";import{u as d}from"./userinfo.CF3eNbHI.js";const{netConfig:l,lang:m}={netConfig:{signature:{secretKey:"ZIDIANOL",signName:"sign",timestampName:"timestamp",nonceName:"nonce"}},lang:{zh:"CN",en:"US",id:"ID"}},u=d(),c=t=>{const{signature:a}=l;if(!a||t.noSignature)return;const o=Math.floor(Date.now()/1e3),n=((e=16)=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let a="";for(let o=0;o<e;o++)a+=t.charAt(Math.floor(62*Math.random()));return a})(),r=((t,a,o)=>{const n=`${o}${a}${t}`;return e.MD5(n).toString().toUpperCase()})(a.secretKey,o,n);t.header=t.header||{},t.header[a.signName]=r,t.header[a.timestampName]=o,t.header[a.nonceName]=n,delete t.noSignature},h=e=>{if((e=e||{}).method=(e.method||"GET").toUpperCase(),e.header={"Content-Type":"application/json;charset=UTF-8",...e.header,...e.headers},delete e.headers,e.params){const t=Object.keys(e.params).map(t=>`${t}=${e.params[t]}`).join("&");t&&(e.url+=(e.url.includes("?")?"&":"?")+t),delete e.params}const r=u.userInfo.token||t("Token");if(r){e.header.Authorization=`Bearer ${r}`;let t=a();e.header.deviceno=t.deviceId}c(e);let s=t("APIHTTPS")||"/api";if(e.url.startsWith("http")||(e.url=s+e.url),e.timeout=e.timeout||5e4,"POST"===e.method){const t=o("locale")||"zh";e.data={geoCode:m[t],data:e.data||{}},e.data=e.data||{}}return new Promise((t,a)=>{n({url:e.url,method:e.method,data:e.data||{},header:e.header,timeout:e.timeout,success:e=>p(e,t),fail:t=>g(t,e,a)})})},p=(e,t,a)=>{var o,n;const{status:d}=e.data,l=r();if(303===d){l.isMsg_({text:"登录已过期，请重新登录"});const e=s();let t="";if(e.length>0){const a=e[e.length-1],r=a.route||(null==(o=a.$route)?void 0:o.path);if(r){const e=r.startsWith("/")?r:`/${r}`,o=a.options||(null==(n=a.$page)?void 0:n.options)||{},s=Object.keys(o).map(e=>`${e}=${o[e]}`).join("&");t=s?`${e}?${s}`:e}}return i({url:`/pages/userApp/login/index?redirect=${encodeURIComponent(t)}`}),void u.clearUserInfo()}t(e.data)},g=(e,t,a)=>{console.warn("请求出错",e);r().loadingFn_(!1),a(e)};export{h as r};
